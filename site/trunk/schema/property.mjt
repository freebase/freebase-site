<acre:script>
  var mf = acre.require("MANIFEST").MF;
  var c = this.exports.c = {};  
  var h = mf.require("core", "helpers");
  var queries = mf.require("queries");

  var id = acre.request.params.id || acre.request.path_info;
  var data = {
    "property" : queries.property(id)
  };
</acre:script>

<acre:block def="head()">
  <link rel="stylesheet" type="text/css" href="${mf.css_src('schema.mf.css')}" />
</acre:block>

<acre:block def="content_header()">
  <div class="page-header">
    <h1 id="page-title">
      Schema Explorer
    </h1>
  </div>
  <div id="path">&raquo; <a href="${h.url_for('schema', 'index')}">Domains</a> &raquo; <a href="${h.url_for('schema', 'domain', null, c.property.schema.domain.id)}">$c.property.schema.domain.id</a> &raquo; <a href="${h.url_for('schema', 'type', null, c.property.schema.id)}">$c.property.schema.id</a> &raquo; <span>$c.property.id</span></div>
</acre:block>

<acre:block def="content_body()">
  <acre:block if="c.property">
    <div id="body">    
      <table class="skeleton">
        <tr>
          <td class="subject" rowspan="2">
            <a href="${h.url_for('schema', 'type', null, c.property.schema.id)}">${c.property.schema.name}</a>
          </td>
          <td class="predicate">
            <span class="current">$c.property.name.value <span class="attribute" acre:if="!c.property.master_property">master</span><span class="attribute" acre:if="c.property.unique">unique</span></span>
          </td> 
          <td class="object" rowspan="2">
            <a href="${h.url_for('schema', 'type', null, c.property.expected_type.id)}">${queries.isTypeType(c.property.expected_type.id) ? c.property.expected_type.id : c.property.expected_type.name}</a> <span class="attribute" acre:if="c.property.expected_type['/freebase/type_hints/mediator']">mediator/CVT</span> <a class="attribute" acre:if="c.property.unit" href="${h.url_for('schema', 'type', null, c.property.unit.id)}">$c.property.unit.name</a>
          </td>
        </tr>
        <tr>
          <td class="rev_predicate" acre:if="c.property.reverse_property">
            <a href="${h.url_for('schema', 'property', null, c.property.reverse_property.id)}">${c.property.reverse_property.name}</a><span class="attribute" acre:if="!c.property.master_property">master</span>
          </td>
          <td acre:else>&nbsp;</td>
        </tr>
      </table>
      
      <div id="description" acre:if="c.property.description">${acre.markup.bless(c.property.description)}</div>
    
      <div class="tools">
        <a href="${acre.freebase.site_host}/type/schema${id}" class="spaced">Edit Schema &raquo;</a><a href="${acre.freebase.site_host}/tools/explore${id}">Explore View &raquo;</a>       
      </div>
    </div>
  </acre:block>
  <acre:block elif="id == ''">
    <div id="error">Need to specify the <em>id</em> parameter</div>
  </acre:block>
  <acre:block elif="id.charAt(0) != '/'">
    <div id="error"><em>${id}</em> is not a property ID</div>
  </acre:block>
  <acre:block else="">
    <div id="error">No property found for <em>$id</em></div>
  </acre:block>
</acre:block>

<acre:block def="footer_script()">
  <script src="${mf.js_src('schema.mf.js')}"></script>
</acre:block>

${mf.require("template", "renderer").render_page(data, this.exports)}
