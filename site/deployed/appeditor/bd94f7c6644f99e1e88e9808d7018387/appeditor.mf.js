/*
 
 jQuery Tools @VERSION Tabs- The basics of UI design.

 NO COPYRIGHTS OR LICENSES. DO WHAT YOU LIKE.

 http://flowplayer.org/tools/tabs/

 Since: November 2008
 Date: @DATE 
*/
if(!("JSON"in window&&window.JSON)){if(!this.JSON)this.JSON={};(function(){function a(m){return m<10?"0"+m:m}function b(m){e.lastIndex=0;return e.test(m)?'"'+m.replace(e,function(p){var q=i[p];return typeof q==="string"?q:"\\u"+("0000"+p.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+m+'"'}function c(m,p){var q,r,t,h,j=f,n,o=p[m];if(o&&typeof o==="object"&&typeof o.toJSON==="function")o=o.toJSON(m);if(typeof l==="function")o=l.call(p,m,o);switch(typeof o){case "string":return b(o);case "number":return isFinite(o)?
String(o):"null";case "boolean":case "null":return String(o);case "object":if(!o)return"null";f+=g;n=[];if(Object.prototype.toString.apply(o)==="[object Array]"){h=o.length;for(q=0;q<h;q+=1)n[q]=c(q,o)||"null";t=n.length===0?"[]":f?"[\n"+f+n.join(",\n"+f)+"\n"+j+"]":"["+n.join(",")+"]";f=j;return t}if(l&&typeof l==="object"){h=l.length;for(q=0;q<h;q+=1){r=l[q];if(typeof r==="string")if(t=c(r,o))n.push(b(r)+(f?": ":":")+t)}}else for(r in o)if(Object.hasOwnProperty.call(o,r))if(t=c(r,o))n.push(b(r)+
(f?": ":":")+t);t=n.length===0?"{}":f?"{\n"+f+n.join(",\n"+f)+"\n"+j+"}":"{"+n.join(",")+"}";f=j;return t}}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+a(this.getUTCMonth()+1)+"-"+a(this.getUTCDate())+"T"+a(this.getUTCHours())+":"+a(this.getUTCMinutes())+":"+a(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}}var d=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
e=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,f,g,i={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},l;if(typeof JSON.stringify!=="function")JSON.stringify=function(m,p,q){var r;g=f="";if(typeof q==="number")for(r=0;r<q;r+=1)g+=" ";else if(typeof q==="string")g=q;if((l=p)&&typeof p!=="function"&&(typeof p!=="object"||typeof p.length!=="number"))throw new Error("JSON.stringify");return c("",
{"":m})};if(typeof JSON.parse!=="function")JSON.parse=function(m,p){function q(t,h){var j,n,o=t[h];if(o&&typeof o==="object")for(j in o)if(Object.hasOwnProperty.call(o,j)){n=q(o,j);if(n!==undefined)o[j]=n;else delete o[j]}return p.call(t,h,o)}var r;m=String(m);d.lastIndex=0;if(d.test(m))m=m.replace(d,function(t){return"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)});if(/^[\],:{}\s]*$/.test(m.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){r=eval("("+m+")");return typeof p==="function"?q({"":r},""):r}throw new SyntaxError("JSON.parse");}})()}
jQuery.cookie=function(a,b,c){if(typeof b!="undefined"){c=c||{};if(b===null){b="";c=$.extend({},c);c.expires=-1}var d="";if(c.expires&&(typeof c.expires=="number"||c.expires.toUTCString)){if(typeof c.expires=="number"){d=new Date;d.setTime(d.getTime()+c.expires*24*60*60*1E3)}else d=c.expires;d="; expires="+d.toUTCString()}var e=c.path?"; path="+c.path:"",f=c.domain?"; domain="+c.domain:"";c=c.secure?"; secure":"";document.cookie=[a,"=",encodeURIComponent(b),d,e,f,c].join("")}else{b=null;if(document.cookie&&
document.cookie!=""){c=document.cookie.split(";");for(d=0;d<c.length;d++){e=jQuery.trim(c[d]);if(e.substring(0,a.length+1)==a+"="){b=decodeURIComponent(e.substring(a.length+1));break}}}return b}};
(function(a){a.extend({localstore:function(b,c,d){var e=document.location.hostname,f=document.location.protocol;if(typeof c!="undefined"){var g=JSON.stringify(c);if(!d&&window.globalStorage)window.globalStorage[e][f+b]=g;else if(c===null){var i={};i.domain=COOKIE_DOMAIN?COOKIE_DOMAIN:fb.get_cookie_domain();a.cookie(b,null,i)}else a.cookie(b,g,a.extend(i,{expires:14,path:"/"}));return c}else{if(!d&&window.globalStorage){if(window.globalStorage[e][f+b])c=window.globalStorage[e][f+b].value}else c=a.cookie(b);
if(c!=null)return JSON.parse(c,null)}return null}})})(jQuery);
(function(a){function b(d,e){this.options=a.extend(true,{},e);this.input=a(d);this.placeholder=this.input.attr("placeholder")||"";this.init()}if(!("placeholder"in document.createElement("input"))){var c=a.fn.val;a.fn.val=function(d){if(d===undefined)if(this.hasClass("placeholder"))return"";return c.apply(this,[d])};b.prototype={init:function(){var d=this,e=this.input.val();if(e===""||e===this.placeholder)this.input.val(this.placeholder).addClass("placeholder");this.input.bind("focus.placeholder",
function(f){return d.focus(f)}).bind("blur.placeholder",function(f){return d.blur(f)});this.input[0].form&&a(this.input[0].form).bind("submit",function(f){return d.submit(f)})},destroy:function(){this.input.unbind(".placeholder");this.input[0].form&&a(this.input[0].form).unbind(".placeholder")},focus:function(){this.input.hasClass("placeholder")&&this.input.val("").removeClass("placeholder")},blur:function(){this.input.val()===""&&this.input.val(this.input.attr("placeholder")).addClass("placeholder")},
submit:function(){this.input.hasClass("placeholder")&&this.input.val("")}};a.fn.placeholder=function(d){return this.each(function(){var e=a(this);e.unbind(".placeholder");if(e.is(":text")||e.is("textarea"))if(e.attr("placeholder")){(e=a.data(this,"placeholder"))&&e.destroy();a.data(this,"placeholder",new b(this,d))}})}}})(jQuery);
(function(a){a.extend({metadata:{defaults:{type:"class",name:"metadata",cre:/({.*})/,single:"metadata"},setType:function(b,c){this.defaults.type=b;this.defaults.name=c},get:function(b,c){var d=a.extend({},this.defaults,c);if(!d.single.length)d.single="metadata";var e=a.data(b,d.single);if(e)return e;e="{}";var f=function(l){if(typeof l!="string")return l;return l=eval("("+l+")")};if(d.type=="html5"){var g={};a(b.attributes).each(function(){var l=this.nodeName;if(l.match(/^data-/))l=l.replace(/^data-/,
"");else return true;g[l]=f(this.nodeValue)})}else{if(d.type=="class"){var i=d.cre.exec(b.className);if(i)e=i[1]}else if(d.type=="elem"){if(!b.getElementsByTagName)return;i=b.getElementsByTagName(d.name);if(i.length)e=a.trim(i[0].innerHTML)}else if(b.getAttribute!=undefined)if(i=b.getAttribute(d.name))e=i;g=f(e.indexOf("{")<0?"{"+e+"}":e)}a.data(b,d.single,g);return g}}});a.fn.metadata=function(b){return a.metadata.get(this[0],b)}})(jQuery);
(function(a,b){function c(d){return!a(d).parents().andSelf().filter(function(){return a.curCSS(this,"visibility")==="hidden"||a.expr.filters.hidden(this)}).length}a.ui=a.ui||{};if(!a.ui.version){a.extend(a.ui,{version:"1.8.4",plugin:{add:function(d,e,f){d=a.ui[d].prototype;for(var g in f){d.plugins[g]=d.plugins[g]||[];d.plugins[g].push([e,f[g]])}},call:function(d,e,f){if((e=d.plugins[e])&&d.element[0].parentNode)for(var g=0;g<e.length;g++)d.options[e[g][0]]&&e[g][1].apply(d.element,f)}},contains:function(d,
e){return document.compareDocumentPosition?d.compareDocumentPosition(e)&16:d!==e&&d.contains(e)},hasScroll:function(d,e){if(a(d).css("overflow")==="hidden")return false;var f=e&&e==="left"?"scrollLeft":"scrollTop",g=false;if(d[f]>0)return true;d[f]=1;g=d[f]>0;d[f]=0;return g},isOverAxis:function(d,e,f){return d>e&&d<e+f},isOver:function(d,e,f,g,i,l){return a.ui.isOverAxis(d,f,i)&&a.ui.isOverAxis(e,g,l)},keyCode:{ALT:18,BACKSPACE:8,CAPS_LOCK:20,COMMA:188,COMMAND:91,COMMAND_LEFT:91,COMMAND_RIGHT:93,
CONTROL:17,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,INSERT:45,LEFT:37,MENU:93,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SHIFT:16,SPACE:32,TAB:9,UP:38,WINDOWS:91}});a.fn.extend({_focus:a.fn.focus,focus:function(d,e){return typeof d==="number"?this.each(function(){var f=this;setTimeout(function(){a(f).focus();e&&e.call(f)},d)}):this._focus.apply(this,arguments)},enableSelection:function(){return this.attr("unselectable",
"off").css("MozUserSelect","")},disableSelection:function(){return this.attr("unselectable","on").css("MozUserSelect","none")},scrollParent:function(){var d;d=a.browser.msie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test(a.curCSS(this,"position",1))&&/(auto|scroll)/.test(a.curCSS(this,"overflow",1)+a.curCSS(this,"overflow-y",1)+a.curCSS(this,"overflow-x",1))}).eq(0):this.parents().filter(function(){return/(auto|scroll)/.test(a.curCSS(this,
"overflow",1)+a.curCSS(this,"overflow-y",1)+a.curCSS(this,"overflow-x",1))}).eq(0);return/fixed/.test(this.css("position"))||!d.length?a(document):d},zIndex:function(d){if(d!==b)return this.css("zIndex",d);if(this.length){d=a(this[0]);for(var e;d.length&&d[0]!==document;){e=d.css("position");if(e==="absolute"||e==="relative"||e==="fixed"){e=parseInt(d.css("zIndex"));if(!isNaN(e)&&e!=0)return e}d=d.parent()}}return 0}});a.each(["Width","Height"],function(d,e){function f(m,p,q,r){a.each(g,function(){p-=
parseFloat(a.curCSS(m,"padding"+this,true))||0;if(q)p-=parseFloat(a.curCSS(m,"border"+this+"Width",true))||0;if(r)p-=parseFloat(a.curCSS(m,"margin"+this,true))||0});return p}var g=e==="Width"?["Left","Right"]:["Top","Bottom"],i=e.toLowerCase(),l={innerWidth:a.fn.innerWidth,innerHeight:a.fn.innerHeight,outerWidth:a.fn.outerWidth,outerHeight:a.fn.outerHeight};a.fn["inner"+e]=function(m){if(m===b)return l["inner"+e].call(this);return this.each(function(){a.style(this,i,f(this,m)+"px")})};a.fn["outer"+
e]=function(m,p){if(typeof m!=="number")return l["outer"+e].call(this,m);return this.each(function(){a.style(this,i,f(this,m,true,p)+"px")})}});a.extend(a.expr[":"],{data:function(d,e,f){return!!a.data(d,f[3])},focusable:function(d){var e=d.nodeName.toLowerCase(),f=a.attr(d,"tabindex");if("area"===e){e=d.parentNode;f=e.name;if(!d.href||!f||e.nodeName.toLowerCase()!=="map")return false;d=a("img[usemap=#"+f+"]")[0];return!!d&&c(d)}return(/input|select|textarea|button|object/.test(e)?!d.disabled:"a"==
e?d.href||!isNaN(f):!isNaN(f))&&c(d)},tabbable:function(d){var e=a.attr(d,"tabindex");return(isNaN(e)||e>=0)&&a(d).is(":focusable")}})}})(jQuery);
(function(a,b){var c=a.fn.remove;a.fn.remove=function(d,e){return this.each(function(){if(!e)if(!d||a.filter(d,[this]).length)a("*",this).add([this]).each(function(){a(this).triggerHandler("remove")});return c.call(a(this),d,e)})};a.widget=function(d,e,f){var g=d.split(".")[0],i;d=d.split(".")[1];i=g+"-"+d;if(!f){f=e;e=a.Widget}a.expr[":"][i]=function(l){return!!a.data(l,d)};a[g]=a[g]||{};a[g][d]=function(l,m){arguments.length&&this._createWidget(l,m)};e=new e;e.options=a.extend(true,{},e.options);
a[g][d].prototype=a.extend(true,e,{namespace:g,widgetName:d,widgetEventPrefix:a[g][d].prototype.widgetEventPrefix||d,widgetBaseClass:i},f);a.widget.bridge(d,a[g][d])};a.widget.bridge=function(d,e){a.fn[d]=function(f){var g=typeof f==="string",i=Array.prototype.slice.call(arguments,1),l=this;f=!g&&i.length?a.extend.apply(null,[true,f].concat(i)):f;if(g&&f.substring(0,1)==="_")return l;g?this.each(function(){var m=a.data(this,d),p=m&&a.isFunction(m[f])?m[f].apply(m,i):m;if(p!==m&&p!==b){l=p;return false}}):
this.each(function(){var m=a.data(this,d);if(m){f&&m.option(f);m._init()}else a.data(this,d,new e(f,this))});return l}};a.Widget=function(d,e){arguments.length&&this._createWidget(d,e)};a.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",options:{disabled:false},_createWidget:function(d,e){a.data(e,this.widgetName,this);this.element=a(e);this.options=a.extend(true,{},this.options,a.metadata&&a.metadata.get(e)[this.widgetName],d);var f=this;this.element.bind("remove."+this.widgetName,function(){f.destroy()});
this._create();this._init()},_create:function(){},_init:function(){},destroy:function(){this.element.unbind("."+this.widgetName).removeData(this.widgetName);this.widget().unbind("."+this.widgetName).removeAttr("aria-disabled").removeClass(this.widgetBaseClass+"-disabled ui-state-disabled")},widget:function(){return this.element},option:function(d,e){var f=d,g=this;if(arguments.length===0)return a.extend({},g.options);if(typeof d==="string"){if(e===b)return this.options[d];f={};f[d]=e}a.each(f,function(i,
l){g._setOption(i,l)});return g},_setOption:function(d,e){this.options[d]=e;if(d==="disabled")this.widget()[e?"addClass":"removeClass"](this.widgetBaseClass+"-disabled ui-state-disabled").attr("aria-disabled",e);return this},enable:function(){return this._setOption("disabled",false)},disable:function(){return this._setOption("disabled",true)},_trigger:function(d,e,f){var g=this.options[d];e=a.Event(e);e.type=(d===this.widgetEventPrefix?d:this.widgetEventPrefix+d).toLowerCase();f=f||{};if(e.originalEvent){d=
a.event.props.length;for(var i;d;){i=a.event.props[--d];e[i]=e.originalEvent[i]}}this.element.trigger(e,f);return!(a.isFunction(g)&&g.call(this.element[0],e,f)===false||e.isDefaultPrevented())}}})(jQuery);
(function(a){a.widget("ui.mouse",{options:{cancel:":input,option",distance:1,delay:0},_mouseInit:function(){var b=this;this.element.bind("mousedown."+this.widgetName,function(c){return b._mouseDown(c)}).bind("click."+this.widgetName,function(c){if(b._preventClickEvent){b._preventClickEvent=false;c.stopImmediatePropagation();return false}});this.started=false},_mouseDestroy:function(){this.element.unbind("."+this.widgetName)},_mouseDown:function(b){b.originalEvent=b.originalEvent||{};if(!b.originalEvent.mouseHandled){this._mouseStarted&&
this._mouseUp(b);this._mouseDownEvent=b;var c=this,d=b.which==1,e=typeof this.options.cancel=="string"?a(b.target).parents().add(b.target).filter(this.options.cancel).length:false;if(!d||e||!this._mouseCapture(b))return true;this.mouseDelayMet=!this.options.delay;if(!this.mouseDelayMet)this._mouseDelayTimer=setTimeout(function(){c.mouseDelayMet=true},this.options.delay);if(this._mouseDistanceMet(b)&&this._mouseDelayMet(b)){this._mouseStarted=this._mouseStart(b)!==false;if(!this._mouseStarted){b.preventDefault();
return true}}this._mouseMoveDelegate=function(f){return c._mouseMove(f)};this._mouseUpDelegate=function(f){return c._mouseUp(f)};a(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate);a.browser.safari||b.preventDefault();return b.originalEvent.mouseHandled=true}},_mouseMove:function(b){if(a.browser.msie&&!b.button)return this._mouseUp(b);if(this._mouseStarted){this._mouseDrag(b);return b.preventDefault()}if(this._mouseDistanceMet(b)&&
this._mouseDelayMet(b))(this._mouseStarted=this._mouseStart(this._mouseDownEvent,b)!==false)?this._mouseDrag(b):this._mouseUp(b);return!this._mouseStarted},_mouseUp:function(b){a(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate);if(this._mouseStarted){this._mouseStarted=false;this._preventClickEvent=b.target==this._mouseDownEvent.target;this._mouseStop(b)}return false},_mouseDistanceMet:function(b){return Math.max(Math.abs(this._mouseDownEvent.pageX-
b.pageX),Math.abs(this._mouseDownEvent.pageY-b.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return true}})})(jQuery);
(function(a){a.ui=a.ui||{};var b=/left|center|right/,c=/top|center|bottom/,d=a.fn.position,e=a.fn.offset;a.fn.position=function(f){if(!f||!f.of)return d.apply(this,arguments);f=a.extend({},f);var g=a(f.of),i=(f.collision||"flip").split(" "),l=f.offset?f.offset.split(" "):[0,0],m,p,q;if(f.of.nodeType===9){m=g.width();p=g.height();q={top:0,left:0}}else if(f.of.scrollTo&&f.of.document){m=g.width();p=g.height();q={top:g.scrollTop(),left:g.scrollLeft()}}else if(f.of.preventDefault){f.at="left top";m=p=
0;q={top:f.of.pageY,left:f.of.pageX}}else{m=g.outerWidth();p=g.outerHeight();q=g.offset()}a.each(["my","at"],function(){var r=(f[this]||"").split(" ");if(r.length===1)r=b.test(r[0])?r.concat(["center"]):c.test(r[0])?["center"].concat(r):["center","center"];r[0]=b.test(r[0])?r[0]:"center";r[1]=c.test(r[1])?r[1]:"center";f[this]=r});if(i.length===1)i[1]=i[0];l[0]=parseInt(l[0],10)||0;if(l.length===1)l[1]=l[0];l[1]=parseInt(l[1],10)||0;if(f.at[0]==="right")q.left+=m;else if(f.at[0]==="center")q.left+=
m/2;if(f.at[1]==="bottom")q.top+=p;else if(f.at[1]==="center")q.top+=p/2;q.left+=l[0];q.top+=l[1];return this.each(function(){var r=a(this),t=r.outerWidth(),h=r.outerHeight(),j=a.extend({},q);if(f.my[0]==="right")j.left-=t;else if(f.my[0]==="center")j.left-=t/2;if(f.my[1]==="bottom")j.top-=h;else if(f.my[1]==="center")j.top-=h/2;j.left=parseInt(j.left);j.top=parseInt(j.top);a.each(["left","top"],function(n,o){a.ui.position[i[n]]&&a.ui.position[i[n]][o](j,{targetWidth:m,targetHeight:p,elemWidth:t,
elemHeight:h,offset:l,my:f.my,at:f.at})});a.fn.bgiframe&&r.bgiframe();r.offset(a.extend(j,{using:f.using}))})};a.ui.position={fit:{left:function(f,g){var i=a(window);i=f.left+g.elemWidth-i.width()-i.scrollLeft();f.left=i>0?f.left-i:Math.max(0,f.left)},top:function(f,g){var i=a(window);i=f.top+g.elemHeight-i.height()-i.scrollTop();f.top=i>0?f.top-i:Math.max(0,f.top)}},flip:{left:function(f,g){if(g.at[0]!=="center"){var i=a(window);i=f.left+g.elemWidth-i.width()-i.scrollLeft();var l=g.my[0]==="left"?
-g.elemWidth:g.my[0]==="right"?g.elemWidth:0,m=-2*g.offset[0];f.left+=f.left<0?l+g.targetWidth+m:i>0?l-g.targetWidth+m:0}},top:function(f,g){if(g.at[1]!=="center"){var i=a(window);i=f.top+g.elemHeight-i.height()-i.scrollTop();var l=g.my[1]==="top"?-g.elemHeight:g.my[1]==="bottom"?g.elemHeight:0,m=g.at[1]==="top"?g.targetHeight:-g.targetHeight,p=-2*g.offset[1];f.top+=f.top<0?l+g.targetHeight+p:i>0?l+m+p:0}}}};if(!a.offset.setOffset){a.offset.setOffset=function(f,g){if(/static/.test(a.curCSS(f,"position")))f.style.position=
"relative";var i=a(f),l=i.offset(),m=parseInt(a.curCSS(f,"top",true),10)||0,p=parseInt(a.curCSS(f,"left",true),10)||0;l={top:g.top-l.top+m,left:g.left-l.left+p};"using"in g?g.using.call(f,l):i.css(l)};a.fn.offset=function(f){var g=this[0];if(!g||!g.ownerDocument)return null;if(f)return this.each(function(){a.offset.setOffset(this,f)});return e.call(this)}}})(jQuery);window.freebase=window.fb={mwLWTReloading:false};if(typeof SERVER==="object"&&SERVER.acre)window.fb.acre=SERVER.acre;
(function(a,b){if(a.cookie("mwLWTReloaded"))a.cookie("mwLWTReloaded",null,{path:"/"});else{var c=0,d=0;if(typeof b.acre==="object"&&b.acre&&b.acre.mwLastWriteTime)d=b.acre.mwLastWriteTime||0;if(document.cookie&&document.cookie!="")for(var e=document.cookie.split(";"),f=0,g=e.length;f<g;f++){var i=a.trim(e[f]);if(i.indexOf("mwLastWriteTime=")===0){i=decodeURIComponent(i.substring(16)).split("|");if(i.length)c=i[0]}}e=c?parseInt(c,10):-1;f=d?parseInt(d,10):-1;if(c&&d&&f<e){a.cookie("mwLWTReloaded",
"true",{path:"/"});b.mwLWTReloading=true;window.location.reload(true)}}})(jQuery,window.freebase);
(function(a,b){if(!b.mwLWTReloading){if(!window.console)window.console={log:a.noop,info:a.noop,debug:a.noop,warn:a.noop,error:a.noop};b.dispatch=function(i,l,m,p){if(typeof l!=="function")return false;i=a.event.fix(i||window.event);m||(m=[]);p||(p=this);return l.apply(p,[i].concat(m))};b.get_script=function(i,l){var m=b.get_script.cache,p=m[i];if(p)if(p.state===1)p.callbacks.push(l);else p.state===4&&l();else{p=m[i]={state:0,callbacks:[l]};a.ajax({url:i,dataType:"script",beforeSend:function(){p.state=
1},success:function(){p.state=4;a.each(p.callbacks,function(q,r){r()})},error:function(){p.state=-1}})}};b.get_script.cache={};a(window).bind("fb.user.signedin",function(i,l){console.log("fb.user.signnedin");b.user=l;var m=a("#nav-username a:first");if(m.length){m[0].href+=b.user.id;m.text(b.user.name)}a("#signedin").show()}).bind("fb.user.signedout",function(){console.log("fb.user.signedout");a("#signedout").show()});if(/^https?\:\/\/((www|devel)\.)?(freebase|sandbox\-freebase|branch\.qa\.metaweb|trunk\.qa\.metaweb)\.com(\:\d+)?/.test(b.acre.request.app_url)){var c=
function(i,l){var m=i.indexOf("|"+l+"_");if(m!=-1){m=m+2+l.length;var p=i.indexOf("|",m);if(p!=-1)return decodeURIComponent(i.substr(m,p-m))}return null},d=a.cookie("metaweb-user-info");if(d){var e=c(d,"g"),f=c(d,"u"),g=c(d,"p");g||(g="/user/"+this.name);setTimeout(function(){a(window).trigger("fb.user.signedin",{guid:e,name:f,id:g})},0)}else setTimeout(function(){a(window).trigger("fb.user.signedout")},0)}else a.ajax({url:"/acre/account/user_info",dataType:"json",success:function(i){i&&i.code===
"/api/status/ok"?a(window).trigger("fb.user.signedin",{id:i.id,guid:i.guid,name:i.username}):a(window).trigger("fb.user.signedout")},error:function(){a(window).trigger("fb.user.signedout")}});a(function(){var i=a("#SearchBox .SearchBox-input,#global-search-input"),l=b.acre.freebase.site_host;i.suggest({service_url:l,soft:true,category:"object",parent:"#site-search-box",align:"right",status:null});var m=a("#site-search-label"),p=a("#site-search-box .fbs-pane");i.bind("fb-select",function(q,r){window.location=
l+"/view"+r.id;return false}).bind("fb-pane-show",function(){m.html("<span>Select an item from the list</span>").removeClass("loading")}).bind("fb-textchange",function(){a.trim(i.val())===""?m.html("<span>Start typing to get some suggestions</span>").removeClass("loading"):m.html("<span>Searching...</span>").addClass("loading")}).bind("fb-error",function(){m.html("<span>Sorry, something went wrong. Please try again later</span>").removeClass("loading")}).focus(function(){m.is(":visible")||a("#site-search-label").slideDown("fast")}).blur(function(){!p.is(":visible")&&
m.is(":visible")&&a("#site-search-label").slideUp("fast")});a(".SearchBox-form").submit(function(){return a.trim(a("#global-search-input").val()).length==0?false:true});a("input, textarea").placeholder()});b.disable=function(i){a(i).attr("disabled","disabled").addClass("disabled")};b.enable=function(i){a(i).removeAttr("disabled").removeClass("disabled")};b.lang_select=function(i,l){setTimeout(function(){a(window).trigger("fb.lang.select",l)},0)};b.devbar={div:a("#devbar"),keydown:function(i){if(i.keyCode==
119||i.keyCode==123||i.keyCode==68&&i.shiftKey&&i.ctrlKey)b.devbar.toggle();return true},toggle:function(){if(b.devbar.div.is(":visible")){b.devbar.div.hide();a.localstore("devbar2",false)}else{b.devbar.div.show();a.localstore("devbar2",true)}return false},touch:function(){/^https?\:\/\/((www|devel)\.)?(freebase|sandbox\-freebase|branch\.qa\.metaweb|trunk\.qa\.metaweb)\.com(\:\d+)?/.test(b.acre.request.app_url)?a.ajax({url:b.acre.freebase.service_url+"/api/service/touch",dataType:"jsonp"}):a.ajax({url:"/acre/touch"});
return false},txn_ids:[],txn:function(){return b.devbar.view_txn(this.href,b.devbar.txn_ids)},view_txn:function(i,l){if(l&&l.length)window.location=i+"?"+a.param({tid:l},true);return false},ajaxComplete:function(i){if(i&&i.readyState===4)(i=i.getResponseHeader("x-metaweb-tid"))&&b.devbar.txn_ids.push(i)},init:function(){a.localstore("devbar2")?b.devbar.div.show():b.devbar.div.hide();a(document).keydown(b.devbar.keydown);a("#devbar-toggle > a").click(b.devbar.toggle);a("#devbar-touch > a").click(b.devbar.touch);
b.acre.tid&&b.devbar.txn_ids.push(b.acre.tid);a("#devbar-txn > a").click(b.devbar.txn);a.ajaxSetup({complete:b.devbar.ajaxComplete})}};b.devbar.init()}})(jQuery,window.freebase);
(function(a){function b(e,f,g){var i=this,l=e.add(this),m=e.find(g.tabs),p=f.jquery?f:e.children(f),q;m.length||(m=e.children());p.length||(p=e.parent().find(f));p.length||(p=a(f));a.extend(this,{click:function(r,t){var h=m.eq(r);if(typeof r=="string"&&r.replace("#","")){h=m.filter("[href*="+r.replace("#","")+"]");r=Math.max(m.index(h),0)}if(g.rotate){var j=m.length-1;if(r<0)return i.click(j,t);if(r>j)return i.click(0,t)}if(!h.length){if(q>=0)return i;r=g.initialIndex;h=m.eq(r)}if(r===q)return i;
t=t||a.Event();t.type="onBeforeClick";l.trigger(t,[r]);if(!t.isDefaultPrevented()){c[g.effect].call(i,r,function(){t.type="onClick";l.trigger(t,[r])});q=r;m.removeClass(g.current);h.addClass(g.current);return i}},getConf:function(){return g},getTabs:function(){return m},getPanes:function(){return p},getCurrentPane:function(){return p.eq(q)},getCurrentTab:function(){return m.eq(q)},getIndex:function(){return q},next:function(){return i.click(q+1)},prev:function(){return i.click(q-1)},destroy:function(){m.unbind(g.event).removeClass(g.current);
p.find("a[href^=#]").unbind("click.T");return i}});a.each("onBeforeClick,onClick".split(","),function(r,t){a.isFunction(g[t])&&a(i).bind(t,g[t]);i[t]=function(h){a(i).bind(t,h);return i}});if(g.history&&a.fn.history){a.tools.history.init(m);g.event="history"}m.each(function(r){a(this).bind(g.event,function(t){i.click(r,t);return t.preventDefault()})});p.find("a[href^=#]").bind("click.T",function(r){i.click(a(this).attr("href"),r)});if(location.hash)i.click(location.hash);else if(g.initialIndex===
0||g.initialIndex>0)i.click(g.initialIndex)}a.tools=a.tools||{version:"@VERSION"};a.tools.tabs={conf:{tabs:"a",current:"current",onBeforeClick:null,onClick:null,effect:"default",initialIndex:0,event:"click",rotate:false,history:false},addEffect:function(e,f){c[e]=f}};var c={"default":function(e,f){this.getPanes().hide().eq(e).show();f.call()},fade:function(e,f){var g=this.getConf(),i=g.fadeOutSpeed,l=this.getPanes();i?l.fadeOut(i):l.hide();l.eq(e).fadeIn(g.fadeInSpeed,f)},slide:function(e,f){this.getPanes().slideUp(200);
this.getPanes().eq(e).slideDown(400,f)},ajax:function(e,f){this.getPanes().eq(0).load(this.getTabs().eq(e).attr("href"),f)}},d;a.tools.tabs.addEffect("horizontal",function(e,f){d||(d=this.getPanes().eq(0).width());this.getCurrentPane().animate({width:0},function(){a(this).hide()});this.getPanes().eq(e).animate({width:d},function(){a(this).show();f.call()})});a.fn.tabs=function(e,f){var g=this.data("tabs");if(g){g.destroy();this.removeData("tabs")}if(a.isFunction(f))f={onBeforeClick:f};f=a.extend({},
a.tools.tabs.conf,f);this.each(function(){g=new b(a(this),e,f);a(this).data("tabs",g)});return f.api?g:this}})(jQuery);
(function(a){a.widget("ui.draggable",a.ui.mouse,{widgetEventPrefix:"drag",options:{addClasses:true,appendTo:"parent",axis:false,connectToSortable:false,containment:false,cursor:"auto",cursorAt:false,grid:false,handle:false,helper:"original",iframeFix:false,opacity:false,refreshPositions:false,revert:false,revertDuration:500,scope:"default",scroll:true,scrollSensitivity:20,scrollSpeed:20,snap:false,snapMode:"both",snapTolerance:20,stack:false,zIndex:false},_create:function(){if(this.options.helper==
"original"&&!/^(?:r|a|f)/.test(this.element.css("position")))this.element[0].style.position="relative";this.options.addClasses&&this.element.addClass("ui-draggable");this.options.disabled&&this.element.addClass("ui-draggable-disabled");this._mouseInit()},destroy:function(){if(this.element.data("draggable")){this.element.removeData("draggable").unbind(".draggable").removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled");this._mouseDestroy();return this}},_mouseCapture:function(b){var c=
this.options;if(this.helper||c.disabled||a(b.target).is(".ui-resizable-handle"))return false;this.handle=this._getHandle(b);if(!this.handle)return false;return true},_mouseStart:function(b){var c=this.options;this.helper=this._createHelper(b);this._cacheHelperProportions();if(a.ui.ddmanager)a.ui.ddmanager.current=this;this._cacheMargins();this.cssPosition=this.helper.css("position");this.scrollParent=this.helper.scrollParent();this.offset=this.positionAbs=this.element.offset();this.offset={top:this.offset.top-
this.margins.top,left:this.offset.left-this.margins.left};a.extend(this.offset,{click:{left:b.pageX-this.offset.left,top:b.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()});this.originalPosition=this.position=this._generatePosition(b);this.originalPageX=b.pageX;this.originalPageY=b.pageY;c.cursorAt&&this._adjustOffsetFromHelper(c.cursorAt);c.containment&&this._setContainment();if(this._trigger("start",b)===false){this._clear();return false}this._cacheHelperProportions();
a.ui.ddmanager&&!c.dropBehaviour&&a.ui.ddmanager.prepareOffsets(this,b);this.helper.addClass("ui-draggable-dragging");this._mouseDrag(b,true);return true},_mouseDrag:function(b,c){this.position=this._generatePosition(b);this.positionAbs=this._convertPositionTo("absolute");if(!c){var d=this._uiHash();if(this._trigger("drag",b,d)===false){this._mouseUp({});return false}this.position=d.position}if(!this.options.axis||this.options.axis!="y")this.helper[0].style.left=this.position.left+"px";if(!this.options.axis||
this.options.axis!="x")this.helper[0].style.top=this.position.top+"px";a.ui.ddmanager&&a.ui.ddmanager.drag(this,b);return false},_mouseStop:function(b){var c=false;if(a.ui.ddmanager&&!this.options.dropBehaviour)c=a.ui.ddmanager.drop(this,b);if(this.dropped){c=this.dropped;this.dropped=false}if(!this.element[0]||!this.element[0].parentNode)return false;if(this.options.revert=="invalid"&&!c||this.options.revert=="valid"&&c||this.options.revert===true||a.isFunction(this.options.revert)&&this.options.revert.call(this.element,
c)){var d=this;a(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){d._trigger("stop",b)!==false&&d._clear()})}else this._trigger("stop",b)!==false&&this._clear();return false},cancel:function(){this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear();return this},_getHandle:function(b){var c=!this.options.handle||!a(this.options.handle,this.element).length?true:false;a(this.options.handle,this.element).find("*").andSelf().each(function(){if(this==
b.target)c=true});return c},_createHelper:function(b){var c=this.options;b=a.isFunction(c.helper)?a(c.helper.apply(this.element[0],[b])):c.helper=="clone"?this.element.clone():this.element;b.parents("body").length||b.appendTo(c.appendTo=="parent"?this.element[0].parentNode:c.appendTo);b[0]!=this.element[0]&&!/(fixed|absolute)/.test(b.css("position"))&&b.css("position","absolute");return b},_adjustOffsetFromHelper:function(b){if(typeof b=="string")b=b.split(" ");if(a.isArray(b))b={left:+b[0],top:+b[1]||
0};if("left"in b)this.offset.click.left=b.left+this.margins.left;if("right"in b)this.offset.click.left=this.helperProportions.width-b.right+this.margins.left;if("top"in b)this.offset.click.top=b.top+this.margins.top;if("bottom"in b)this.offset.click.top=this.helperProportions.height-b.bottom+this.margins.top},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var b=this.offsetParent.offset();if(this.cssPosition=="absolute"&&this.scrollParent[0]!=document&&a.ui.contains(this.scrollParent[0],
this.offsetParent[0])){b.left+=this.scrollParent.scrollLeft();b.top+=this.scrollParent.scrollTop()}if(this.offsetParent[0]==document.body||this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()=="html"&&a.browser.msie)b={top:0,left:0};return{top:b.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:b.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if(this.cssPosition=="relative"){var b=this.element.position();return{top:b.top-
(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:b.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}else return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var b=this.options;if(b.containment==
"parent")b.containment=this.helper[0].parentNode;if(b.containment=="document"||b.containment=="window")this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,a(b.containment=="document"?document:window).width()-this.helperProportions.width-this.margins.left,(a(b.containment=="document"?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];if(!/^(document|window|parent)$/.test(b.containment)&&
b.containment.constructor!=Array){var c=a(b.containment)[0];if(c){b=a(b.containment).offset();var d=a(c).css("overflow")!="hidden";this.containment=[b.left+(parseInt(a(c).css("borderLeftWidth"),10)||0)+(parseInt(a(c).css("paddingLeft"),10)||0)-this.margins.left,b.top+(parseInt(a(c).css("borderTopWidth"),10)||0)+(parseInt(a(c).css("paddingTop"),10)||0)-this.margins.top,b.left+(d?Math.max(c.scrollWidth,c.offsetWidth):c.offsetWidth)-(parseInt(a(c).css("borderLeftWidth"),10)||0)-(parseInt(a(c).css("paddingRight"),
10)||0)-this.helperProportions.width-this.margins.left,b.top+(d?Math.max(c.scrollHeight,c.offsetHeight):c.offsetHeight)-(parseInt(a(c).css("borderTopWidth"),10)||0)-(parseInt(a(c).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top]}}else if(b.containment.constructor==Array)this.containment=b.containment},_convertPositionTo:function(b,c){if(!c)c=this.position;var d=b=="absolute"?1:-1,e=this.cssPosition=="absolute"&&!(this.scrollParent[0]!=document&&a.ui.contains(this.scrollParent[0],
this.offsetParent[0]))?this.offsetParent:this.scrollParent,f=/(html|body)/i.test(e[0].tagName);return{top:c.top+this.offset.relative.top*d+this.offset.parent.top*d-(a.browser.safari&&a.browser.version<526&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollTop():f?0:e.scrollTop())*d),left:c.left+this.offset.relative.left*d+this.offset.parent.left*d-(a.browser.safari&&a.browser.version<526&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():
f?0:e.scrollLeft())*d)}},_generatePosition:function(b){var c=this.options,d=this.cssPosition=="absolute"&&!(this.scrollParent[0]!=document&&a.ui.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,e=/(html|body)/i.test(d[0].tagName),f=b.pageX,g=b.pageY;if(this.originalPosition){if(this.containment){if(b.pageX-this.offset.click.left<this.containment[0])f=this.containment[0]+this.offset.click.left;if(b.pageY-this.offset.click.top<this.containment[1])g=this.containment[1]+
this.offset.click.top;if(b.pageX-this.offset.click.left>this.containment[2])f=this.containment[2]+this.offset.click.left;if(b.pageY-this.offset.click.top>this.containment[3])g=this.containment[3]+this.offset.click.top}if(c.grid){g=this.originalPageY+Math.round((g-this.originalPageY)/c.grid[1])*c.grid[1];g=this.containment?!(g-this.offset.click.top<this.containment[1]||g-this.offset.click.top>this.containment[3])?g:!(g-this.offset.click.top<this.containment[1])?g-c.grid[1]:g+c.grid[1]:g;f=this.originalPageX+
Math.round((f-this.originalPageX)/c.grid[0])*c.grid[0];f=this.containment?!(f-this.offset.click.left<this.containment[0]||f-this.offset.click.left>this.containment[2])?f:!(f-this.offset.click.left<this.containment[0])?f-c.grid[0]:f+c.grid[0]:f}}return{top:g-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(a.browser.safari&&a.browser.version<526&&this.cssPosition=="fixed"?0:this.cssPosition=="fixed"?-this.scrollParent.scrollTop():e?0:d.scrollTop()),left:f-this.offset.click.left-
this.offset.relative.left-this.offset.parent.left+(a.browser.safari&&a.browser.version<526&&this.cssPosition=="fixed"?0:this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():e?0:d.scrollLeft())}},_clear:function(){this.helper.removeClass("ui-draggable-dragging");this.helper[0]!=this.element[0]&&!this.cancelHelperRemoval&&this.helper.remove();this.helper=null;this.cancelHelperRemoval=false},_trigger:function(b,c,d){d=d||this._uiHash();a.ui.plugin.call(this,b,[c,d]);if(b=="drag")this.positionAbs=
this._convertPositionTo("absolute");return a.Widget.prototype._trigger.call(this,b,c,d)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}});a.extend(a.ui.draggable,{version:"1.8.4"});a.ui.plugin.add("draggable","connectToSortable",{start:function(b,c){var d=a(this).data("draggable"),e=d.options,f=a.extend({},c,{item:d.element});d.sortables=[];a(e.connectToSortable).each(function(){var g=a.data(this,"sortable");
if(g&&!g.options.disabled){d.sortables.push({instance:g,shouldRevert:g.options.revert});g._refreshItems();g._trigger("activate",b,f)}})},stop:function(b,c){var d=a(this).data("draggable"),e=a.extend({},c,{item:d.element});a.each(d.sortables,function(){if(this.instance.isOver){this.instance.isOver=0;d.cancelHelperRemoval=true;this.instance.cancelHelperRemoval=false;if(this.shouldRevert)this.instance.options.revert=true;this.instance._mouseStop(b);this.instance.options.helper=this.instance.options._helper;
d.options.helper=="original"&&this.instance.currentItem.css({top:"auto",left:"auto"})}else{this.instance.cancelHelperRemoval=false;this.instance._trigger("deactivate",b,e)}})},drag:function(b,c){var d=a(this).data("draggable"),e=this;a.each(d.sortables,function(){this.instance.positionAbs=d.positionAbs;this.instance.helperProportions=d.helperProportions;this.instance.offset.click=d.offset.click;if(this.instance._intersectsWith(this.instance.containerCache)){if(!this.instance.isOver){this.instance.isOver=
1;this.instance.currentItem=a(e).clone().appendTo(this.instance.element).data("sortable-item",true);this.instance.options._helper=this.instance.options.helper;this.instance.options.helper=function(){return c.helper[0]};b.target=this.instance.currentItem[0];this.instance._mouseCapture(b,true);this.instance._mouseStart(b,true,true);this.instance.offset.click.top=d.offset.click.top;this.instance.offset.click.left=d.offset.click.left;this.instance.offset.parent.left-=d.offset.parent.left-this.instance.offset.parent.left;
this.instance.offset.parent.top-=d.offset.parent.top-this.instance.offset.parent.top;d._trigger("toSortable",b);d.dropped=this.instance.element;d.currentItem=d.element;this.instance.fromOutside=d}this.instance.currentItem&&this.instance._mouseDrag(b)}else if(this.instance.isOver){this.instance.isOver=0;this.instance.cancelHelperRemoval=true;this.instance.options.revert=false;this.instance._trigger("out",b,this.instance._uiHash(this.instance));this.instance._mouseStop(b,true);this.instance.options.helper=
this.instance.options._helper;this.instance.currentItem.remove();this.instance.placeholder&&this.instance.placeholder.remove();d._trigger("fromSortable",b);d.dropped=false}})}});a.ui.plugin.add("draggable","cursor",{start:function(){var b=a("body"),c=a(this).data("draggable").options;if(b.css("cursor"))c._cursor=b.css("cursor");b.css("cursor",c.cursor)},stop:function(){var b=a(this).data("draggable").options;b._cursor&&a("body").css("cursor",b._cursor)}});a.ui.plugin.add("draggable","iframeFix",{start:function(){var b=
a(this).data("draggable").options;a(b.iframeFix===true?"iframe":b.iframeFix).each(function(){a('<div class="ui-draggable-iframeFix" style="background: #fff;"></div>').css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1E3}).css(a(this).offset()).appendTo("body")})},stop:function(){a("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)})}});a.ui.plugin.add("draggable","opacity",{start:function(b,c){var d=a(c.helper),
e=a(this).data("draggable").options;if(d.css("opacity"))e._opacity=d.css("opacity");d.css("opacity",e.opacity)},stop:function(b,c){var d=a(this).data("draggable").options;d._opacity&&a(c.helper).css("opacity",d._opacity)}});a.ui.plugin.add("draggable","scroll",{start:function(){var b=a(this).data("draggable");if(b.scrollParent[0]!=document&&b.scrollParent[0].tagName!="HTML")b.overflowOffset=b.scrollParent.offset()},drag:function(b){var c=a(this).data("draggable"),d=c.options,e=false;if(c.scrollParent[0]!=
document&&c.scrollParent[0].tagName!="HTML"){if(!d.axis||d.axis!="x")if(c.overflowOffset.top+c.scrollParent[0].offsetHeight-b.pageY<d.scrollSensitivity)c.scrollParent[0].scrollTop=e=c.scrollParent[0].scrollTop+d.scrollSpeed;else if(b.pageY-c.overflowOffset.top<d.scrollSensitivity)c.scrollParent[0].scrollTop=e=c.scrollParent[0].scrollTop-d.scrollSpeed;if(!d.axis||d.axis!="y")if(c.overflowOffset.left+c.scrollParent[0].offsetWidth-b.pageX<d.scrollSensitivity)c.scrollParent[0].scrollLeft=e=c.scrollParent[0].scrollLeft+
d.scrollSpeed;else if(b.pageX-c.overflowOffset.left<d.scrollSensitivity)c.scrollParent[0].scrollLeft=e=c.scrollParent[0].scrollLeft-d.scrollSpeed}else{if(!d.axis||d.axis!="x")if(b.pageY-a(document).scrollTop()<d.scrollSensitivity)e=a(document).scrollTop(a(document).scrollTop()-d.scrollSpeed);else if(a(window).height()-(b.pageY-a(document).scrollTop())<d.scrollSensitivity)e=a(document).scrollTop(a(document).scrollTop()+d.scrollSpeed);if(!d.axis||d.axis!="y")if(b.pageX-a(document).scrollLeft()<d.scrollSensitivity)e=
a(document).scrollLeft(a(document).scrollLeft()-d.scrollSpeed);else if(a(window).width()-(b.pageX-a(document).scrollLeft())<d.scrollSensitivity)e=a(document).scrollLeft(a(document).scrollLeft()+d.scrollSpeed)}e!==false&&a.ui.ddmanager&&!d.dropBehaviour&&a.ui.ddmanager.prepareOffsets(c,b)}});a.ui.plugin.add("draggable","snap",{start:function(){var b=a(this).data("draggable"),c=b.options;b.snapElements=[];a(c.snap.constructor!=String?c.snap.items||":data(draggable)":c.snap).each(function(){var d=a(this),
e=d.offset();this!=b.element[0]&&b.snapElements.push({item:this,width:d.outerWidth(),height:d.outerHeight(),top:e.top,left:e.left})})},drag:function(b,c){for(var d=a(this).data("draggable"),e=d.options,f=e.snapTolerance,g=c.offset.left,i=g+d.helperProportions.width,l=c.offset.top,m=l+d.helperProportions.height,p=d.snapElements.length-1;p>=0;p--){var q=d.snapElements[p].left,r=q+d.snapElements[p].width,t=d.snapElements[p].top,h=t+d.snapElements[p].height;if(q-f<g&&g<r+f&&t-f<l&&l<h+f||q-f<g&&g<r+f&&
t-f<m&&m<h+f||q-f<i&&i<r+f&&t-f<l&&l<h+f||q-f<i&&i<r+f&&t-f<m&&m<h+f){if(e.snapMode!="inner"){var j=Math.abs(t-m)<=f,n=Math.abs(h-l)<=f,o=Math.abs(q-i)<=f,s=Math.abs(r-g)<=f;if(j)c.position.top=d._convertPositionTo("relative",{top:t-d.helperProportions.height,left:0}).top-d.margins.top;if(n)c.position.top=d._convertPositionTo("relative",{top:h,left:0}).top-d.margins.top;if(o)c.position.left=d._convertPositionTo("relative",{top:0,left:q-d.helperProportions.width}).left-d.margins.left;if(s)c.position.left=
d._convertPositionTo("relative",{top:0,left:r}).left-d.margins.left}var u=j||n||o||s;if(e.snapMode!="outer"){j=Math.abs(t-l)<=f;n=Math.abs(h-m)<=f;o=Math.abs(q-g)<=f;s=Math.abs(r-i)<=f;if(j)c.position.top=d._convertPositionTo("relative",{top:t,left:0}).top-d.margins.top;if(n)c.position.top=d._convertPositionTo("relative",{top:h-d.helperProportions.height,left:0}).top-d.margins.top;if(o)c.position.left=d._convertPositionTo("relative",{top:0,left:q}).left-d.margins.left;if(s)c.position.left=d._convertPositionTo("relative",
{top:0,left:r-d.helperProportions.width}).left-d.margins.left}if(!d.snapElements[p].snapping&&(j||n||o||s||u))d.options.snap.snap&&d.options.snap.snap.call(d.element,b,a.extend(d._uiHash(),{snapItem:d.snapElements[p].item}));d.snapElements[p].snapping=j||n||o||s||u}else{d.snapElements[p].snapping&&d.options.snap.release&&d.options.snap.release.call(d.element,b,a.extend(d._uiHash(),{snapItem:d.snapElements[p].item}));d.snapElements[p].snapping=false}}}});a.ui.plugin.add("draggable","stack",{start:function(){var b=
a(this).data("draggable").options;b=a.makeArray(a(b.stack)).sort(function(d,e){return(parseInt(a(d).css("zIndex"),10)||0)-(parseInt(a(e).css("zIndex"),10)||0)});if(b.length){var c=parseInt(b[0].style.zIndex)||0;a(b).each(function(d){this.style.zIndex=c+d});this[0].style.zIndex=c+b.length}}});a.ui.plugin.add("draggable","zIndex",{start:function(b,c){var d=a(c.helper),e=a(this).data("draggable").options;if(d.css("zIndex"))e._zIndex=d.css("zIndex");d.css("zIndex",e.zIndex)},stop:function(b,c){var d=
a(this).data("draggable").options;d._zIndex&&a(c.helper).css("zIndex",d._zIndex)}})})(jQuery);
shortcut={all_shortcuts:{},add:function(a,b,c){var d={type:"keydown",propagate:false,disable_in_input:false,target:document,keycode:false};if(c)for(var e in d){if(typeof c[e]=="undefined")c[e]=d[e]}else c=d;d=c.target;if(typeof c.target=="string")d=document.getElementById(c.target);a=a.toLowerCase();e=function(f){f=f||window.event;if(c.disable_in_input){var g;if(f.target)g=f.target;else if(f.srcElement)g=f.srcElement;if(g.nodeType==3)g=g.parentNode;if(g.tagName=="INPUT"||g.tagName=="TEXTAREA")return}if(f.keyCode)code=
f.keyCode;else if(f.which)code=f.which;g=String.fromCharCode(code).toLowerCase();if(code==188)g=",";if(code==190)g=".";var i=a.split("-"),l=0,m={"`":"~","1":"!","2":"@","3":"#","4":"$","5":"%","6":"^","7":"&","8":"*","9":"(","0":")","-":"_","=":"+",";":":","'":'"',",":"<",".":">","/":"?","\\":"|"},p={esc:27,escape:27,tab:9,space:32,"return":13,enter:13,backspace:8,scrolllock:145,scroll_lock:145,scroll:145,capslock:20,caps_lock:20,caps:20,numlock:144,num_lock:144,num:144,pause:19,"break":19,insert:45,
home:36,"delete":46,end:35,pageup:33,page_up:33,pu:33,pagedown:34,page_down:34,pd:34,left:37,up:38,right:39,down:40,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123},q={shift:{wanted:false,pressed:false},ctrl:{wanted:false,pressed:false},alt:{wanted:false,pressed:false},meta:{wanted:false,pressed:false}};if(f.ctrlKey)q.ctrl.pressed=true;if(f.shiftKey)q.shift.pressed=true;if(f.altKey)q.alt.pressed=true;if(f.metaKey)q.meta.pressed=true;for(var r=0;k=i[r],r<i.length;r++)if(k==
"ctrl"||k=="control"){l++;q.ctrl.wanted=true}else if(k=="shift"){l++;q.shift.wanted=true}else if(k=="alt"){l++;q.alt.wanted=true}else if(k=="meta"){l++;q.meta.wanted=true}else if(k.length>1)p[k]==code&&l++;else if(c.keycode)c.keycode==code&&l++;else if(g==k)l++;else if(m[g]&&f.shiftKey){g=m[g];g==k&&l++}if(l==i.length&&q.ctrl.pressed==q.ctrl.wanted&&q.shift.pressed==q.shift.wanted&&q.alt.pressed==q.alt.wanted&&q.meta.pressed==q.meta.wanted){b(f);if(!c.propagate){f.cancelBubble=true;f.returnValue=
false;if(f.stopPropagation){f.stopPropagation();f.preventDefault()}return false}}};this.all_shortcuts[a]={callback:e,target:d,event:c.type};if(d.addEventListener)d.addEventListener(c.type,e,false);else if(d.attachEvent)d.attachEvent("on"+c.type,e);else d["on"+c.type]=e},remove:function(a){a=a.toLowerCase();var b=this.all_shortcuts[a];delete this.all_shortcuts[a];if(b){a=b.event;var c=b.target;b=b.callback;if(c.detachEvent)c.detachEvent("on"+a,b);else if(c.removeEventListener)c.removeEventListener(a,
b,false);else c["on"+a]=false}}};(function(){var a=window.mjt,b=window.mjt={};b.noConflict=function(){window.mjt=a;return b};b.NAME="mjt";b.VERSION="0.9.4";b.LICENSE="========================================================================\nCopyright (c) 2007-2009, Metaweb Technologies, Inc.\nAll rights reserved.\n\nRedistribution and use in source and binary forms, with or without\nmodification, are permitted provided that the following conditions\nare met:\n    * Redistributions of source code must retain the above copyright\n      notice, this list of conditions and the following disclaimer.\n    * Redistributions in binary form must reproduce the above\n      copyright notice, this list of conditions and the following\n      disclaimer in the documentation and/or other materials provided\n      with the distribution.\n\nTHIS SOFTWARE IS PROVIDED BY METAWEB TECHNOLOGIES ``AS IS'' AND ANY\nEXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\nIMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR\nPURPOSE ARE DISCLAIMED. IN NO EVENT SHALL METAWEB TECHNOLOGIES BE\nLIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR\nCONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF\nSUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR\nBUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\nWHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE\nOR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN\nIF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n========================================================================\n"})();
var JSON=JSON||{};
(function(){function a(m){return m<10?"0"+m:m}function b(m){e.lastIndex=0;return e.test(m)?'"'+m.replace(e,function(p){var q=i[p];return typeof q==="string"?q:"\\u"+("0000"+p.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+m+'"'}function c(m,p){var q,r,t,h,j=f,n,o=p[m];if(o&&typeof o==="object"&&typeof o.toJSON==="function")o=o.toJSON(m);if(typeof l==="function")o=l.call(p,m,o);switch(typeof o){case "string":return b(o);case "number":return isFinite(o)?String(o):"null";case "boolean":case "null":return String(o);case "object":if(!o)return"null";
f+=g;n=[];if(Object.prototype.toString.apply(o)==="[object Array]"){h=o.length;for(q=0;q<h;q+=1)n[q]=c(q,o)||"null";t=n.length===0?"[]":f?"[\n"+f+n.join(",\n"+f)+"\n"+j+"]":"["+n.join(",")+"]";f=j;return t}if(l&&typeof l==="object"){h=l.length;for(q=0;q<h;q+=1){r=l[q];if(typeof r==="string")if(t=c(r,o))n.push(b(r)+(f?": ":":")+t)}}else for(r in o)if(Object.hasOwnProperty.call(o,r))if(t=c(r,o))n.push(b(r)+(f?": ":":")+t);t=n.length===0?"{}":f?"{\n"+f+n.join(",\n"+f)+"\n"+j+"}":"{"+n.join(",")+"}";
f=j;return t}}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(){return this.valueOf()?this.getUTCFullYear()+"-"+a(this.getUTCMonth()+1)+"-"+a(this.getUTCDate())+"T"+a(this.getUTCHours())+":"+a(this.getUTCMinutes())+":"+a(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}}var d=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
e=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,f,g,i={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},l;if(typeof JSON.stringify!=="function")JSON.stringify=function(m,p,q){var r;g=f="";if(typeof q==="number")for(r=0;r<q;r+=1)g+=" ";else if(typeof q==="string")g=q;if((l=p)&&typeof p!=="function"&&(typeof p!=="object"||typeof p.length!=="number"))throw new Error("JSON.stringify");return c("",
{"":m})};if(typeof JSON.parse!=="function")JSON.parse=function(m,p){function q(t,h){var j,n,o=t[h];if(o&&typeof o==="object")for(j in o)if(Object.hasOwnProperty.call(o,j)){n=q(o,j);if(n!==undefined)o[j]=n;else delete o[j]}return p.call(t,h,o)}var r;d.lastIndex=0;if(d.test(m))m=m.replace(d,function(t){return"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)});if(/^[\],:{}\s]*$/.test(m.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){r=eval("("+m+")");return typeof p==="function"?q({"":r},""):r}throw new SyntaxError("JSON.parse");}})();
(function(a){if(typeof a.services=="undefined")a.services={};a.debug=0;var b={};a.uniqueid=function(d){var e=b[d];if(typeof e!=="number")e=1;b[d]=e+1;return d+"_"+e};var c=function(d,e){var f=document.createElement("div"),g,i;g=document.createElement("h3");g.style.backgroundColor="#fff0f0";g.appendChild(document.createTextNode(d));f.appendChild(g);for(var l=0;l<e.length;l++){var m=e[l];if(m instanceof Array){g=document.createElement("div");g.innerHTML=a.flatten_markup(m)}else{g=document.createElement("pre");
if(typeof m=="string")i=m;else try{i=JSON.stringify(m)}catch(p){i=""+m}i=i.replace(/\r?\n/g,"\r\n");g.appendChild(document.createTextNode(i))}f.appendChild(g)}(g=document.getElementById("mjt_debug_output"))||(g=document.getElementsByTagName("body")[0]);g&&g.appendChild(f)};(function(){function d(f){return Array.prototype.slice.apply(f).join(" ")}if(typeof console!="object"||typeof console.log=="undefined")if(typeof document!="undefined"){a.error=function(){c("error",arguments);return""};a.warn=function(){c("warning",
arguments);return""};a.log=function(){return""};a.note=function(){return""};a.openlog=function(){return""};a.closelog=function(){return""};a.assert=function(){return""}}else{if(typeof Packages!="undefined"){var e=java.lang.System.err;a.error=function(){e.println("error: "+d(arguments));return""};a.warn=function(){e.println("error: "+d(arguments));return""};a.log=function(){e.println("log: "+d(arguments));return""};a.note=function(){e.println("note: "+d(arguments));return""};a.openlog=function(){return""};
a.closelog=function(){return""};a.assert=function(){return""}}}else if(typeof console.debug=="function"){a.error=function(){console.error.apply(console,arguments);return""};a.warn=function(){console.warn.apply(console,arguments);return""};a.log=function(){console.log.apply(console,arguments);return""};a.note=function(){a.debug&&console.info.apply(console,arguments);return""};a.openlog=typeof console.group!="undefined"?function(){a.debug&&console.group.apply(console,arguments)}:a.log;a.closelog=typeof console.groupEnd!=
"undefined"?function(){a.debug&&console.groupEnd.apply(console,arguments);return""}:function(){return""};a.assert=function(f){if(!f){console.error.apply(console,arguments);throw new Error("assertion failed");}return""}}else{a.error=function(){console.log("error: "+d(arguments));return""};a.warn=function(){console.log("warning: "+d(arguments));return""};a.log=function(){return""};a.note=function(){return""};a.openlog=function(){return""};a.closelog=function(){return""};a.assert=function(){return""}}})();
a.formquote=function(d){if(/^[-A-Za-z0-9~!*()_.',:@$\/]*$/.test(d))return d;return encodeURIComponent(d).replace("%2C",",","g").replace("%3A",":","g").replace("%40","@","g").replace("%24","$","g").replace("%2F","/","g")};a.formencode=function(d){var e=[],f="",g,i,l,m=[];for(g in d)m.push(g);m.sort();for(l in m){g=m[l];i=d[g];if(typeof i!="undefined"){i instanceof Array||(i=[i]);for(var p=0;p<i.length;p++){var q=i[p];e.push(f);f="&";e.push(a.formquote(g));e.push("=");e.push(a.formquote(q))}}}return e.join("")};
a.formdecode=function(d){if(typeof d=="undefined"||d===null)return{};d=d.replace(/^\s*/m,"").replace(/\s+$/m,"");if(d=="")return{};var e={};d=d.split("&");for(var f=0;f<d.length;f++){var g=d[f].indexOf("=");if(g<1)a.log('bad uri query argument, missing "=": ',d[f]);else{var i=[d[f].substring(0,g),d[f].substring(g+1)];g=decodeURIComponent(i[0].replace(/\+/g," "));i=decodeURIComponent(i[1].replace(/\+/g," "));if(g in e)if(e[g]instanceof Array)e[g].push(i);else e[g]=[e[g],i];else e[g]=i}}return e};a.form_url=
function(d,e){if(!(e&&a.formencode(e)))return d;return d+"?"+a.formencode(e)};a.htmlencode=function(d){if(typeof d!="string")d=""+d;return d.replace(/\&/g,"&amp;").replace(/\</g,"&lt;").replace(/\>/g,"&gt;").replace(/\"/g,"&quot;")};a.label_package=function(d){var e=window;if(d){for(var f=d.split(".");f.length;)e=e[f.shift()];if(typeof e=="function")e=e.prototype;if((typeof e=="object"||typeof e=="function")&&e!==null)e._package_name=d;else a.log("missing package",d)}for(var g in e){f=e[g];if(a&&
a.Task&&f&&typeof f!="string"&&!f.nodeName&&f.constructor!=Array&&/function/i.test(f+"")&&typeof f.prototype=="object"&&f.prototype instanceof a.Task)f.prototype._task_class=d+"."+g}}})(mjt);
(function(a){var b=["safe_constructor_token"],c=function(e){return!!e&&typeof e!="string"&&!e.nodeName&&e.constructor!=Array&&/function/i.test(e+"")},d=function(e){var f=[];if(typeof e!="array")for(var g=0,i=e.length;g<i;g++)f.push(e[g]);else f=e.slice(0);return f};a.thunk=function(){return a.vthunk(arguments)};a.vthunk=function(){var e,f,g;f=arguments[0];g=typeof f=="object"&&typeof f.length=="number"?d(f):d(arguments);f=g.shift();if(typeof f=="string"){e=g.shift();f=f;c(e[f])||a.warn("mjt.thunk:",
f,"is not a method of",e)}else{e=null;f=f;c(f)||a.error("mjt.thunk:",f,"is not a function")}var i=arguments.callee._next_thunk_id||1;arguments.callee._next_thunk_id=i+1;var l=function(){var m=arguments.callee,p=m.bound_args.concat(d(arguments)),q=m.bound_this===null?this:m.bound_this,r=m.bound_func;if(typeof r=="string")r=q[r];c(r)||a.error("mjt.thunk: bad function",m,m.bound_func,q);return r.apply(q,p)};l.bound_this=e;l.bound_func=f;l.bound_args=g;l.thunk_id=i;return l};a.vcall=function(e){var f=
d(arguments).slice(1);return a.vthunk(e).apply(this,f)};a.vapply=function(e,f){return a.vthunk(e).apply(this,f)};a.Task=function(){if(arguments.length!==1||arguments[0]!==b){a.error("new mjt.Task() is illegal");throw new Error("don't call mjt.Task()");}};a.Task.prototype.toString=function(){return"["+this._task_id+"]"};a.Task.prototype.toMarkup=function(){return'<span class="mjt_task">task '+this._task_id+":"+this.state+"</span>"};if(typeof Object.getPrototypeOf!=="function")Object.getPrototypeOf=
typeof"test".__proto__==="object"?function(e){return e.__proto__}:function(e){return e.constructor.prototype};a.define_task=function(e,f){var g=function(){var i,l=d(arguments);if(this instanceof arguments.callee)if(l.length!==1||l[0]!==b)throw new Error("Task class should not be invoked with new ()");else return;else{i=new arguments.callee(b);i._factory=this}for(var m=[],p=arguments.callee;p!==undefined;p=p.__super)m.push(p);for(;m.length;){p=m.pop();p.prototype.hasOwnProperty("init")&&p.prototype.init.apply(i,
l)}typeof arguments.callee._auto_enqueue!="undefined"&&i.enqueue();return i};if(!e)e=a.Task;g.prototype=new e(b);g.prototype.constructor=g;g.__super=e;g.prototype.parameters=f||[];return g};a.Task._default_timeout=1E4;a.Task.pending=null;a.Task._on_pending_empty=[];a.Task.add_pending=function(e){if(this.pending==null)this.pending={};this.pending[e._task_id]=e};a.Task.delete_pending=function(e){if(!(this.pending===null||!(e._task_id in this.pending))){delete this.pending[e._task_id];for(var f in this.pending)return;
for(this.pending=null;this.pending==null&&this._on_pending_empty.length;)this._on_pending_empty.shift().ready()}};a.Task.prototype.init=function(){a.assert(typeof this.state==="undefined");this.state="init";this._onready=[];this._onerror=[];this._timeout=null;this._prereqs={};this._task_id=a.uniqueid(this._task_class?this._task_class:"task");a.Task.add_pending(this);for(var e=0;e<this.parameters.length;e++){var f=this.parameters[e];this[f.name]=typeof arguments[e]!="undefined"?arguments[e]:f["default"]}return this};
a.Task.prototype.set_timeout=function(e){if(typeof e==="undefined")e=a.Task._default_timeout;this._timeout!==null&&a.error("timeout already set");if(typeof setTimeout!="undefined")this._timeout=setTimeout(a.thunk("timeout",this),e);return this};a.Task.prototype.clear_timeout=function(){this._timeout!==null&&clearTimeout(this._timeout);this._timeout=null;return this};a.Task.prototype.require=function(e){if(this.state!=="init")throw new Error("task.enqueue() already called - too late for .require()");
if(e.state=="ready")return this;if(this.state=="error")return this;if(e.state=="error")return this._prereq_error(e);this._prereqs[e._task_id]=e;e.onready("_prereq_ready",this,e).onerror("_prereq_error",this,e);return this};a.Task.prototype.enqueue=function(){if(this.state!="init")return this;this.state="wait";a.Task.debug&&a.openlog(this,".enqueue()");try{for(var e in this._prereqs)this._prereqs[e].enqueue();return this._prereqs_check()}finally{a.closelog()}};a.Task.prototype._prereqs_check=function(){if(this._prereqs===
null)return this;for(var e in this._prereqs)return this;if(this.state=="init")return this;this._prereqs=null;this.request();return this};a.Task.prototype.request=function(){return this.ready()};a.Task.prototype._prereq_ready=function(e){if(this._prereqs===null)return this;delete this._prereqs[e._task_id];return this._prereqs_check()};a.Task.prototype._prereq_error=function(e){if(this._prereqs===null)return this;this._prereqs=null;e=e.messages[0];return this.error(e.code,e.message,e.text)};a.Task.prototype.onready=
function(){if(this.state=="ready")a.vcall(arguments,this.result);else this._onready instanceof Array&&this._onready.push(a.vthunk(arguments));return this};a.Task.prototype.onerror=function(){if(this.state=="error")a.vcall(arguments,this.messages[0].code,this.messages[0].message,this.messages[0].text);else this._onerror instanceof Array&&this._onerror.push(a.vthunk(arguments));return this};a.Task.prototype.ondone=function(){this.onready.apply(this,arguments);this.onerror.apply(this,arguments);return this};
a.Task.prototype._state_notify=function(e,f,g){if(!a.Task.debug){for(var i=0;i<f.length;i++){var l=f[i];l.apply(this,g)}return this}for(i=0;i<f.length;i++){l=f[i];typeof l.bound_func!=="undefined"?a.openlog(this,".on"+e," -> "+l.bound_this+".",l.bound_func,l.bound_args,l):a.openlog(this,".on"+e,l);try{l.apply(this,g)}finally{a.closelog()}}return this};a.Task.prototype.ready=function(e){if(this._prereqs!==null)for(var f in this._prereqs)if(typeof this._prereqs[f]!="undefined"){a.error("task.ready() called with remaining prereqs",
this);throw new Error("task.ready() called with remaining prereqs");}if(this.state=="init"){this._prereqs=null;this.state="wait"}if(this.state!=="wait")throw new Error('task.ready() called in bad state "'+this.state+'", should be "wait"');this._onerror=null;this.clear_timeout();this.state="ready";f=this._onready;this._onready=null;this.result=e;a.Task.delete_pending(this);this._state_notify("ready",f,[e]);return this};a.Task.prototype._error=function(e,f){this._onready=this._prereqs=null;this.clear_timeout();
var g=this._onerror;this._onerror=null;if(this.state=="init"){this._prereqs=null;this.state="wait"}if(this.state!=="wait")throw new Error('task.error() called in bad state "'+this.state+'". Error was '+e[0].message);this.state="error";this.messages=e;this._error_chain=f;var i=[e[0].code,e[0].message,e[0].text,this];a.Task.delete_pending(this);this._state_notify("error",g,i);return this};a.Task.prototype.error=function(e,f,g){return this._error([{code:e,message:f,text:typeof g!=="undefined"?g:""}])};
a.Task.prototype.error_nest=function(e){return this._error(e.messages,e)};a.Task.prototype.timeout=function(){this._timeout=null;return this.error("/user/mjt/messages/task_timeout","task timed out - possible unreachable server?")};a.Succeed=a.define_task(null,[{name:"succeed_result","default":null}]);a.Succeed.prototype.request=function(){return this.ready(this.succeed_result)};a.Fail=a.define_task(null,[{name:"fail_code","default":"mjt_fail"},{name:"fail_message","default":"error signaled using mjt.Fail"},
{name:"fail_full","default":""}]);a.Fail.prototype.request=function(){return this.error(this.fail_code,this.fail_message,this.fail_full)};a.Delay=a.define_task(null,[{name:"delay"}]);a.Delay.prototype.request=function(){var e=this;setTimeout(function(){e.ready(null)},this.delay)};a.NoPendingTasks=a.define_task();a.NoPendingTasks.prototype.init=function(){a.Task._on_pending_empty.push(this);a.Task.delete_pending(this)};a.NoPendingTasks.prototype.request=function(){}})(mjt);
(function(a){a.PagerSlice=a.define_task(null,[{name:"pager"},{name:"start"},{name:"count"}]);a.PagerSlice.prototype.init=function(){for(var b=this.chunks=this.pager.slice_chunks(this.start,this.count),c=0;c<b.length;c++)this.require(b[c]);return this.enqueue()};a.PagerSlice.prototype.request=function(){for(var b=this.chunks,c=[],d=0;d<b.length;d++){var e=b[d],f=this.start-e.start;if(!(f<0)){var g=f+this.count;if(f+g>e.count)g=e.count-f;g<=0||(c=f==0&&g==e.count?c.concat(e.result):c.concat(e.result.slice(f,
g)))}}return this.ready(c)};a.Pager=function(b){this.chunks=[];this.chunks_waiting=0;this.add_chunk(b)};a.Pager.prototype._next_chunk=function(b){b=this.chunks[this.chunks.length-1].next(b);this.add_chunk(b);return b};a.Pager.prototype.add_chunk=function(b){b.enqueue();this.chunks_waiting++;b.onready("chunk_ready",this).onerror("chunk_error",this);this.chunks.push(b);return this};a.Pager.prototype.chunk_ready=function(){this.chunks_waiting--};a.Pager.prototype.chunk_error=function(){this.chunks_waiting--};
a.Pager.prototype.slice_chunks=function(b,c){for(var d=[],e=b+c,f=this.chunks,g=0,i=0;i<f.length;i++){var l=this.chunks[i];if(!(l.start>=e))if(!(l.start+l.end<=b)){d.push(l);g=l.start+l.count}}e>g&&d.push(this._next_chunk(e-g));return d};a.Pager.prototype.slicetask=function(b,c){return a.PagerSlice(this,b,c)};a.Pager.prototype.slice=function(b,c,d,e){this.slicetask(b,c).onready(d).onerror(e)}})(mjt);
(function(a){a.dynamic_script=function(b,c,d){var e=document.getElementsByTagName("head")[0],f=document.createElement("script");f.type="text/javascript";if(typeof b=="string")f.id=b;if(typeof c!=="undefined")f.src=c;if(typeof d!=="undefined"){if(/WebKit|Khtml/i.test(navigator.userAgent))throw new Error("safari doesnt evaluate dynamic script text");f.text=d}e.appendChild(f);return f};a.dynamic_iframe=function(b,c){var d=document.createElement("iframe");if(typeof b=="string")d.id=b;d.style.display=
"none";d.className="mjt_dynamic";d.setAttribute("src",c);return d};a.AsyncScript=a.define_task(null,[{name:"url"}]);a.AsyncScript.prototype.request=function(){var b=this,c=a.dynamic_script(null,this.url);if(/WebKit|Khtml/i.test(navigator.userAgent)){var d=a.dynamic_iframe();d.onload=function(){b.ready(null)};document.getElementsByTagName("body")[0].appendChild(d)}else{c.onreadystatechange=function(){/complete|loaded/.test(c.readyState)&&b.ready(null)};c.onload=function(){b.ready(null)}}};a.AsyncIframe=
a.define_task(null,[{name:"url"}]);a.AsyncIframe.prototype.request=function(){function b(){var e=d.contentWindow||d.contentDocument;if(e.document)return e.document;return e}this.domid=a.uniqueid("mjt_iframe");this.iframe=a.dynamic_iframe(this.domid,this.url);var c=this,d=this.iframe;d.onload=function(){c.ready(b(d))};d.onreadystatechange=function(){d.readyState=="complete"&&c.ready(b(d))};document.getElementsByTagName("body")[0].appendChild(d)}})(mjt);
(function(a){var b=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,
3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,
366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,
3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,
1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,
1088359270,936918E3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];a.crc32=function(c,d){if(typeof d=="undefined")d=0;var e=0;d^=-1;for(var f=0,g=c.length;f<g;f++){e=(d^c.charCodeAt(f))&255;d=d>>>8^b[e]}return d^-1};a.hash=function(c){return(a.crc32(c)+2147483648).toString(16).toUpperCase()}})(mjt);
(function(a){a.JsonP=a.define_task();a.JsonP._cb={};a.JsonP._cache={};a.JsonP.flush_cache=function(){a.JsonP._cache={}};a.JsonP.prototype.init=function(){this._cbid=this.url=null;return this};a.JsonP.prototype.generate_callback_id=function(b){if(typeof b=="undefined"){this._cbid=a.uniqueid("cb");return this}this._cbid="c"+a.hash(this.url);if(typeof a.JsonP._cb[this._cbid]=="undefined")return this;a.log("info: repeated jsonp url hash",this._cbid,this.url);this._cbid=a.uniqueid("cb");return this};a.JsonP.prototype.install=
function(){a.JsonP._cache[this.url]=this;this.generate_callback_id(this.url);var b=this.callback_param+"=mjt.JsonP._cb."+this._cbid;this.cburl=this.url+(/\?/.test(this.url)?"&":"?")+b;var c=this;this._f=function(d){delete a.JsonP._cb[c._cbid];c.ready(d)};a.JsonP._cb[this._cbid]=this._f;this.onerror(function(d,e){function f(){a.log("JSONP already completed with ",d,":",e);delete a.JsonP._cb[c._cbid]}f._stale_jsonp_timed_out=new Date;a.JsonP._cb[c._cbid]=f});return this._send_request()};a.JsonP.prototype.request=
function(){if(!this.url)throw new Error("jsonp.url should be set, not "+this.url);if(typeof a.JsonP._cache[this.url]=="undefined")return this.install();var b=a.JsonP._cache[this.url];if(!(typeof b.cache_controller=="undefined"||b.cache_controller===null||b.cache_controller.is_fresh(b))){delete a.JsonP._cache[this.url];return this.install()}return b.onready("ready",this).onerror("error",this)};a.JsonP.prototype._send_request=function(){a.dynamic_script(undefined,this.cburl);return this};a.JsonP.prototype.jsonp_request_form=
function(b,c,d){c=typeof c=="string"?c:a.formencode(c);b=b;if(c)b+="?"+c;this.url=b;if(typeof acre==="undefined"&&b.length>2083){a.warn("mjt.JsonP: Warning: Adding a SCRIPT tag with a url of "+b.length+" chars. This is too long for Internet Explorer 7");a.log(b)}this.callback_param=d;return this.enqueue()}})(mjt);
(function(a){a.Xhr=a.define_task(null,[{name:"method"},{name:"url"},{name:"content_type","default":null},{name:"body","default":null},{name:"headers","default":null}]);a.Xhr.prototype.init=function(){var b;if(typeof XMLHttpRequest!="undefined")b=new XMLHttpRequest;else if(typeof ActiveXObject!="undefined")b=new ActiveXObject("MSXML2.XmlHttp");else return this.error("no XMLHttpRequest found");if(this.headers===null)this.headers={};this.xhr=b;return this};a.Xhr.prototype.request=function(){var b=this,
c=this.xhr;c.onreadystatechange=function(){if(c.readyState!=4)return b;c.onreadystatechange=function(){};if((""+c.status).charAt(0)=="2")return b.ready(c);return b.error("/apiary/http/status/"+c.status,c.statusText,c.responseText)};c.open(this.method,this.url,true);this.content_type!==null&&c.setRequestHeader("Content-Type",this.content_type);c.setRequestHeader("X-Requested-With","XMLHttpRequest");for(header in this.headers)c.setRequestHeader(header,this.headers[header]);if(this.body===null)var d=
c.send("");else{d=c.send(this.body);this.body=null}return this};a.XhrFormPost=function(b,c,d){c=a.formencode(c);return a.Xhr("POST",b,"application/x-www-form-urlencoded",c,d)}})(mjt);
(function(a){function b(){var c=a.freebase.readCookie("mwLastWriteTime");this.is_fresh=function(){var d=a.freebase.readCookie("mwLastWriteTime");return c==d}}if(typeof a.freebase=="undefined")a.freebase={};a.freebase.default_service_url="http://www.freebase.com";a.freebase.set_service_url=function(c){var d;if(typeof window!="undefined")d=window.location.protocol+"//"+window.location.host;if(typeof acre!="undefined")d=acre.environ.server_protocol+"//"+acre.environ.host;a.freebase.service_url=c;a.freebase.xhr_ok=
a.freebase.service_url==d?true:false;if(typeof a.freebase.SchemaCache!="undefined")this.schema_cache=new this.SchemaCache(this)};a.freebase.set_service_url(a.freebase.default_service_url);a.freebase.FreebaseJsonPTask=a.define_task();a.freebase.FreebaseJsonPTask.prototype.init=function(){this.jsonp=a.JsonP();if(typeof a.freebase.readCookie!="undefined")this.jsonp.cache_controller=new b};a.freebase.FreebaseJsonPTask.prototype.service_request=function(c,d){var e=a.freebase.service_url;if(typeof this.service_url!=
"undefined"&&this.service_url)e=this.service_url;this.jsonp.set_timeout().jsonp_request_form(e+c,d,"callback").onready("handle_envelope",this).onerror("handle_error_jsonp",this);return this};a.freebase.FreebaseJsonPTask.prototype.handle_envelope=function(c){if(c.code!="/api/status/ok"){c=c.messages[0];return this.error(c.code,c.message,c)}return this.response(c)};a.freebase.FreebaseJsonPTask.prototype.handle_error_jsonp=function(){this.error.apply(this,arguments)};a.freebase.FreebaseJsonPTask.prototype.request=
function(){a.error("must override BaseTask.request()")};a.freebase.FreebaseJsonPTask.prototype.response=function(){a.error("must override BaseTask.response()")};a.freebase.MqlRead=a.define_task(a.freebase.FreebaseJsonPTask,[{name:"query"},{name:"qenv","default":{}}]);a.freebase.MqlRead.prototype.build_envelope=function(){var c={escape:false};for(var d in this.qenv)c[d]=this.qenv[d];c.query=this.query;if(this.query instanceof Array){if(typeof c.cursor=="undefined"){c.cursor=true;this.start=0}this.requested_count=
this.query[0].limit||100}return c};a.freebase.MqlRead.prototype.request=function(){var c=this.build_envelope();return this.service_request("/api/service/mqlread",{query:JSON.stringify(c)})};a.freebase.MqlRead.prototype.response=function(c){if(c.result===null)return this.error("/user/mjt/messages/empty_result","no results found");if(typeof c.cursor==="string")this.next_cursor=c.cursor;if(c.result instanceof Array){this.count=c.result.length;this.more_available=false;if(this.count>=this.requested_count&&
this.next_cursor!=false)this.more_available=true}return this.ready(c.result)};a.freebase.MqlRead.prototype.next=function(c){if(this.state!=="ready")throw new Error("MqlRead.next(): bad state "+this.state);if(!this.more_available){a.warn("paging .next(): no more items",this);return null}var d=this.query[0],e={};for(var f in d)if(d.hasOwnProperty(f))e[f]=d[f];if(typeof c!="undefined")e.limit=c;c=a.freebase.MqlRead([e],{cursor:this.next_cursor});c.start=this.start+this.count;return c};a.freebase.MqlReadMultiple=
a.define_task(a.freebase.FreebaseJsonPTask);a.freebase.MqlReadMultiple.prototype.init=function(){this.reads={}};a.freebase.MqlReadMultiple.prototype.request=function(){var c={};for(var d in this.reads)c[d]=this.reads[d].build_envelope();return this.service_request("/api/service/mqlread",{queries:JSON.stringify(c)})};a.freebase.MqlReadMultiple.prototype.mqlread=function(c,d){this.reads[c]=d;return this};a.freebase.MqlReadMultiple.prototype.response=function(c){for(var d in this.reads)this.reads[d].handle_envelope(c[d]);
return this.ready(c.result)};a.freebase.TransGet=a.define_task(a.freebase.FreebaseJsonPTask,[{name:"id"},{name:"trans_type","default":"raw"},{name:"values","default":null}]);a.freebase.TransGet.prototype.request=function(){if(this.values===null)this.values={};return this.service_request("/api/trans/"+this.trans_type+this.id,this.values)};a.freebase.TransGet.prototype.response=function(c){c.result.media_type=c.result.media_type.replace(/^\/media_type\//,"");if(typeof c.result.text_encoding=="string")c.result.text_encoding=
c.result.text_encoding.replace(/^\/media_type\/text_encoding\//,"");return this.ready(c.result)};a.freebase.Touch=a.define_task(a.freebase.FreebaseJsonPTask,[{name:"service_url","default":null}]);a.freebase.Touch.prototype.request=function(){this.jsonp.cache_controller={is_fresh:function(){return false}};return this.service_request("/api/service/touch")};a.freebase.Touch.prototype.response=function(){return this.ready(null)}})(mjt);
(function(a){var b=function(c,d,e){d||(d=6);if(e){var f=e.match(/([-+])([0-9]{2}):([0-9]{2})/),g=Number(f[2])*60+Number(f[3]);g*=f[1]=="-"?-1:1;c=new Date(Number(Number(c)+g*6E4))}else e="Z";f=function(i){return(i<10?"0":"")+i};g="";g+=c.getUTCFullYear();if(d>1)g+="-"+f(c.getUTCMonth()+1);if(d>2)g+="-"+f(c.getUTCDate());if(d>3)g+="T"+f(c.getUTCHours())+":"+f(c.getUTCMinutes());if(d>5){c=Number(c.getUTCSeconds()+"."+(c.getUTCMilliseconds()<100?"0":"")+f(c.getUTCMilliseconds()));g+=":"+f(c)}else if(d>
4)g+=":"+f(c.getUTCSeconds());if(d>3)g+=e;return g};a.freebase.date_from_iso=function(c){if(typeof c=="undefined"||c===null)return NaN;c=c.toString();var d=new Date(0,0);c=c.indexOf("T")==-1?c.split(" "):c.split("T");d=d;var e=c[0],f=e.match(/^(-?[0-9]{4})((-?([0-9]{2})(-?([0-9]{2}))?)|(-?([0-9]{3}))|(-?W([0-9]{2})(-?([1-7]))?))?$/);if(f){var g=f[4],i=f[6],l=f[8];e=f[10];var m=f[12]||1;d.setFullYear(f[1]);if(l){d.setMonth(0);d.setDate(Number(l))}else if(e){d.setMonth(0);d.setDate(1);f=d.getDay()||
7;e=Number(m)+7*Number(e);f<=4?d.setDate(e+1-f):d.setDate(e+8-f)}else{if(g){d.setDate(1);d.setMonth(g-1)}i&&d.setDate(i)}d=d}else{a.log("invalid date string: "+e);d=NaN}if(c.length==2){d=d;e=c[1];f=e.match(/Z|(([-+])([0-9]{2})(:?([0-9]{2}))?)$/);c=0;if(f){if(f[0]!="Z"){c=Number(f[3])*60+Number(f[5]||0);if(f[2]!="-")c*=-1}c-=d.getTimezoneOffset();e=e.substr(0,e.length-f[0].length)}if(f=e.match(/^([0-9]{2})(:?([0-9]{2})(:?([0-9]{2})(.([0-9]+))?)?)?$/)){e=f[1];m=Number(f[3]||0);g=f[5]||0;f=f[7]?Number("0."+
f[7])*1E3:0;d.setHours(e);d.setMinutes(m);d.setSeconds(g);d.setMilliseconds(f);c!==0&&d.setTime(d.getTime()+c*6E4);d=d}else{a.log("invalid time string: "+e);d=NaN}}return d};a.freebase.date_to_iso=function(c){return b(c)}})(mjt);
(function(a){a.freebase.imgurl=function(b,c,d,e,f){var g={};if(typeof c!=="undefined")g.maxwidth=c;if(typeof d!=="undefined")g.maxheight=d;if(typeof e!=="undefined")g.mode=e;if(typeof e!=="undefined")g.errorid=f;return a.form_url(this.service_url+"/api/trans/image_thumb"+a.formquote(b),g)};a.freebase.extend_query=function(b,c){if(typeof c=="undefined")c={};if(typeof b=="undefined")throw new Error("extend_query: MQL query is undefined");for(var d in c){for(var e=c[d],f=d.split("."),g=f.pop(),i=b instanceof
Array?b[0]:b,l=0;l<f.length;l++){var m=f[l];if(typeof i[m]!="object"||i[m]===null)i[m]={};i=i[m];if(i instanceof Array){if(i.length==0)i=[{}];if(i.length>1)throw new Error("extend_query: path "+JSON.stringify(d)+" references an array with more than one element");i=i[0]}}if(i===null||typeof i!="object")throw new Error("extend_query: path "+JSON.stringify(d)+" does not exist in query");i[g]=e}return b}})(mjt);
(function(a){var b=/^[A-Za-z0-9][A-Za-z0-9_-]*$/,c=new RegExp("([^A-Za-z0-9_-])","g");a.freebase.mqlkey_quote=function(d){if(b.exec(d))return d;var e=function(f,g){var i=g.charCodeAt(0).toString(16).toUpperCase();if(i.length==2)i="00"+i;return"$"+i};x=d.replace(c,e);if(x.charAt(0)=="-"||x.charAt(0)=="_")x=e(x,x.charAt(0))+x.substr(1);return x};a.freebase.mqlkey_unquote=function(d){return d=d.replace(/\$([0-9A-Fa-f]{4})/g,function(e,f){return String.fromCharCode(parseInt(f,16))})}})(mjt);
(function(a,b){b.readCookie=function(c){if(typeof acre!="undefined"){if(typeof acre.environ.cookies[c]=="undefined")return"";return acre.environ.cookies[c].value}if(typeof document=="undefined")return"";var d="";c+="=";if(document.cookie.length>0){var e=document.cookie.indexOf(c);if(e!=-1){e+=c.length;c=document.cookie.indexOf(";",e);if(c==-1)c=document.cookie.length;d=document.cookie.substring(e,c)}}return d};b.parse_metaweb_cookies=function(){function c(f,g){var i=f.indexOf("|"+g+"_");if(i!=-1){i=
i+2+g.length;var l=f.indexOf("|",i);if(l!=-1)return decodeURIComponent(f.substr(i,l-i))}return null}a.freebase.freebase_user=null;var d=b.readCookie("metaweb-user-info");if(d.indexOf("A|")==0){var e={type:"/type/user"};e.id=c(d,"p");e.guid=c(d,"g");e.name=c(d,"u");if(!e.id)e.id=e.guid;a.freebase.freebase_user=e}};b.parse_metaweb_cookies();b.FreebaseXhrTask=a.define_task(null);b.FreebaseXhrTask.prototype.init=function(){};b.FreebaseXhrTask.prototype.xhr_request=function(c,d,e,f){d=b.service_url+d;
this.xhr=a.Xhr(c,d,e,f).enqueue();this.xhr.onready("xhr_ready",this).onerror("xhr_error",this,this.xhr.xhr);return this};b.FreebaseXhrTask.prototype.xhr_form_post=function(c,d){c=b.service_url+c;this.xhr=a.XhrFormPost(c,d).enqueue();this.xhr.onready("xhr_ready",this).onerror("xhr_error",this,this.xhr.xhr);return this};b.FreebaseXhrTask.prototype.request=function(){};b.FreebaseXhrTask.prototype.xhr_ready=function(c){var d=c.getResponseHeader("content-type");d=d?d.replace(/;.*$/,""):"";if(!d.match(/^(application\/json|text\/javascript|text\/plain)$/))return this.error("/user/mjt/messages/json_response_expected",
"status: "+c.status+", content-type: "+d,c.responseText);this.envelope=c=JSON.parse(c.responseText);if(c.code!=="/api/status/ok")return this.error(c.code,c.messages[0].message,c.messages[0]);return this.ready(c.result)};b.FreebaseXhrTask.prototype.xhr_error=function(c,d,e,f){c=null;try{c=JSON.parse(f);var g=c.messages[0];return this.error(g.code,g.message,g)}catch(i){return this.error(d,e,f)}};b.TransUnsafe=a.define_task(null,[{name:"id"}]);b.TransUnsafe.prototype.xhr_request=function(c,d,e,f){d=
b.service_url+d;this.xhr=a.Xhr(c,d,e,f).enqueue();this.xhr.onready("xhr_ready",this).onerror("xhr_error",this,this.xhr.xhr);return this};b.TransUnsafe.prototype.xhr_ready=function(c){var d=c.getResponseHeader("content-type");this.content_type=d?d.replace(/;.*$/,""):"";this.responseText=c.responseText;return this.ready()};b.TransUnsafe.prototype.xhr_error=function(c,d,e,f){return this.error(d,e,f)};b.TransUnsafe.prototype.request=function(){return this.xhr_request("GET","/api/trans/unsafe"+this.id)};
b.MqlWrite=a.define_task(b.FreebaseXhrTask,[{name:"query"},{name:"qenv","default":{}}]);b.MqlWrite.prototype.request=function(){var c={query:this.query};for(var d in this.qenv)c[d]=this.qenv[d];return this.xhr_form_post("/api/service/mqlwrite",{query:JSON.stringify(c)})};b.FlushCache=a.define_task(b.FreebaseXhrTask);b.FlushCache.prototype.request=function(){return this.xhr_request("POST","/api/service/touch")};b.FlushCache.prototype.xhr_ready=function(){return this.ready(null)};b.Upload=a.define_task(b.FreebaseXhrTask,
[{name:"content_type"},{name:"body"},{name:"values"}]);b.Upload.prototype.request=function(){var c="/api/service/upload",d=a.formencode(this.values);if(d)c+="?"+d;return this.xhr_request("POST",c,this.content_type,this.body)};b.Signin=a.define_task(b.FreebaseXhrTask,[{name:"username"},{name:"password"},{name:"domain","default":null},{name:"options","default":{}}]);b.Signin.prototype.request=function(){if(typeof this.username=="undefined")return this.xhr_form_post("/api/account/logout",{});var c={username:this.username,
password:this.password};if(this.domain!==null)c.domain=this.domain;for(var d in this.options)c[d]=this.options[d];return this.xhr_form_post("/api/account/login",c).ondone("clear_password",this)};b.Signin.prototype.clear_password=function(){delete this.password;return this}})(mjt,mjt.freebase);
(function(a){a.bless=function(b){return new a.Markup(b)};a.MarkupList=function(){for(var b=0;b<arguments.length;b++)this[b]=arguments[b]};a.Markup=function(b){this.html=b};a.Markup.prototype.toMarkup=function(){return this.html};(function(){function b(d,e,f){f.push('<span style="outline-style:solid;color:red;">');if(e){f.push(e);f.push("</span>")}else{f.push("bad markup element, type [");f.push(typeof d);f.push("]</span>")}}function c(d,e){switch(typeof d){case "object":if(d===null)b(d,"[null]",e);
else if(d instanceof a.MarkupList)for(var f=0;f in d;f++)c(d[f],e);else if(typeof d.toMarkupList==="function")c(d.toMarkupList(),e);else if(typeof d.toMarkup==="function")e.push(d.toMarkup());else typeof d.toString==="function"?e.push(a.htmlencode(d.toString())):b(d,"[object]",e);break;case "undefined":b(d,"[undefined]",e);break;case "string":e.push(a.htmlencode(d));break;case "boolean":e.push(String(d));break;case "number":e.push(String(d));break;case "function":b(d,"[function]",e);break}return e}
a.flatten_markup=function(d){return c(d,[]).join("")}})();a.make_attr_safe=function(b){return a.bless(a.flatten_markup(b).replace(/\</g,"&lt;").replace(/\>/g,"&gt;").replace(/\"/g,"&quot;"))}})(mjt);
(function(a){a._eventcb={};a.kws=function(){for(var b={},c=0;c<arguments.length;c+=2)b[arguments[c]]=arguments[c+1];return b};a.foreach=function(b,c,d){var e,f;if(typeof c=="string"||c instanceof Array||typeof jQuery=="object"&&c instanceof jQuery){f=c.length;for(e=0;e<f;e++)d.apply(b,[e,c[e]])}else if(typeof c==="object")if(typeof document!="undefined"&&typeof c.item!="undefined"&&c.item===document.childNodes.item){f=c.length;for(e=0;e<f;e++)d.apply(b,[e,c.item(e)])}else for(e in c)c.hasOwnProperty(e)&&
d.apply(b,[e,c[e]])};a.ondomready=function(b,c){var d=a._ondomready_queue;if(a._ondomready_timer===null)a._ondomready_timer=setTimeout(a._ondomready_run,20);d.push(b);d.push(c)};a._ondomready_queue=[];a._ondomready_timer=null;a._ondomready_run=function(){a._ondomready_timer=null;var b=a._ondomready_queue;for(a._ondomready_queue=[];b.length;){var c=b.shift(),d=b.shift();c.apply(d)}};a.cleanup_noquote=function(b,c){var d=a.flatten_markup(b);d=d.replace(/&quot;/g,'"').replace(/&lt;/g,"<").replace(/&gt;/g,
">").replace(/&amp;/g,"&");if(typeof c!="undefined")d=d.replace(new RegExp("</("+c+"\\s*)>","ig"),"<\\/$1>");return a.bless(d)};a.ref=function(b){b=['<a href="view?name=',a.formquote(b),'">',a.htmlencode(b),"</a>"].join("");return new a.Markup(b)};a.TemplateCall=function(b){this.raw_tfunc=b;delete this._markup};a.TemplateCall.prototype.toMarkupList=function(){return this._markup};a.TemplateCall.prototype.toMarkup=function(){return a.flatten_markup(this._markup)};a.TemplateCall.prototype.redisplay=
function(){var b=new this.this_tfunc;b.prev_tcall=this;b.subst_id=this.subst_id;b.render(this.targs).display();return b};a.TemplateCall.prototype.display=function(b){if(typeof acre!="undefined")return this;if(typeof b!="undefined")this.subst_id=b;b=this.subst_id;if(typeof b=="string"){var c=document.getElementById(b);if(c)b=c;else{a.note("no element with id "+b);return null}}if(b.nodeName=="IFRAME"){b=b.contentWindow||b.contentDocument;if(b.document)b=b.document;b=b.getElementsByTagName("body")[0]}if(!b)return this;
typeof this._markup!="undefined"&&a.replace_html(b,this);return this};a.TemplateCall.prototype.render=function(b){if(typeof b!="undefined")this.targs=b;b=this.raw_tfunc;if(typeof window=="undefined"||typeof window.navigator.appName=="undefined"){this._markup=b.apply(this,this.targs);return this}try{this._markup=b.apply(this,this.targs)}catch(c){c.tcall=this;b=this.tpackage._codeblock;if(b===null)throw c;b.handle_exception("applying tfunc "+this.signature,c);b=[];for(var d in this.tasks){var e=this.tasks[d];
typeof e==="object"&&e!==null?b.push(d+":"+e.state):b.push(d+":"+typeof e)}this._markup=new a.MarkupList(a.bless("<h3>error applying "),this.signature," to id=",this.subst_id,a.bless("</h3>"),"states:[",b.join(" "),"]");throw c;}return this};a.TemplateCall.prototype.mktask=function(b,c){this.tasks[b]=c;var d=this;c.state=="init"&&c.enqueue();return c.ondone(function(){d.render().display()})};a.tfunc_factory=function(b,c,d,e){var f=function(){var g=arguments.callee;if(this instanceof g){this.tasks=
{};this.defs=this.exports={};typeof a.deprecate=="function"&&a.deprecate(this,"defs",".exports")}else{for(var i=new g,l=[],m=0;m<arguments.length;m++)l[m]=arguments[m];m=i.signature.replace(/\(.*\)$/,"");i.subst_id=g.prototype.has_tasks?a.uniqueid("tcall__"+m):null;i.render(l);return i}};f.prototype=new a.TemplateCall(c);f.prototype.signature=b;f.prototype.tpackage=d;f.prototype.has_tasks=e;f.prototype.source_microdata=c.source_microdata;return f.prototype.this_tfunc=f}})(mjt);
(function(a){a.TemplatePackage=function(){this.namespace=this._template_fragments=this.output_mode=this.debug_locs=this._codeblock=this._compiled=this._template_strings=this.source=null};a.TemplatePackage.prototype.runtime={_break_token:a._break_token,_continue_token:a._continue_token,bless:a.bless,cleanup_noquote:a.cleanup_noquote,foreach:a.foreach,htmlencode:a.htmlencode,make_attr_safe:a.make_attr_safe,new_markuplist:function(){return new a.MarkupList},ondomready:a.ondomready,ref:a.ref,tfunc_factory:a.tfunc_factory,
uniqueid:a.uniqueid};a.TemplatePackage.prototype.init_from_json=function(b){if(typeof b.file!="undefined")this.source=b.file;if(typeof b.stringtable!="undefined")this._template_strings=b.stringtable;this._codeblock=null;if(typeof b.code=="string")this._codeblock=new a.Codeblock(this.source,b.code);else if(typeof b.code=="function")this._compiled=b.code;if(typeof b.debug_locs!="undefined")this.debug_locs=b.debug_locs;if(typeof b.output_mode!="undefined")this.output_mode=b.output_mode;return this};
a.TemplatePackage.prototype.init_from_js=function(b){var c=b.def;this.init_from_json(b.info);this._compiled=c;return this};a.TemplatePackage.prototype.get_metadata=function(){return{file:this.source,stringtable:this._template_strings,debug_locs:this.debug_locs,output_mode:this.output_mode}};a.TemplatePackage.prototype.toJSON=function(){var b=this.get_metadata();if(this._codeblock===null){a.warn("TemplatePackage.toJSON: complete source code unavailable",this.source);b.code=this._compiled}else b.code=
this._codeblock.codestr;return JSON.stringify(b)};a.TemplatePackage.prototype.toJS=function(){var b=null;if(this._codeblock===null){a.warn("TemplatePackage.toJS: complete source code unavailable",this.source);b=this._compiled}else b="(function () {"+this._codeblock.codestr+"})()";return["{def: ",b,",\ninfo:",JSON.stringify(this.get_metadata()),"}\n"].join("")};a.TemplatePackage.prototype.lookup_line=function(b){if(!(debug_locs instanceof Array)||b>=this.debug_locs.length)return null;return this.debug_locs[b-
1]};a.TemplatePackage.prototype.compile_document=function(b,c){(new Date).getTime();if(typeof c=="undefined")c=new a.TemplateCompiler;c.compile_top(b,"rawmain()");(new Date).getTime();return this.init_from_json({source:this.source,stringtable:c.strings,code:c.codestr+"; return rawmain;",debug_locs:c.debug_locs,output_mode:c.output_mode})};a.TemplatePackage.prototype.load_document=function(b,c){this.source+="#"+b.id;this.compile_document(b);return this.load(c)};a.TemplatePackage.prototype.toplevel=
function(b){this.namespace===null&&this.load(b);return this.namespace};a.TemplatePackage.prototype.toString=function(){this.namespace===null&&this.load(targs);return a.flatten_markup(this.namespace._main.prototype.tpackage.tcall)};a.TemplatePackage.prototype.load=function(b){this._template_fragments=[];for(var c=0;c<this._template_strings.length;c++)this._template_fragments[c]=a.bless(this._template_strings[c]);if(this._compiled===null)if(this._codeblock===null)a.error("TemplatePackage has no code",
this.source);else this._compiled=this._codeblock.evaluate();if(typeof b=="undefined")b=[];this._args=b;b=a.tfunc_factory("_main()",this._compiled,this,false,true);c=new b;c.render(this._args);this.tcall=c;c.pkg=this;if(typeof this._compiled.doc_content_type!="undefined")c.doc_content_type=this._compiled.doc_content_type;if(typeof c.exports._main!="undefined")throw new Error("_main() is illegal as a template function name");this.namespace=c.exports;this.namespace._main=b;if(typeof c.exports.main!=
"undefined")throw new Error("main() is illegal as a template function name");this.namespace.main=b;typeof a.deprecate=="function"&&a.deprecate(this.namespace,"main","._main");return this}})(mjt);
(function(a){a.error_html=function(b,c,d){var e=[];if(c&&b.lineNumber){var f=b.lineNumber;c=c.split("\n");if(f<0)f=0;if(f>=c.length)f=c.length-1;var g=f-10;if(g<0)g=0;var i=[];e.push(a.bless(["\n<pre>"]));for(g=g;g<f;g++)i.push(c[g]);e.push(i.join("\n"));e.push(a.bless(['</pre>\n<pre style="color:red">']));e.push(c[f]+"\n");e.push(a.bless(["</pre>\n<pre>"]));i=[];for(g=f+1;g<c.length;g++)i.push(c[g]);e.push(i.join("\n"));e.push(a.bless(["</pre>\n"]))}b=[a.bless(['<div class="mjt_error"']),d?[a.bless([' id="']),
d,a.bless(['"'])]:[],a.bless([">"]),b.name,": ",b.message,e,a.bless(["</div>\n"])];return b=b.concat(e)};a.Codeblock=function(b,c){this.name=b;this.codestr=c;this.baseline=this.basefile=null};a.Codeblock.prototype.handle_exception=function(b,c){if(typeof c.mjt_error=="undefined"){var d=false;if(typeof c.sourceURL!="undefined")c.fileName=c.sourceURL;if(typeof c.line!="undefined"){d=true;c.lineNumber=c.line}c.mjt_error=c instanceof Error?{fileName:c.fileName,lineNumber:c.lineNumber,name:c.name,message:c.message,
stack:c.stack,rhinoException:c.rhinoException}:{name:"Unknown exception",fileName:"",message:""+c};if(this.basefile||d)if(typeof c.stack=="string"){d=this.basefile.replace(/(\W)/g,"\\$1")+":(\\d+)\n";d=new RegExp(d);if(d=d.exec(c.stack)){d=parseInt(d[1])-this.baseline;d>0&&this.log_error_context(b,c,d)}}else if(c.fileName==this.basefile||d){d=d?c.lineNumber-1:c.lineNumber-this.baseline;if(d>0){c.mjt_error.lineNumber=d;c.mjt_error.fileName="<generated code>";this.log_error_context(b,c,d)}}}};a.Codeblock.prototype.log_error_context=
function(b,c,d){var e=this.extract_context(this.codestr,d,5);d="---"+d+"--\>  ";for(var f=[],g=0;g<d.length;g++)f.push(" ");f=f.join("");e=[f,e.prev_lines.join("\n"+f),"\n",d,e.the_line,"\n",f,e.next_lines.join("\n"+f)].join("");a.error("error",b,"\n    "+c.name+": "+c.message+"\n",e)};a.Codeblock.prototype.extract_context=function(b,c,d){b=b.split("\n");if(c<0)c=0;if(c>=b.length)c=b.length-1;var e=c-d;if(e<0)e=0;var f=[];for(line=e;line<c;line++)f.push(b[line]);e=b[c];var g=[];for(line=c+1;line<
b.length&&line<c+d;line++)g.push(b[line]);return{prev_lines:f,the_line:e,next_lines:g}};a.Codeblock.prototype.evaluate=function(){var b=(new Date).getTime(),c=[this.codestr];c=["var __mjt_eval = (function(){",this.codestr,"})(); __mjt_eval;\n"];c=c.join("");a.debug&&a.log("evaluating code "+this.name,{click_me:"view code",codestr:c});var d;if(typeof window=="undefined"||typeof window.navigator.appName=="undefined")d=eval(c);else{try{null()}catch(e){this.baseline=e.lineNumber+2;this.basefile=e.fileName}try{d=
eval(c)}catch(f){this.handle_exception("evaluating codeblock "+this.name,f);throw f;}}b=(new Date).getTime()-b;a.note("evaluated code in ",b,"msec, ",c.length,"chars, got ",typeof d);return d}})(mjt);
(function(a){a.Scope=function(b,c,d){this.template=b;c||(c=null);this.parent=c;d||(d="[unnamed]");this.decl=d;this.tasks={};this.toplevel=false;this.microdata={items:{},item:null,stack:[],lastvalue:null};if(c!==null)this.microdata.items=c.microdata.items};a.TemplateCompiler=function(){this.strings=[];this.codestr=null;this.debug_locs=[];this.compiler_dt=this.source_loc=null;this._markup=[];this._code=[];this.next_unique_id={};this.debug=a.debug;this.browser_dom=typeof navigator!="undefined";this.browser_target=
true;this.document_content_type=this.output_prefix=null;this.set_output_mode("html");this.mjtns_re=/^(?:mjt\.|mjt:|acre:)(.+)$/;this._ie_attribute_bs=this.browser_dom&&/MSIE/.test(navigator.userAgent)};a.TemplateCompiler.prototype.set_output_mode=function(b){this.output_mode=b;this.empty_tags={};this.boolean_attrs={};this.preserve_space_tags={};this.noescape_tags={};switch(b){case "text":break;case "xml":break;case "html":this.empty_tags={area:1,base:1,basefont:1,br:1,col:1,frame:1,hr:1,img:1,input:1,
isindex:1,link:1,meta:1,param:1};this.boolean_attrs={selected:1,checked:1,compact:1,declare:1,defer:1,disabled:1,ismap:1,multiple:1,nohref:1,noresize:1,noshade:1,nowrap:1};this.preserve_space_tags={pre:1,textarea:1};this.noescape_tags={script:1,style:1};break;default:throw new Error('set_output_mode: unknown mode "'+b+'"');}};a.TemplateCompiler.prototype.compile_top=function(b,c){this.scope=new a.Scope(this,null,"[toplevel]");this.scope.toplevel=true;this.scope.toplevel_def=c;this.compile_node(b);
this.codestr=this._code.join("");this._markup=this._code=null;if(this.codestr=="")throw new Error("template compiled with no output");};a.TemplateCompiler.prototype.uniqueid=function(b){var c=this.next_unique_id[b];if(typeof c!=="number")c=1;this.next_unique_id[b]=c+1;return b+"_"+c};a.TemplateCompiler.prototype._ampRE=/\&/g;a.TemplateCompiler.prototype._ltRE=/\</g;a.TemplateCompiler.prototype._gtRE=/\>/g;a.TemplateCompiler.prototype.htmlencode=function(b){return b.replace(this._ampRE,"&amp;").replace(this._ltRE,
"&lt;").replace(this._gtRE,"&gt;")};a.TemplateCompiler.prototype.jsencode=function(b){return JSON.stringify([b]).replace(/^[^"]*/,"").replace(/[^"]*$/,"")};a.TemplateCompiler.prototype.flush_markup=function(b){if(this._markup.length==0)return-1;var c=this._markup.join("");this._markup=[];var d=this.strings.length;this.strings[d]=c;if(this.debug){b=c.replace(/\r?\n/gm,"\n                                                  // ");c="__m[__n++]=__ts["+d+"];";if(c.length<50)c+="                                                  ".substr(c.length);
this.emit(c,"// ",b,"\n")}else b||this.emit("__m[__n++]=__ts[",d,"];\n");return d};a.TemplateCompiler.prototype.emit=function(){this._markup.length&&this.flush_markup();for(var b=0;b<arguments.length;b++)for(var c=(""+arguments[b]).split("\n"),d=0;d<c.length;d++){if(d>0){this._code.push("\n");this.debug_locs.push(this.source_loc)}this._code.push(c[d])}};a.TemplateCompiler.prototype.emitln=function(){this.emit.apply(this,arguments);this.emit("\n")};a.TemplateCompiler.prototype.markup=function(){for(var b=
0;b<arguments.length;b++)this._markup.push(arguments[b])};a.TemplateCompiler.prototype.warn=function(b){this.markup('<span style="outline-style:solid;color:red;">',this.htmlencode(b),"</span>")};a.TemplateCompiler.prototype.compile_task=function(b,c){if(c.firstChild===null||c.firstChild.nodeType!=3||c.firstChild.nextSibling!==null)throw new Error("mjt.task="+b+" declaration may only contain text");var d=c.firstChild.nodeValue;if(d.match(/;\s*$/)){a.warn("mjt.task=",b,"definition should not end with a semicolon");
d=d.replace(/;\s*$/,"")}this.browser_dom&&d.match(/\/\/ /)&&a.warn('"//" comments in mjt.task=',b,"definition will fail on IE6");this.emitln("var ",b," = this.tasks && this.tasks.",b,";");this.emitln("if (!",b,") { ",b,' = this.mktask("',b,'", (\n',d,")); }");this.scope.has_tasks=true};a.TemplateCompiler.prototype.compile_text=function(b,c,d,e,f){var g=/[^A-Za-z0-9_.]/gm,i=/\}/gm,l=/\]/gm,m={has_subs:false,next_node_leading_ws:null};if(typeof c=="undefined")c=false;if(typeof d=="undefined")d=false;
if(typeof e=="undefined")e=false;if(typeof f=="undefined")f=false;var p,q,r=b.length,t=0,h=b.indexOf("$",t);if(h==-1){p=b.split("\n").length-1;if(d)b=b.replace(/^\s+/m,"");if(e)b=b.replace(/\s+$/m,"");if(c=/\n\s*$/.exec(b)){m.next_node_leading_ws=c[0];b=b.substr(0,c.index)}this.markup(this.htmlencode(b));this.source_loc+=p;return m}for(;h>=0;){q=b.substring(t,h);p=q.split("\n").length-1;if(t==0&&d)q=q.replace(/^\s+/m,"");this.markup(this.htmlencode(q));this.source_loc+=p;h++;if(h>=r){this.warn("premature end of $ substitution in "+
this.jsencode(b));return m}switch(b.charAt(h)){case "$":if(f){this.markup("$");break}h++;this.markup("$");break;case "(":this.markup("$");break;case "{":i.lastIndex=h+1;p=i.exec(b);if(p===null){this.warn("missing close after ${ in "+this.jsencode(b));return m}q=b.substring(h+1,i.lastIndex-1);h=i.lastIndex;if(/\{/.test(q))throw new Error('template compiler: "{" and "}" are forbidden inside "${...}"');c?this.emitln("__m[__n++]=__pkg.runtime.make_attr_safe(",q,");"):this.emitln("__m[__n++]=(",q,");");
m.has_subs=true;this.source_loc+=q.split("\n").length-1;break;case "[":if(f){this.markup("$");break}if(c)throw new Error('template compiler: "$[...]" is illegal in an attribute');l.lastIndex=h+1;p=l.exec(b);if(p===null){this.warn("missing close after $[ in "+this.jsencode(b));return m}q=b.substring(h+1,l.lastIndex-1);h=l.lastIndex;if(/\[/.test(q))throw new Error('template compiler: "[" and "]" are forbidden inside "$[...]"');this.emitln("__m[__n++]=__pkg.runtime.ref(",this.jsencode(q),");");m.has_subs=
true;this.source_loc+=q.split("\n").length-1;break;default:if(f){this.markup("$");break}g.lastIndex=h;p=g.exec(b);if(p===null){q=b.substring(h);h=r}else if(p.index>h){q=b.substring(h,p.index);h=p.index}else{this.warn("unknown character following $ in "+this.jsencode(b));return m}c?this.emitln("__m[__n++]=__pkg.runtime.make_attr_safe(",q,");"):this.emitln("__m[__n++]=",q,";");m.has_subs=true}t=h;h=b.indexOf("$",t)}if(t>=0&&t<r){q=b.substring(t);p=q.split("\n").length-1;if(e)q=q.replace(/\s+$/m,"");
if(c=/\n\s*$/.exec(q)){m.next_node_leading_ws=c[0];q=q.substr(0,c.index)}this.markup(this.htmlencode(q));this.source_loc+=p}return m};a.TemplateCompiler.prototype.compile_onevent_attr=function(b,c){var d=this.uniqueid(b+"_cb");this.emitln("var ",d,' = __pkg.runtime.uniqueid("',b,'");');this.emitln("mjt._eventcb[",d,"] = function (event) {");this.emit(c);this.emitln("}");return"return mjt._eventcb.${"+d+"}.apply(this, [event])"};a.TemplateCompiler.prototype.get_attributes=function(b,c,d){for(var e=
this.mjtns_re.exec(b.nodeName),f=null,g=b.attributes,i=0;i<g.length;i++){var l=g[i];if(l.specified){var m=l.nodeName,p=this.mjtns_re.exec(m);if(p)d[p[1]]=l.nodeValue;else if(e&&m.indexOf(":")==-1){if(typeof d[m]!="undefined")throw new Error("template compiler: ambiguous template attribute: both "+m+" and "+l.nodeName+" are specified");d[m]=l.nodeValue}else if(m=="src")f=l.nodeValue;else{p={name:m};if(typeof l.nodeValue!="undefined")p.value=l.nodeValue;if(this.browser_dom){m.substr(0,2)=="on"&&a.warn(m,
'="..."',"will break on IE6, use","mjt."+m);if(this._ie_attribute_bs)if(m=="style")p.value=""+b.style.cssText;else if(m=="CHECKED")p.value="1";else if(l=b.getAttribute(m,2))p.value=l;if(typeof p.value=="number")p.value=""+p.value}c.push(p)}}}if(this.browser_dom&&this._ie_attribute_bs&&b.nodeName=="INPUT"){p={name:"value",value:b.value};c.push(p)}if(typeof d.src!="undefined")c.push({name:"src",value:d.src});else f!==null&&c.push({name:"src",value:f})};a.TemplateCompiler.prototype.compile_choose=function(b,
c){var d="init";if(c){this.emitln("switch (",c,") {");d="dispatch_init"}else a.log('choose="" is deprecated, use if...elif...else instead');for(var e=b.firstChild;e!=null;){var f=e.nextSibling,g=e.nodeType;if(g==3)e.nodeValue.match(/[^ \t\r\n]/)&&a.warn("only whitespace text is allowed in mjt.choose, found",'"'+e.nodeValue+'"');else if(g==1){g=d;var i={};this.get_attributes(e,[],i);var l=false;if(typeof i.when!="undefined")l=false;else if(typeof i.otherwise!="undefined")l=true;else{a.warn("all elements inside mjt.choose must have a mjt.when= or mjt.otherwise= attribute");
break}if(d=="init")if(l){this.emitln("{");g="closed"}else{this.emitln("if (",i.when,") {");g="open"}else if(d=="open")if(l){this.emitln("} else {");g="closed"}else{this.emitln("} else if (",i.when,") {");g="open"}else if(d.match(/^dispatch/)){d!="dispatch_init"&&this.emitln("break;");if(l)this.emitln("default:");else{this.emit("case ");this.emit(this.jsencode(i.when));this.emitln(":")}g="dispatch"}this.compile_node(e,{choose_state:"in_choose"});d=g}e=f}if(c=="")this.emitln("}");else{d!="dispatch_init"&&
this.emitln("break;");this.emitln("};")}};a.TemplateCompiler.prototype.compile_def=function(b){var c=b.match(/^([^(]+)\(([^)]*)\)$/);if(c){var d=c[1];c=c[2];this.debug&&this.emitln("// mjt.def=",b);this.emitln("var ",d," = function (",c,") {");this.scope=new a.Scope(this,this.scope,b)}else a.warn("bad mjt.def=",b,": must contain an argument list")};a.TemplateCompiler.prototype.complete_def=function(){this.scope=this.scope.parent;this.scope.toplevel&&this.output_mode=="text"?this.emitln("return __pkg.runtime.cleanup_noquote(__m);"):
this.emitln("return __m;");this.emitln("};")};a.TemplateCompiler.prototype.generate_open_tag=function(b,c,d,e){this.markup("<",b);for(var f={},g=0;g<c.length;g++){var i=c[g];if(typeof i.value=="function")a.warn("ignoring function-valued attr",b,i.name,i.value);else f[i.name]=i.value}if("id"in f)e=false;if(d){b=this.uniqueid("dattrs");g=this.uniqueid("sattrs");this.emitln("var ",b," = (",d,");");this.emitln("var ",g," = {};");for(g=0;g<c.length;g++){d=c[g].name;f=c[g].value;this.emit("if (!(",this.jsencode(d),
" in ",b,")) {");if(d in this.boolean_attrs)this.markup(" ",d);else{this.markup(" ",d,'="');this.compile_text(f,true);this.markup('"')}this.emitln(" }")}e&&this.emitln('if (this.subst_id && !("id" in ',b,")) ",b,".id=this.subst_id;");c=this.uniqueid("di");this.emitln("for (var ",c," in ",b,") {");this.emitln("__m[__n++]=' ' + "+c+";");this.emitln("__m[__n++]=__pkg.runtime.bless('=\"');");this.emitln("__m[__n++]=__pkg.runtime.htmlencode(''+"+b+"["+c+"]);");this.emitln("__m[__n++]=__pkg.runtime.bless('\"');");
this.emitln("}")}else{for(g=0;g<c.length;g++){i=c[g];this.markup(" ",i.name,'="');this.compile_text(i.value,true);this.markup('"')}e&&this.emitln("if (this.subst_id) { __m[__n++]=__pkg.runtime.bless(' id=\"' + this.subst_id + '\"'); }")}};a.TemplateCompiler.prototype.compile_node=function(b,c){if(typeof c=="undefined")c={};var d="none";if(typeof c.choose_state!="undefined")d=c.choose_state;if(typeof b.getUserData!="undefined")try{var e=b.getUserData("lineNumber");if(e!==null){if(typeof e=="string")e=
parseInt(e);this.source_loc=e}}catch(f){this.source_loc=null}e=null;switch(b.nodeType){case 1:this.compile_element(b,d,c.leading_ws);break;case 2:break;case 3:e=this.compile_text(b.nodeValue,false,c.trim_leading_ws,c.trim_trailing_ws).next_node_leading_ws;break;case 4:c.leading_ws&&this.markup(c.leading_ws);this.compile_text(b.nodeValue,false);break;case 5:c.leading_ws&&this.markup(c.leading_ws);this.markup("&"+b.nodeName+";");break;case 6:a.warn("template compiler: skipping dom node type",b.nodeType);
break;case 7:a.warn("template compiler: got <? ?>",b.nodeName,b.nodeValue);break;case 8:c.leading_ws&&this.markup(c.leading_ws);this.output_mode!="text"&&this.markup("<!--"+b.nodeValue+"--\>");break;case 9:a.warn("template compiler: skipping dom node type",b.nodeType);break;case 10:c.leading_ws&&this.markup(c.leading_ws);this.markup("<!DOCTYPE "+b.nodeName+' PUBLIC "'+b.publicId+'" "'+b.systemId+'">');a.warn("ignoring DOCTYPE",b.nodeName,b.nodeValue);break;case 11:a.warn("template compiler: skipping dom node type",
b.nodeType);break;case 12:a.warn("template compiler: skipping dom node type",b.nodeType);break;default:a.warn("template compiler: unknown dom node type",b.nodeType)}return e};a.TemplateCompiler.prototype.compile_element=function(b,c,d){var e=[],f=true,g=b.nodeName,i=g.toLowerCase(),l={},m=[];this.get_attributes(b,m,l);var p={};for(ai=0;ai<m.length;ai++){var q=m[ai];p[q.name]=q}if(this.scope.toplevel){if(typeof l.def!="undefined")throw new Error('template compiler: def="'+l.def+'" illegal at top element');
l.def=this.scope.toplevel_def}if(this.output_mode=="text")l.strip="1";var r=this.mjtns_re.exec(b.nodeName);if(r)switch(r[1]){case "script":l.script="";break;case "none":a.warn("<mjt:none> is deprecated, use <mjt:block> instead");l.strip="1";break;case "block":l.strip="1";break;case "task":if(typeof l["var"]=="string")l.task=l["var"];else a.error("mjt:task requires var= or mjt:var= attribute");break;case "doc":this.scope.toplevel||a.error("mjt:doc is only legal as the toplevel tag");l.strip="1";this.document_content_type=
typeof l.type!="undefined"?l.type:"text/html";if(typeof l["xml-pi"]!="undefined")if(l["xml-pi"]=="true"||l["xml-pi"]=="1")this.output_prefix='<?xml version="1.0" encoding="utf-8" ?>\n';else if(l["xml-pi"]=="false"||l["xml-pi"]=="0")this.output_prefix=null;if(this.document_content_type=="text/html")this.set_output_mode("html");else if(/^text\//.test(this.document_content_type))this.set_output_mode("text");else{/^application\/.*xml$/.test(this.document_content_type);this.set_output_mode("xml")}break;
default:a.error("ignoring unknown mjt tag",g);break}r=null;var t=false;if(typeof l.trim!="undefined")t=true;if(b.firstChild!==null)r=function(v){v=v.firstChild;var w={};if(t)w.trim_leading_ws=true;for(;v!=null;){var y=v.nextSibling;if(t&&y===null)w.trim_trailing_ws=true;w.leading_ws=this.compile_node(v,w);w.trim_leading_ws=false;w.trim_trailing_ws=false;v=y}return w.leading_ws};if(!(i=="script"&&this.browser_dom)){if(i in this.noescape_tags)r=function(v){v=v.firstChild;if(v!==null)if(v.nodeType!=
3||v.nextSibling)a.warn("<"+g+"> tag should contain only text");else if(v.nodeValue.match(new RegExp("</"+g)))a.warn("illegal content for HTML script tag, removed");else{this.emitln(" __m[__n++]=(function () {");this.emitln("var __m=__pkg.runtime.new_markuplist(),__n=0;");v=this.compile_text(v.nodeValue,false,false,false,true);this.emitln("return __pkg.runtime.cleanup_noquote(__m, "+this.jsencode(i)+");");this.emitln("})();");return v.next_node_leading_ws}};if(typeof l.task!="undefined")this.compile_task(l.task,
b);else{if(typeof l.def!="undefined"){typeof m.id!="undefined"&&a.warn("mjt.def=",l.def,'must not have an id="..." attribute');this.compile_def(l.def,b);if(this.scope.parent.toplevel){this.emitln("var __pkg = this.tpackage;");this.emitln("var exports = this.exports;");this.emitln("var __ts=__pkg._template_fragments;");this.emitln("var __m=__pkg.runtime.new_markuplist(),__n=0;");this.output_prefix!=null&&this.markup(this.output_prefix)}else this.emitln("var __m=__pkg.runtime.new_markuplist(),__n=0;");
e.push(function(){var v=this.scope;if(v.has_tasks)if(!f||typeof l.strip!="undefined")a.error("can't strip toplevel tag of mjt.def=\""+l.def+'" tag because it contains tasks');this.complete_def();var w=l.def.replace(/\(.*/,"");this.scope.toplevel&&this.document_content_type!=null&&this.emitln(w,".doc_content_type = ",this.jsencode(this.document_content_type),";");this.scope.toplevel||this.emitln(w," = __pkg.runtime.tfunc_factory(",this.jsencode(l.def),", ",w,", ","__pkg",", ",v.has_tasks,", ",false,
");");this.scope.parent&&this.scope.parent.toplevel&&this.emitln("exports.",w," = ",w,";");typeof v.microdata!="undefined"&&this.emitln(w,".source_microdata = ",JSON.stringify(v.microdata.lastvalue),";")})}if(typeof l.when!="undefined"){this.flush_markup();c!="in_choose"&&a.warn("unexpected mjt.when, in choice state",c);e.push(function(){this.flush_markup()})}if(typeof l.otherwise!="undefined"){this.flush_markup();c!="in_choose"&&a.warn("unexpected mjt.otherwise, in choice state ",c);e.push(function(){this.flush_markup()})}var h=
{meta:"content",audio:"src",embed:"src",iframe:"src",img:"src",source:"src",video:"src",a:"href",area:"href",link:"href",object:"data",time:"datetime"},j=this.scope.microdata;if(j&&typeof l.itemprop!="undefined"){"itemprop"in p||m.push({name:"itemprop",value:l.itemprop});if(j.item===null)throw new Error("got mjt.itemprop= without containing mjt.item=");if(typeof l["for"]!="undefined")throw new Error(g+' element has both acre:itemprop= and mjt.for="" attributes');c="itemvalue["+this.jsencode(l.itemprop)+
"]";l["for"]="itemindex,itemvalue in ((typeof "+c+' == "object" && '+c+" !== null && "+c+" instanceof Array) ? "+c+" : ["+c+"])";if(i in h){c=h[i];c in p||m.push({name:c,value:"$itemvalue"})}else if(b.firstChild===null)l.content="itemvalue";e.push(function(){var v=l.itemprop;if(i in h){var w=h[i];j.item[v]=w in m?m[w]:null}else j.item[v]=b.firstChild===null?null:j.lastvalue})}if(typeof l["for"]!="undefined"){var n=/^(\w+)(\s*,\s*(\w+))?\s+in\s+(.+)$/.exec(l["for"]);if(n){c=n[1];q=n[3];n=n[4];var o;
if(q){o=c;c=q}else{o=this.uniqueid(c+"_index");c=c}this.emitln("__pkg.runtime.foreach(this, (",n,"), function (",o,", ",c,") {");var s=this.uniqueid("once");this.emitln("var ",s," = 1;");this.emitln("while (",s,") {");e.push(function(){this.emitln(s,"--;");this.emitln("} /* while once */");this.emitln("return ",s," ? __pkg.runtime._break_token :  __pkg.runtime._continue_token;");this.emitln("}); /* foreach */")})}else if(l["for"].charAt(0)=="("){this.emitln("for ",l["for"]," {");e.push(function(){this.emitln("}")})}else a.warn("bad mjt.for= syntax")}if(typeof l["if"]!=
"undefined"){this.emitln("if (",l["if"],") {");e.push(function(){this.emitln("}")})}if(typeof l.elif!="undefined"){if(!/^\s*$/.exec(this._markup.join("")))throw new Error('only whitespace is permitted between if="" and elif=""');this._markup=[];this.emitln("else if (",l.elif,") {");e.push(function(){this.emitln("}")})}if(typeof l["else"]!="undefined"){if(!/^\s*$/.exec(this._markup.join("")))throw new Error('only whitespace is permitted between if="" and else=""');this._markup=[];this.emitln("else {");
e.push(function(){this.emitln("}")})}if(typeof l.script!="undefined"){r=false;switch(l.script){case "":break;case "1":break;case "ondomready":r=true;break;default:a.warn("reserved mjtattrs.script= value:",l.script);break}r&&this.emitln("__pkg.runtime.ondomready(function () {");if(c=b.firstChild)if(c.nodeType!=3||c.nextSibling)a.warn("the mjt.script element can only contain javascript text, not HTML.  perhaps you need to quote '<', '>', or '&' (this is unlike a <script> tag!)");else{c=c?c.nodeValue:
"";c.match(/\/\/ /)&&this.browser_dom&&a.warn('"//" comments in mjt.script= definition will fail on IE6');c=c.split("\n");for(q=0;q<c.length;q++){this.emitln(c[q]);this.source_loc++}}r&&this.emitln("}, this);");f=false;r=null}if(typeof l.choose!="undefined"){this.flush_markup();r=function(v){this.compile_choose(v,l.choose)}}if(typeof l.replace!="undefined"){f=false;r=function(){this.emitln("__m[__n++]=(",l.replace,");")}}if(typeof l.content!="undefined")r=function(){this.emitln("__m[__n++]=(",l.content,
");")};for(var u in l)if(u.substr(0,2)=="on")if(this.browser_target){q={name:u,value:this.compile_onevent_attr(u,l[u])};m.push(q)}else a.warn("mjt:onevent= attributes only make sense if targeting a browser");this.debug&&this.browser_dom&&typeof l.def!="undefined"&&m.push({name:"mjt_template",value:l.def});if(j&&typeof l.item!="undefined"){"item"in p||m.push({name:"item",value:l.item});j.stack.push(j.item);if("id"in p){c=p.id.value;j.item=c in j.items?j.items[c]:(j.items[c]={})}else j.item={};if(l.item!=
"")j.item.__type=l.item;this.emitln("var item = itemvalue;");e.push(function(){j.lastvalue=j.item;j.item=j.stack.pop()})}if(j&&typeof l.itemfor!="undefined"){"itemfor"in p||m.push({name:"itemfor",value:l.itemfor});j.stack.push(j.item);if(typeof j.items[l.itemfor]=="undefined")j.items[l.itemfor]={};j.item=j.items[l.itemfor];e.push(function(){j.lastvalue=j.item;j.item=j.stack.pop()})}p=typeof l.strip!="undefined"?l.strip:null;u=null;if(p=="1")f=false;if(f){c=typeof l.attrs!="undefined"?l.attrs:null;
if(p!==null){u=this.uniqueid("strip");this.emitln("var ",u," = (",p,");");this.emitln("if (!",u,") {")}d&&typeof l.def==="undefined"&&this.markup(d);typeof l.def!="undefined"?this.generate_open_tag(g,m,c,true):this.generate_open_tag(g,m,c,false);r===null&&this.output_mode=="xml"?this.markup("/>"):this.markup(">");p!==null&&this.emitln("}")}if(r!==null)if(i in this.empty_tags)a.warn('tag "'+g+'" must be empty, content ignored');else var z=r.apply(this,[b]);if(f)if(!(r===null&&this.output_mode=="xml"))if(!(i in
this.empty_tags))if(u){this.emitln("if (!",u,") {");typeof z!=="undefined"&&this.markup(z);this.markup("</",g,">");this.emitln("}")}else{typeof z!=="undefined"&&this.markup(z);this.markup("</",g,">")}for(d=e.length-1;d>=0;d--)e[d].apply(this,[])}}}})(mjt);
(function(a){a.run=function(c,d,e){var f;if(typeof a.app=="undefined")a.app=new a.App;if(arguments.length==0){var g=new a.TemplatePackage;return a.run_page(g)}if(typeof c===null)throw new Error("mjt.run: null target");else if(typeof c=="string"){f=c;c=document.getElementById(f)}else if(typeof c=="object"){if(c.id=="")c.id=a.uniqueid("run_target");f=c.id}if(arguments.length==1){g=new a.TemplatePackage;g.source=window.location.protocol+"//"+window.location.host+window.location.pathname+"#"+f;return a.run_element(g,
c,e)}if(typeof d!=="function"){a.error("invalid template function",d,arguments);throw new Error("mjt.run: invalid args");}g=new d;g.subst_id=f;g.render(e).display();return g.exports};var b=function(c,d){var e=[],f;for(f=d.firstChild;f!==null;f=f.nextSibling)f.nodeType==1&&e.push(f);for(var g=0;g<e.length;g++){f=e[g];switch(f.nodeName){case "TITLE":c.title=f.innerHTML;break;case "META":switch(f.name){case "description":c.summary=f.content;break;case "author":c.author=f.content;break;case "content-language":c.language=
f.content;break;case "x-mjt-id":c.id=f.content;break}break;case "SCRIPT":break;case "STYLE":break;default:break}}};a.run_page=function(c){b(c,document.getElementsByTagName("head")[0]);var d=a.Succeed();c.source=window.location.protocol+"//"+window.location.host+window.location.pathname;for(var e=document.createElement("div"),f=document.getElementsByTagName("body")[0],g=f.firstChild;g!==null;){var i=g;g=g.nextSibling;if(!(i.nodeName==="IFRAME"&&i.className==="mjt_dynamic")){f.removeChild(i);e.appendChild(i)}}e.id=
a.uniqueid("mjt_body");e.style.display="none";f.appendChild(e);if(f.style.display=="none")f.style.display="";d.enqueue().onready(function(){a.run_element(c,e,[])});return c.namespace};a.run_element=function(c,d,e){c.load_document(d,e);c.tcall.subst_id=d.id;c.tcall.display();return c.tcall.exports};a.load_element=function(c){var d=typeof c=="string"?document.getElementById(c):c,e=new a.TemplatePackage;e.source=window.location.protocol+"//"+window.location.host+window.location.pathname;if(typeof c==
"string")e.source+="#"+c;e.load_document(d,[]);return e};a.load_from_iframe=function(c){var d=new a.TemplatePackage;d.source=window.location.protocol+"//"+window.location.host+window.location.pathname;var e=c;if(typeof c=="string")e=document.getElementById(c);if(e.nodeName!="IFRAME"){a.error("called mjt.load_from_iframe on node tag",e.nodeName);return null}c=e.contentWindow||e.contentDocument;if(c.document)c=c.document;e=c.getElementsByTagName("body")[0];d.load_document(e,[]);return d.namespace};
a.load_string=function(c){var d=document.createElement("div");d.innerHTML=c;return a.load_element(d)};a.replace_html=function(c,d){var e=document.createElement("div"),f=a.flatten_markup(d);e.innerHTML=f;if(c.parentNode===null)a.warn("attempt to replace html that has already been replaced?");else{f=e.firstChild;if(f===null)a.warn("bad html in replace_innerhtml");else{if(f.nextSibling){a.warn("template output should have a single toplevel node");f=e}c.parentNode.replaceChild(f,c);if(f.style&&f.style.display==
"none")f.style.display=""}}}})(mjt);typeof jQuery!="undefined"&&function(a){if(typeof a!="undefined")a.fn.mjt=function(b){var c=mjt.flatten_markup(b);return this.each(function(){this.innerHTML=c})}}(jQuery);
(function(a){a.App=function(b){if(typeof b=="undefined")b={};this.state=null;this.yui_history_id="mjtapp";this.argschema={"mjt.server":{key:"mjt.server",statekey:"service_url",validator:a.validators.service_host},"mjt.debug":{key:"mjt.debug",statekey:"debug",validator:a.validators.flag}};for(var c in b)this.argschema[c]=b[c];this._onstatechange={};this.init()};a.App.prototype.init=function(){this.init_state();a.service_url=this.state.service_url;a.freebase.set_service_url(this.state.service_url);
a.debug=this.state.debug;a.Task.debug=this.state.debug;a.urlquery=this.state;return this};a.App.prototype.onstatechange=function(){this._onstatechange[a.uniqueid("statecb")]=a.vthunk(arguments);return this};a.App.prototype.refresh=function(){for(var b in this._onstatechange)this._onstatechange[b].apply(this,[]);return this};a.App.prototype._handle_onhistory=function(b){a.log("yui setting state",b,typeof this.state);if(b===null){b=YAHOO.util.History.getCurrentState(this.yui_history_id);a.log("yui history onLoadEvent:",
b)}else a.log("yui history state:",b);this.state=rison.decode_object(b);this.refresh()};a.App.prototype.init_state=function(){var b;if(typeof window!="undefined")b=window.location.search;if(typeof acre!="undefined")b=acre.environ.query_string;this.state=typeof b=="string"&&b.length>0&&b.charAt(0)=="?"?this.decode_uristate(b.substr(1)):this.decode_uristate("");if(typeof YAHOO==="undefined"||!YAHOO.util.History)return this;b=YAHOO.util.History;var c=b.getBookmarkedState(this.yui_history_id);c||(c=rison.encode_object(this.state));
a.log("yui history initial state",c);b.register(this.yui_history_id,c,a.vthunk("_handle_onhistory",this));b.onLoadEvent.subscribe(a.vthunk("_handle_onhistory",this,null));b.initialize("yui-history-iframe","yui-history-field");return this};a.App.prototype.mark_history=function(){if(this.yui_history_id!==null){var b=rison.encode_object(this.state);YAHOO.util.History.navigate(this.yui_history_id,b)}};a.Validator=function(){};a.Validator.prototype.encode=function(b){if(b!=this.default_value)return this.encodestr(b)};
a.Validator.prototype.decode=function(b){if(typeof b=="undefined")return this.default_value;return this.decodestr(b)};a.validators={};a.validators.flag=new a.Validator;a.validators.flag.default_value=false;a.validators.flag.encodestr=function(b){return b?"1":undefined};a.validators.flag.decodestr=function(b){return b=="1"?true:false};a.validators.service_host=new a.Validator;a.validators.service_host.default_value="http://www.freebase.com";a.validators.service_host.encodestr=function(b){b=b.replace(/^http:\/\//,
"");if(typeof window!="undefined"&&b==window.location.host)return".";return b};a.validators.service_host.decodestr=function(b){if(b.substr(0,4)=="http")url=b;else if(b=="."){if(typeof window!="undefined")url=window.location.protocol+"//"+window.location.host;if(typeof acre!="undefined")url=acre.environ.server_protocol+"//"+acre.environ.host}else url="http://"+b;return url};a.App.prototype.encode_uristate=function(b){var c={},d,e,f={};for(d in this.argschema){e=this.argschema[d];f[e.statekey]=e}for(d in this.state){e=
f[d];if(typeof e!="undefined")c[e.key]=e.validator.encode(this.state[d]);else c[d]=this.state[d]}for(d in b){e=f[d];if(typeof e!="undefined")c[e.key]=e.validator.encode(b[d]);else c[d]=b[d]}for(d in c)typeof c[d]=="undefined"&&delete c[d];return a.formencode(c)};a.App.prototype.decode_uristate=function(b){var c={},d=a.formdecode(b),e;for(e in d){b=this.argschema[e];if(typeof b!="undefined")c[b.statekey]=b.validator.decode(d[e]);else c[e]=d[e]}for(e in this.argschema){b=this.argschema[e];d=b.statekey;
if(!(d in c))c[d]=b.validator.default_value}return c};a.App.prototype.href=function(b,c){if(typeof b=="undefined"||b===null)b=location.protocol+"//"+location.host+location.pathname;var d=this.encode_uristate(c);return b+(d?"?"+d:"")}})(mjt);var assert={};
assert.critical=function(a,b){if(!a){if(typeof mjt!=="undefined"&&mjt.error)mjt.error("Internal Error: "+b);else typeof console!=="undefined"&&console.error&&console.error("Internal Error: "+b);if(!document.getElementById("error-dialog")){var c="";c+='<div style="font-weight:bold;">Internal Error</div>';c+=b;c+='<div style="padding-top: 5px";><a href="http://www.metaweb.com/error-acre.html" target="_blank">Please report this error!</a></div>';assert.error_dialog(c)}}};
assert.error_dialog=function(a){var b=document.createElement("div");b.style.cssText="position: absolute; top: 30px; left: 50%; width: 350px; margin: 0 0 0 -175px; padding: 15px; background-color: #fce2db; border: 1px solid #f3c5ac; color: #676767; font-size: 12px; z-index: 100;";b.innerHTML='<div id="error-dialog" style="float:right; color: #1170a3; margin: -10px -5px 0 0; cursor: pointer;" onclick="document.body.removeChild(this.parentNode);">x</div>'+a;document.body.appendChild(b)};
var unicode={};unicode.escape_char=function(a){a=a.charCodeAt(0).toString(16).toUpperCase();if(a.length===1)return"\\u000"+a;if(a.length===2)return"\\u00"+a;if(a.length===3)return"\\u0"+a;if(a.length===4)return"\\u"+a;return null};unicode.escape_str=function(a){return a.replace(/[^\u0020-\u007F]/g,unicode.escape_char)};
(function(){var a={expires:30},b={};$.extend({localStore:function(c,d,e){var f=document.location.hostname,g=document.location.protocol;if(typeof d!=="undefined"){var i=JSON.stringify(d);if(!e&&window.globalStorage)if(d===null)delete window.globalStorage[f][g+c];else window.globalStorage[f][g+c]=i;else if(!e&&window.localStorage&&window.localStorage.setItem)d===null?window.localStorage.removeItem(g+c):window.localStorage.setItem(g+c,i);else if(e!==false)d===null?$.cookie(c,null,a):$.cookie(c,i,a);
else if(d===null)delete b[c];else b[c]=i;return d}else{if(!e&&window.globalStorage){if(window.globalStorage[f][g+c])d=window.globalStorage[f][g+c].value}else d=!e&&window.localStorage?window.localStorage.getItem(g+c):e!==false?$.cookie(c):b[c];if(d!=""&&d!==null&&d!==undefined)return JSON.parse(d,null)}return null}})})();
var zen=function(){function a(l,m){if(!l||!l.length)return"";var p=l.shift().split("+"),q=p.length-1,r=a(l,m+1);return p.map(function(t,h){var j=h===q?r:"";i.newTag();var n=t.replace(c,i.tag).replace(d,i.id).replace(e,i.className).replace(f,i.attr).replace(g,i.mult);if(n.length&&!b.length)b=n;return i.html(j,m)}).join("\n")}var b="",c=/^[\w:]+/,d=/^\#[:\w\$]+/,e=/^(\.[\w\$]+)+/,f=/^\[.+\]/,g=/^\*\d+/,i=function(){var l=function(p){return(new Array(p+1)).join("  ")},m;return{newTag:function(){return m=
{tagName:"div"}},tag:function(p){m.tagName=p;return""},id:function(p){m.id=p.slice(1);return""},className:function(p){m.className=p.slice(1).replace(/\./g," ");return""},attr:function(p){m.attrs=p.slice(1,-1);return""},mult:function(p){m.multiplier=parseInt(p.slice(1),10);return""},html:function(p,q){for(var r="<"+m.tagName+(m.id?' id="'+m.id+'"':"")+(m.className?' class="'+m.className+'"':"")+(m.attrs?" "+m.attrs:"")+">"+(p?"\n"+p+"\n"+l(q):"")+"</"+m.tagName+">",t=[],h=0,j=m.multiplier||1;h<j;h++)t[h]=
r.replace(/\$/g,h+1);return l(q)+t.join("\n"+l(q))}}}();return{convert:function(l,m){b="";var p=l.split("|"),q=p[0].split(">");p=p[1];q=a(q,m||0);if(p)if(p==="e")q=q.replace(/</g,"&lt;").replace(/>/g,"&gt;");else b="Unknown filter "+p;if(/^[\.\#\[\*]$/.test(b))b="";return{out:q,error:b}}}}();
function FreebaseStore(a,b){this._url=a||SERVER.acre.freebase.service_url;this._site_url=SERVER.acre.freebase.site_host;this._acre_server=b||SERVER.acre.host.name+(SERVER.acre.host.port===80?"":":"+SERVER.acre.host.port);this._handlers=[];this._user=null;return this}
(function(){var a=SERVER.appeditor.service_path,b=mjt.define_task(mjt.freebase.FreebaseJsonPTask,[{name:"service"},{name:"args"}]);b.prototype.request=function(){return this.service_request(a+this.service,this.args)};b.prototype.response=function(g){return this.ready(g.result)};var c=mjt.define_task(mjt.freebase.FreebaseXhrTask,[{name:"service"},{name:"args"}]);c.prototype.request=function(){var g=a+this.service;if(this.args)g+="?"+mjt.formencode(this.args);return this.xhr_request("GET",g)};var d=
mjt.define_task(mjt.freebase.FreebaseXhrTask,[{name:"service"},{name:"args"}]);d.prototype.request=function(){return this.xhr_form_post(a+this.service,this.args)};var e=mjt.define_task(null,[{name:"service"},{name:"form"},{name:"args"}]);e.prototype.dynamic_iframe=function(g){var i=document.createElement("iframe");if(typeof g==="string"){i.id=g;i.name=g}i.style.display="none";i.className="mjt_dynamic";return i};e.prototype.request=function(){function g(){var r=l.contentWindow||l.contentDocument;if(r.document)return r.document;
return r}function i(){window.setTimeout(function(){$(l).remove()},1)}this.domid=mjt.uniqueid("mjt_iframe");var l=this.dynamic_iframe(this.domid);$("body").append(l);var m=this.form,p=this,q=window.setTimeout(function(){p.error("timeout","Upload timed out - no response from server.");i()},3E4);l.onload=function(){window.clearTimeout(q);var r=$(g(l).body).text();r=JSON.parse(r);if(r.code==="/api/status/ok"){p.result=r.result;p.ready(p.result)}else p.error(r.code,r.messages[0].message);i()};m.attr({target:this.domid,
action:mjt.form_url(a+this.service,this.args),method:"POST",enctype:"multipart/form-data"}).submit()};var f=mjt.define_task(mjt.freebase.FreebaseJsonPTask,[{name:"service_url","default":null}]);f.prototype.request=function(){this.jsonp.cache_controller={is_fresh:function(){return false}};return this.service_request("/acre/touch?_="+ +new Date)};f.prototype.response=function(){return this.ready(null)};FreebaseStore.prototype.Jsonp=b;FreebaseStore.prototype.XhrGet=c;FreebaseStore.prototype.XhrPost=
d;FreebaseStore.prototype.FileUpload=e;FreebaseStore.prototype.AppTouch=f;FreebaseStore.prototype.set_user=function(g){if(g){this._user=new AcreUser(this,g);if(g.apps)this._user_apps=g.apps;mjt.freebase.freebase_user={name:g.name,id:"/user/"+g.name}}else{this._user_apps=this._user=null;mjt.freebase.freebase_user=null}};FreebaseStore.prototype.t_init=function(){var g=this;mjt.app=new mjt.App;mjt.freebase.service_url=window.location.protocol+"//"+window.location.host;mjt.freebase.xhr_ok=true;return this.XhrGet("init_store").onready(function(i){g._acre_server=
i.host.name+(i.host.port===80?"":":"+i.host.port);g._handlers=i.acre_handlers;g._version=i.version;g.set_user(i.user)}).enqueue()};FreebaseStore.prototype.destroy=function(){};b=mjt.define_task(null,[{name:"store"}]);b.prototype.request=function(){this.url=window.location.protocol+"//appeditor-services.site.freebase.dev."+this.store.get_acre_host()+"/check_thirdparty_cookies";var g=this;this.jsonp=mjt.JsonP();this.jsonp.set_timeout().jsonp_request_form(this.url,null,"callback").onready(function(i){i.result===
"success"?g.ready():g.error()}).onerror("error",g)};FreebaseStore.prototype.TestCookies=b;FreebaseStore.prototype.get_acre_version=function(){return this._version};FreebaseStore.prototype.get_user=function(){return this._user};FreebaseStore.prototype.get_user_apps=function(g){if(g){for(var i=0;i<this._user_apps.length;i++)if(this._user_apps[i].appid==g)return this._user_apps[i].appid;return null}else return this._user_apps};FreebaseStore.prototype.set_user_apps=function(g){this._user_apps=g};FreebaseStore.prototype.t_refresh_user_apps=
function(){var g=this;g.XhrGet("list_user_apps").enqueue().onready(function(i){g._user_apps=i})};FreebaseStore.prototype.get_url=function(){return this._url};FreebaseStore.prototype.get_service_path=function(){return a};FreebaseStore.prototype.get_name=function(){var g=this._name?this._name:"???";if(g==="OTG")g="";return g};FreebaseStore.prototype.get_acre_handlers=function(){return this._handlers};FreebaseStore.prototype.get_supported_mime_types=function(g){assert.critical(g,"Can't list supported mimetype");
return this._handlers[g].supported_mime_types};FreebaseStore.prototype.get_acre_host=function(){return this._acre_server};FreebaseStore.prototype.get_freebase_url=function(){return this._site_url};FreebaseStore.prototype.get_user_new_app_path=function(g,i){return"//"+i+"."+g.get_name()+".user.dev"};FreebaseStore.prototype.get_user_default_app_host=function(g){return g.get_name()+".user.dev."+this.get_acre_host()};FreebaseStore.prototype.get_user_view_url=function(g){return this.get_freebase_url()+
"/view/user/"+g.get_name()};FreebaseStore.prototype.get_user_image_url=function(g){return this.get_url()+"/api/trans/image_thumb/user/"+g.get_name()+"?maxwidth=30&maxheight=30&mode=fillcrop"};FreebaseStore.prototype.validate_filename=function(g){if(!/^[A-Za-z][\-_0-9A-Za-z\.]+$/.test(g))return false;if(g in{acre:true,status:"",api:true})return false;return true};mjt.label_package("FreebaseStore")})();var AcreDoc;
(function(){AcreDoc=function(a,b,c,d){assert.critical(a,"Must specify app when creating a file");this._app=a;this._name=b&&this._app.get_store().validate_filename(b)?b:this._app.get_untitled_file_name();this._acre_handler=c.acre_handler||"mjt";this._mime_type=c.content_type||"text/plain";this._revision=c.revision||null;this._based_on=c.based_on||null;this._has_been_saved=c.has_been_saved||false;this._dom_element=document.createElement("div");this._dom_element.className="file";this._event_handlers=
{};this._initial_state=d||null;a=!this.has_been_saved();this._dirty_state={name:a,content:a,metadata:a,to_delete:false,revision:false,editor:false};this._loaded_editors={};this._current_editor=null;this._app.register_file(this);return this};AcreDoc.prototype.t_get_history=function(){var a={fileid:this.get_fileid()};return this.get_store().XhrGet("get_file_history",a).enqueue()};AcreDoc.prototype.t_get_revision=function(a){var b={fileid:this.get_fileid()};if(this.get_app().get_repository_capability("versioned")){b.revision=
a||this.get_revision();return b.revision?this.get_store().XhrGet("get_file_revision",b):mjt.Succeed({text:""})}else return this.get_store().XhrGet("get_file_revision",b)};AcreDoc.prototype.hide=function(){this._current_editor&&this._current_editor.hide();$(this._dom_element).hide()};AcreDoc.prototype.destroy=function(){for(var a in this._loaded_editors){var b=this._loaded_editors[a];b.destroy&&b.destroy()}$(this._dom_element).remove()};AcreDoc.prototype.is_writable=function(){return this.get_app().is_writable()};
AcreDoc.prototype.has_been_saved=function(){return!!this._has_been_saved};AcreDoc.prototype.is_dirty=function(a){if(a)return this._dirty_state[a];else for(var b in this._dirty_state)if(this._dirty_state[b]===true)return true;return false};AcreDoc.prototype.get_element=function(){return this._dom_element};AcreDoc.prototype.get_store=function(){return this.get_app().get_store()};AcreDoc.prototype.get_app=function(){return this._app};AcreDoc.prototype.get_name=function(){return this._name};AcreDoc.prototype.get_fileid=
function(){var a=this._old_name||this._name;return this.get_app().get_path()+"/"+a};AcreDoc.prototype.get_relative_path=function(){return this.get_name()};AcreDoc.prototype.get_revision=function(){return this._revision};AcreDoc.prototype.get_acre_handler=function(){return this._acre_handler};AcreDoc.prototype.get_mime_type=function(){return this._mime_type};AcreDoc.prototype.is_library=function(){return this._library};AcreDoc.prototype.get_based_on=function(){return this._based_on};AcreDoc.prototype.get_acre_url=
function(a){return this.get_app().get_base_url()+"/"+this.get_name()+(a?"?acre.console=1":"")};AcreDoc.prototype.set_name=function(a){if(a!==this.get_name()){if(!/^[\-_0-9A-Za-z\.]+$/.test(a))throw"File names can only contain alphanumeric characters, ., - and _";if(!/^[A-Za-z]/.test(a))throw"File names must be begin with a letter";if(!/[0-9A-Za-z]$/.test(a))throw"File names cannot end with a special character";this._old_name=this.get_name();this.get_app().unregister_file(this._old_name);this._name=
a;this.get_app().register_file(this);this.set_dirty("name")}};AcreDoc.prototype.set_acre_handler=function(a){if(a!==this._acre_handler){this._acre_handler=a;this.set_dirty("metadata");this.set_dirty("editor")}};AcreDoc.prototype.set_mime_type=function(a){if(a!==this._mime_type){this._mime_type=a;this.set_dirty("content");this.set_dirty("editor")}};AcreDoc.prototype.set_revision=function(a){if(this.is_dirty("content")||a!==this._revision){this._revision=a;this.set_dirty("revision");this.set_dirty("editor")}this.set_dirty("content",
false);this.set_dirty("to_delete",false)};AcreDoc.prototype.set_dirty=function(a,b){var c=a||"content",d=typeof b=="undefined"?true:b;if(c==="all")for(var e in this._dirty_state)this._dirty_state[e]=d;else this._dirty_state[c]=d};AcreDoc.prototype.t_save=function(a){var b=this;if(b.is_dirty("to_delete"))return b.t_delete();var c={fileid:b.get_fileid()},d=b.get_store().XhrPost("save_text_file",c);if(!b.has_been_saved()&&b.get_based_on())c.based_on=b.get_based_on().id;if(b.is_dirty("name"))c.name=b.get_name();
if(b.is_dirty("metadata")||!b.has_been_saved())c.acre_handler=b.get_acre_handler();if(!a&&b.get_revision()&&!(b.is_dirty("content")&&b.is_dirty("revision")))c.revision=b.get_revision();if(b.is_dirty("content")){a=b.get_editor_state();if(a.form)d=b.get_store().FileUpload("save_binary_file",a.form,c);else{c.text=a.text;c.content_type=b.get_mime_type()}}else if(b.is_dirty("revision"))d=b.get_store().XhrPost("set_file_revision",c);d.onready(function(e){if(e.revision)b._revision=e.revision;if(e.content_type)b._mime_type=
e.content_type;delete b._old_name;b._has_been_saved=true;b.set_dirty("all",false);b._current_editor&&typeof b._current_editor.refresh==="function"&&b._current_editor.refresh()}).onerror(function(e,f,g){if(e==="/api/status/error/file_format/unsupported_mime_type"){delete b._old_name;b._has_been_saved=true;b.set_dirty("all",false)}else mjt.warn("Save of",b.get_name(),"failed: ",e," - ",f,g)});return this.get_app().t_flush_cache().require(d).enqueue()};AcreDoc.prototype.t_delete=function(){function a(){b.get_app().unregister_file(b.get_name());
b.destroy()}var b=this,c={appid:b.get_app().get_path(),name:b.get_name()};if(!b.has_been_saved())return mjt.Succeed().enqueue().onready(a);c=b.get_store().XhrPost("delete_app_file",c).onready(a).onerror(function(d,e,f){mjt.warn("Delete of",b.get_name(),"failed: ",d," - ",e,f)});return this.get_app().t_flush_cache().require(c).enqueue()};AcreDoc.prototype.t_revert_to_saved=function(){var a=this,b={fileid:a.get_fileid()};return a.get_store().XhrGet("get_file",b).onready(function(c){a.set_name(c.name);
a.set_acre_handler(c.acre_handler);a.set_mime_type(c.content_type);a.set_revision(c.revision);a.set_dirty("all",false);a.clear_editors()}).onerror(function(c,d,e){mjt.warn("Rever of",a.get_name(),"failed: ",c," - ",d,e)}).enqueue()};AcreDoc.prototype.is_editor_loaded=function(a){var b=false;if(a)b=this._loaded_editors[a]?true:false;else for(var c in this._loaded_editors){b=true;break}return b};AcreDoc.prototype.clear_editors=function(a){function b(e){var f=c._loaded_editors[e];f.destroy&&f.destroy();
delete c._loaded_editors[e]}var c=this;if(a){if(c.get_edtior_name()===a)c._current_editor=null;b(a)}else{c._current_editor=null;for(var d in c._loaded_editors)b(d)}};AcreDoc.prototype.get_editor_name=function(){for(var a in EDITORS)if(this._current_editor&&this._current_editor instanceof EDITORS[a].editor_class)return a;return false};AcreDoc.prototype.t_editor_show=function(a,b,c){var d=this;if(d._showing_editor)return mjt.Succeed().enqueue();d._showing_editor=true;var e=null;if(c){e=c;d.set_dirty("content")}else if(d.is_dirty("revision"))e=
null;else if(d._current_editor)e=d.get_editor_state();else if(d._initial_state){e=d._initial_state;d._initial_state=null}if(d.is_dirty("editor")){d.clear_editors();d.set_dirty("editor",false)}c=EDITORS[a].editor_class;d._current_editor&&!(d._current_editor instanceof c)&&d._current_editor.hide();if(typeof d._loaded_editors[a]!=="undefined"){d._current_editor=d._loaded_editors[a];d.is_dirty("content")&&e&&d.set_editor_state(e);d._current_editor.show(b);d._showing_editor=false;return mjt.Succeed().enqueue()}return c.t_load(d,
e).onready(function(f){d._loaded_editors[a]=f;d._current_editor=d._loaded_editors[a];d._current_editor.show(b);d._showing_editor=false}).onerror(function(f,g,i){mjt.warn("Loading of",d.get_name(),"failed: ",f," - ",g,i)}).enqueue()};AcreDoc.prototype.get_editor_state=function(){var a=null;if(this._current_editor)a=this._current_editor.get_state();else if(this._initial_state)a=this._initial_state;return a};AcreDoc.prototype.set_editor_state=function(a){assert.critical(a,"Trying to set undefined editor state");
this._current_editor&&this._current_editor.set_state(a)};AcreDoc.prototype.get_editor_supported_features=function(a){if(!this.get_editor_name())return false;var b=EDITORS[this.get_editor_name()].supports;return a?!!b[a]:b};AcreDoc.prototype.register_editor_event_handlers=function(a){for(var b in a)this._event_handlers[b]=a[b]};AcreDoc.prototype.trigger_editor_event=function(a,b){if(a==="change"){this.set_dirty("content");this.set_dirty("revision",false)}this._event_handlers[a]&&this._event_handlers[a].apply(this,
b)};AcreDoc.prototype.editor_undo=function(){this._current_editor&&this._current_editor.undo&&this._current_editor.undo()};AcreDoc.prototype.editor_redo=function(){this._current_editor&&this._current_editor.redo&&this._current_editor.redo()};AcreDoc.prototype.editor_indent=function(){this._current_editor&&this._current_editor.reindentSelection&&this._current_editor.reindentSelection()};AcreDoc.prototype.editor_goto_line=function(a){this._current_editor&&this._current_editor.goto_line&&this._current_editor.goto_line(Number(a))}})();
var AcreApp;
(function(){AcreApp=function(a,b){this._store=a;this._acre_host=a.get_acre_host();this._service_url=a.get_url();this._path=b;this._version=null;this._name="Untitled";this._release=this._listed=this._write_user=this._oauth_enabled=null;this._hosts=[];this._versions=[];this._authors={};this._files={};this._untitled_label="untitled_";this._untitled_counter=1;return this};AcreApp.prototype.t_load=function(){var a=this;return a._store.XhrGet("get_app",{appid:a._path}).onready(function(b){a._acre_host=b.acre_host;
a._remote_app=b.acre_host!==a.get_store().get_acre_host();a._repository=b.repository||{versioned:true};a._path=b.path;a._appid=b.appid;a._version=b.version;a._name=b.name||"Untitled";a._oauth_enabled=b.oauth_enabled;a._write_user=b.write_user;a._parent=b.parent;a._children=b.children;a._listed=b.listed;a._release=b.release;a._hosts=b.hosts;a._versions=b.versions;a._last_edit=null;a._initial_file=b.current_file;for(var c in b.authors){var d=b.authors[c];a._authors[d.name]=new AcreUser(a.get_store(),
d)}for(var e in b.files){b.files[e].has_been_saved=true;new AcreDoc(a,b.files[e].name,b.files[e])}a.is_writable()&&!a._write_user&&a._oauth_enabled===null&&a.t_set_oauth(true)}).enqueue()};AcreApp.prototype.t_flush_cache=function(a){var b=this.get_store().AppTouch(this.get_base_url());if(a){a=this.get_hosts();for(var c=0;c<a.length;c++)this.get_store().AppTouch("http://"+a[c].host).enqueue()}return b};AcreApp.prototype.destroy=function(){for(var a in this._files)this._files[a].destroy();for(var b in this._authors)this._authors[b].destroy()};
AcreApp.prototype.register_file=function(a){var b=(new RegExp(this._untitled_label+"(\\d+)")).exec(a.get_name());if(b&&b.length){b=parseInt(b[1],10);if(this._untitled_counter<=b)this._untitled_counter=b+1}this._files[a.get_name()]=a};AcreApp.prototype.unregister_file=function(a){delete this._files[a]};AcreApp.prototype.is_dirty=function(){var a=this.get_files();for(var b in a)if(a[b].is_dirty())return true;return false};AcreApp.prototype.get_store=function(){return this._store};AcreApp.prototype.get_repository_capability=
function(a){return!!this._repository[a]};AcreApp.prototype.get_path=function(){return this.get_acre_host()===this.get_store().get_acre_host()?this._path:this._path+"."+this._acre_host+"."};AcreApp.prototype.get_versioned_path=function(){var a=this.get_path();if(this.is_version())a=a.replace("//","//"+this._version+".");return a};AcreApp.prototype.get_name=function(){return this._path.split("//")[1].split(".").shift()};AcreApp.prototype.get_display_name=function(){return this._name};AcreApp.prototype.get_parent=
function(){return this._parent};AcreApp.prototype.get_children=function(){return this._children};AcreApp.prototype.get_released_version=function(){return this._release};AcreApp.prototype.get_versions=function(){return this._versions};AcreApp.prototype.get_patches=function(){return this._patches};AcreApp.prototype.get_hosts=function(){return this._hosts};AcreApp.prototype.get_files=function(){return this._files};AcreApp.prototype.get_file=function(a){if(a){var b=a.split("/");return b.length>1?this.get_library(b[0]).get_file(b[1]):
this._files[a]}if(this._initial_file&&this._files[this._initial_file]){a=this._files[this._initial_file];this._initial_file=null;return a}else if(this._files.index)return this._files.index;else{var c=this.get_files();for(b in c)if(a=c[b])return a}return null};AcreApp.prototype.get_untitled_file_name=function(){return this._untitled_label+this._untitled_counter};AcreApp.prototype.get_acre_host=function(){return this._acre_host};AcreApp.prototype.get_base_url=function(){return"http:"+this.get_path()+
"."+this.get_acre_host()};AcreApp.prototype.get_view_url=function(){return this._repository.url+"/apps"+this._appid};AcreApp.prototype.get_edit_url=function(){return this._repository.url+"/apps/admin"+this._appid};AcreApp.prototype.is_version=function(){return!!this._version};AcreApp.prototype.get_version_label=function(){return this._version};AcreApp.prototype.get_version_timestamp=function(a){a=a?a:this._version;for(var b=0;b<this._versions.length;b++){var c=this._versions[b];if(c.name==a)return c.as_of_time}return null};
AcreApp.prototype.t_save_all=function(){var a=mjt.Succeed();for(var b in this._files){var c=this._files[b];c.is_dirty()&&a.require(c.t_save())}return this.t_flush_cache().require(a).enqueue()};AcreApp.prototype.t_get_history=function(a){var b={appid:this.get_path()};if(a)b.limit=a;return this.get_store().XhrGet("get_app_history",b).enqueue()};AcreApp.prototype.get_last_change=function(){return this._last_edit};AcreApp.prototype.set_last_change=function(a){this._last_edit=a};AcreApp.prototype.t_set_listing=
function(a,b,c){var d=this,e={appid:d.get_path()};if(a)e.name=a;if(a)e.description=b;if(a)e.listed=c;return d.get_store().XhrPost("set_app_properties",e).onready(function(){if(a)d._display_name=a}).onerror(function(f,g,i){mjt.warn("Changing app listing of",d.get_name(),"failed: ",f," - ",g,i)}).enqueue()};AcreApp.prototype.t_move=function(a){var b=this,c={appid:b.get_path(),to_appid:a};return b.get_store().XhrPost("move_app",c).onready(function(){b._path=a;b.t_flush_cache().enqueue()}).onerror(function(d,
e,f){mjt.warn("Move of",b.get_display_name(),"failed: ",d," - ",e,f)}).enqueue()};AcreApp.prototype.t_delete=function(){var a=this,b={appid:a.get_path()};return this.get_store().XhrPost("delete_app",b).enqueue().onready(function(){a.destroy()}).onerror(function(c,d,e){mjt.warn("Failed to delete app: "+c+", "+d+", "+e)})};AcreApp.prototype.t_set_host=function(a){var b=this;a={appid:b.get_path(),host:a};return b.get_store().XhrPost("set_app_host",a).onready(function(c){b._hosts=c.hosts;if(c.listed)b._listed=
true;b.t_flush_cache(true).enqueue()}).onerror(function(c,d,e){mjt.warn("Setting release URL of",b.get_display_name(),"failed: ",c," - ",d,e)}).enqueue()};AcreApp.prototype.t_set_release=function(a){var b=this;a={appid:b.get_path(),version:a};return b.get_store().XhrPost("set_app_release",a).onready(function(c){b._hosts=c.hosts;b._versions=c.versions;b._release=c.release;b.t_flush_cache(true).enqueue()}).onerror(function(c,d,e){mjt.warn("Setting release of",b.get_display_name(),"failed: ",c," - ",
d,e)}).enqueue()};AcreApp.prototype.t_add_version=function(a,b,c){var d=this;a={appid:d.get_path(),version:a};if(b)a.timestamp=b;if(typeof c!=="undefined")a.service_url=c;return this.get_store().XhrPost("create_app_version",a).onready(function(e){d._versions=e.versions}).onerror(function(e,f,g){mjt.warn("Failed to add version: "+e+", "+f+", "+g)}).enqueue()};AcreApp.prototype.t_remove_version=function(a){var b=this;a={appid:b.get_path(),version:a};return this.get_store().XhrPost("delete_app_version",
a).onready(function(c){b._versions=c.versions}).onerror(function(c,d,e){mjt.warn("Failed to remove version: "+c+", "+d+", "+e)}).enqueue()};AcreApp.prototype.is_remote=function(){return this._remote_app};AcreApp.prototype.is_writable=function(){return this.is_author()&&!this.is_version()&&!this.is_remote()};AcreApp.prototype.is_author=function(){return this.get_store().get_user()?this.get_store().get_user().get_name()in this.get_authors():false};AcreApp.prototype.is_oauth_enabled=function(){return!!this._oauth_enabled};
AcreApp.prototype.get_authors=function(){return this._authors};AcreApp.prototype.get_write_user=function(){return this._authors[this._write_user]};AcreApp.prototype.t_add_author=function(a){var b=this,c={appid:b.get_path(),username:a};return this.get_store().XhrPost("add_app_author",c).onready(function(d){d=new AcreUser(b._store,d.authors[a]);b._authors[a]=d}).onerror(function(d,e,f){mjt.warn("Failed to add author: "+d+", "+e+", "+f)}).enqueue()};AcreApp.prototype.t_remove_author=function(a){var b=
this,c={appid:b.get_path(),username:a};return this.get_store().XhrPost("remove_app_author",c).onready(function(){delete b._authors[a]}).onerror(function(d,e,f){mjt.warn("Failed to add author: "+d+", "+e+", "+f)}).enqueue()};AcreApp.prototype.t_get_apikeys=function(){var a={appid:this.get_path()};return this.get_store().XhrPost("list_app_apikeys",a).onerror(function(b,c,d){mjt.warn("Failed to get API Keys: "+b+", "+c+", "+d)}).enqueue()};AcreApp.prototype.t_add_apikey=function(a,b,c){a={appid:this.get_path(),
name:a,token:b,secret:c};return this.get_store().XhrPost("create_app_apikey",a).onerror(function(d,e,f){mjt.warn("Failed to add api key: "+d+", "+e+", "+f)}).enqueue()};AcreApp.prototype.t_remove_apikey=function(a){a={appid:this.get_path(),name:a};return this.get_store().XhrPost("delete_app_apikey",a).onerror(function(b,c,d){mjt.warn("Failed to add api key: "+b+", "+c+", "+d)}).enqueue()};AcreApp.prototype.t_set_oauth=function(a){var b=this;if(b.is_oauth_enabled()==a)return mjt.Succeed().enqueue();
if(!(a===true||a===false))return mjt.Fail(500,"Must set oauth_enabled to true or false").enqueue();var c={appid:b.get_path(),enable:a};return b.get_store().XhrPost("set_app_oauth_enabled",c).onready(function(){b._oauth_enabled=a}).onerror(function(d,e,f){mjt.warn("Setting OAuth enabled for ",b.get_name(),"failed: ",d," - ",e,f)}).enqueue()};AcreApp.prototype.t_set_writeuser=function(a){var b=this;if(!!b.get_write_user()===a)return mjt.Succeed().enqueue();if(!(a===true||a===false))return mjt.Fail(500,
"Must set write_user to true or false (current user)").enqueue();var c={appid:b.get_path(),enable:a};return b.get_store().XhrPost("set_app_writeuser",c).onready(function(d){b._write_user=a?d.write_user:null}).onerror(function(d,e,f){mjt.warn("Setting write user for ",b.get_name(),"failed: ",d," - ",e,f)}).enqueue()}})();var AcreUser;
(function(){AcreUser=function(a,b){this._store=a;this._name=b.name||null;this._full_name=b.full_name||null;this._is_admin=b.admin;return this};AcreUser.prototype.destroy=function(){};AcreUser.prototype.get_name=function(){return this._name};AcreUser.prototype.get_full_name=function(){return this._full_name};AcreUser.prototype.is_admin=function(){return!!this._is_admin};AcreUser.prototype.get_image_url=function(){return this._store.get_user_image_url(this)};AcreUser.prototype.get_view_url=function(){return this._store.get_user_view_url(this)};
AcreUser.prototype.get_new_app_host=function(){return this._store.get_user_default_app_host(this)};AcreUser.prototype.get_new_app_path=function(a){return this._store.get_user_new_app_path(this,a)}})();var EDITORS={},ImageEditor;
(function(){ImageEditor=function(a){this.supports_mime_type_change=false;this.ui_element=document.createElement("div");if(a.cssClassName)this.ui_element.className=a.cssClassName;this.file=a.file;this.readOnly=a.readOnly;if(a.onChange)this.on_change=a.onChange};ImageEditor.t_load=function(a,b){var c=EDITORS.ImageEditor.config;c.readOnly=!a.is_writable();c.onChange=function(d,e){a.trigger_editor_event("change",[d,e])};c=new ImageEditor(c);c.file=a;$(a.get_element()).append(c.ui_element);b&&c.set_state(b);
return mjt.Succeed(c)};ImageEditor.prototype.destroy=function(){$(this.ui_element).remove()};ImageEditor.prototype.show=function(a){var b="Upload an image";this._prefs=a;$(this.ui_element).empty();this.file.set_dirty("content",false);if(this.file.has_been_saved())b="Replace this image";if(!this.readOnly){this.form_element=$('<form class="image-upload"><label for="image-browse">'+b+':</label> <input id="image-browse" type="file" name="file" size="40"></form>');$(this.form_element).change(this.on_change);
$(this.ui_element).append(this.form_element)}a=this.file.get_name();b=this.file.get_app().get_base_url();if(this.file.has_been_saved())if(this.file.get_mime_type().substr(0,6)==="image/")$('<div class="image-preview"><p>'+a+':</p><img src="'+this.file.get_acre_url()+'"/></div>').appendTo(this.ui_element);else this.file.get_revision()&&$('<a href="'+b+"/"+a+'">download file</a>').appendTo(this.ui_element);$(this.ui_element).append('<div class="image-attribution"><img src="img/freebase-cc-by-61x23.png" alt="Freebase CC-BY" width="61" height="23" /><p>All images included in Acre apps are released under <a href="http://creativecommons.org/licenses/by/3.0/">CC-BY</a>.</p></div>');
$(this.ui_element).show()};ImageEditor.prototype.refresh=ImageEditor.prototype.show;ImageEditor.prototype.hide=function(){$(this.ui_element).hide()};ImageEditor.prototype.get_state=function(){return{form:this.form_element}};ImageEditor.prototype.set_state=function(a){if(a.revision){this.file.set_revision(a.revision);this.file.set_dirty("content")}this.show()}})();EDITORS.ImageEditor={editor_class:ImageEditor,supports:{},config:{cssClassName:"Editor-view"}};
function EditorMargin(a){this._container=a;this._container.innerHTML="<div style='position: relative; left: 0; top: 0; width: 100%; height: 100%'></div>";a=[];for(var b=0;b<100;b++)a.push("<div>0</div>");this._lineMetricDiv=this._createLayer();this._lineMetricDiv.style.visibility="hidden";this._lineMetricDiv.innerHTML=a.join("");this._fontMetricDiv=this._createLayer();this._fontMetricDiv.style.visibility="hidden";this._fontMetricDiv.style.height="100em";this._lineNumberDiv=this._createLayer();this._lineNumberDiv.className=
"editor-margin-line-numbers";this._renderedLineCount=this._firstRenderedLine=0;this._currentLine=-1}
(function(){EditorMargin.get_layout_metrics=function(a,b){var c;if(a.getComputedStyle){c=a.getComputedStyle(b,null);return{paddingTop:c.getPropertyValue("padding-top"),marginTop:c.getPropertyValue("margin-top")}}else{c=b.currentStyle;return{paddingTop:c.paddingTop,marginTop:c.marginTop}}};EditorMargin.prototype={dispose:function(){},redraw:function(a,b){var c=this._lineMetricDiv.offsetHeight/100,d=this._fontMetricDiv.offsetHeight/100,e=c/d,f=null;if(b.contentHeight!==null)f=Math.floor(b.contentHeight/
c);var g=Math.floor(b.scrollY/c);c=Math.ceil((b.scrollY+b.visibleHeight)/c)-1;if(f!==null)c=Math.min(c,f-1);var i=this._firstRenderedLine+this._renderedLineCount;if(g<this._firstRenderedLine||g>=i||c>=i||f!==null&&f<c){i=c-g+1;g=Math.max(0,g-i);c=c+i;if(f!==null)c=Math.min(c,f-1);this._lineNumberDiv.style.paddingTop=e*g+"em";e=[];for(f=g;f<=c;f++)e.push("<div>"+(f+1)+"</div>");this._lineNumberDiv.innerHTML=e.join("");this._firstRenderedLine=g;this._renderedLineCount=c-g+1;this._highlightCurrentLine()}e=
function(l){try{if(l.indexOf("px")>0)return parseInt(l.replace(/px$/g,""),10);else if(l.indexOf("em")>0)return Math.round(parseFloat(l.replace(/em$/g,""),10)*d)}catch(m){}return 0};this._lineNumberDiv.style.top=-b.scrollY+e(a.paddingTop)+e(a.marginTop)+"px"},_createLayer:function(){var a=document.createElement("div");a.style.position="absolute";this._container.firstChild.appendChild(a);return a},setCurrentLine:function(a){if(a!==this._currentLine){this._unhighlightCurrentLine();this._currentLine=
a;this._highlightCurrentLine()}},_unhighlightCurrentLine:function(){if(this._currentLine!==-1){var a=this._lineNumberDiv.childNodes,b=this._currentLine-this._firstRenderedLine;if(b>=0&&b<a.length)a[b].className=""}},_highlightCurrentLine:function(){if(this._currentLine!==-1){var a=this._lineNumberDiv.childNodes,b=this._currentLine-this._firstRenderedLine;if(b>=0&&b<a.length)a[b].className="edit-margin-current-line-number"}}}})();var TextareaEditor;
(function(){TextareaEditor=function(a){var b=this;b._edit_element=document.createElement("textarea");if(a.cssClassName)b._edit_element.className=a.cssClassName;if(a.readOnly){$(b._edit_element).attr("readonly","yes").addClass("readonly");$(b._top_element).append("<div class='readonly-warning'>READ ONLY</div></div>")}if(a.on_change){b.timeout_id=null;var c=function(){b.timeout_id&&window.clearTimeout(b.timeout_id);b.timeout_id=window.setTimeout(a.on_change,300)},d=["input","drop"];$.browser.mozilla||
d.push("paste","keypress");for(var e=0;e<d.length;e++)$(b._edit_element).bind(d[e],c)}};TextareaEditor.t_load=function(a,b){var c=EDITORS.TextareaEditor.config;c.readOnly=!a.is_writable();c.on_change=function(){a.trigger_editor_event("change",[])};var d=new TextareaEditor(c);d._top_element=document.createElement("div");$(d._top_element).css({height:"100%",width:"100%"});$(a.get_element()).append(d._top_element);$(d._top_element).append(d._edit_element);d._margin_width=c.marginWidth;d._margin_element=
document.createElement("div");d._margin_element.className="edit-margin";$(d._top_element).append(d._margin_element);c=mjt.Succeed(d);if(b)d.set_state(b);else if(a.has_been_saved()){var e=a.t_get_revision().onready(function(f){d.set_state({text:f.text})});c.require(e)}return c};TextareaEditor.prototype.destroy=function(){$(this._top_element).remove()};TextareaEditor.prototype.show=function(a){var b=this;b._prefs=a;if(a.margin){if(!b.editorMargin)b.editorMargin=new EditorMargin(b._margin_element,{});
b._scroll_callback=function(){b._redraw_editor_margin()};if($.browser.msie)b._edit_element.onscroll=b._scroll_callback;else $(b._edit_element).bind("scroll",b._scroll_callback)}b._resize_callback=function(){b._on_resize()};$(window).bind("resize",b._resize_callback);b._on_resize();$(b._top_element).show()};TextareaEditor.prototype.hide=function(){$(this._top_element).hide();$(this._edit_element).unbind("scroll",this._scroll_callback);$(window).unbind("resize",this._resize_callback)};TextareaEditor.prototype.get_state=
function(){return{text:this._edit_element.value}};TextareaEditor.prototype.set_state=function(a){this._edit_element.value=a.text};TextareaEditor.prototype._on_resize=function(){if(this._prefs.margin){$(this._edit_element).css("left",this._margin_width);$(this._edit_element).width($(this._top_element).width()-this._margin_width);$(this._margin_element).width(this._margin_width);$(this._margin_element).show();this._redraw_editor_margin()}else{$(this._edit_element).css("left",0).width($(this._top_element).width());
$(this._margin_element).hide()}};TextareaEditor.prototype._redraw_editor_margin=function(){if(this._prefs.margin)try{var a=this._get_scroll_info();this.editorMargin.redraw(this._get_layout_metrics(),a)}catch(b){}};TextareaEditor.prototype._get_scroll_info=function(){return{scrollY:$(this._edit_element).scrollTop(),visibleHeight:$(this._edit_element).innerHeight(),contentHeight:null}};TextareaEditor.prototype._get_layout_metrics=function(){return EditorMargin.get_layout_metrics(window,this._edit_element)}})();
EDITORS.TextareaEditor={name:"TextArea",editor_class:TextareaEditor,supports:{hotswap:true,mimetype_change:true,margin:true},config:{cssClassName:"Editor-view",marginWidth:45}};
var QueryEditor=function(a,b,c){var d;a.innerHTML='<div style="position: relative"><div style="position: absolute;"></div><div style="position: absolute;"></div></div>';var e=a.firstChild.childNodes[0],f=a.firstChild.childNodes[1],g=this,i=function(){var l=Math.round((Math.max(100,a.offsetWidth)-20-10)/2)+"px",m=Math.max(100,a.offsetHeight);a.firstChild.style.width="100%";a.firstChild.style.height=m+"px";m=m-20;$(e).css("top","10px").css("height",m+"px");$(e).css("left","10px").css("width",l);$(f).css("right",
"10px").css("width",l).css("top","10px").css("height",m+"px");d.queryEditor.layout();d.outputPane.layout()};b.focusOnReady=true;b.onReady=function(){c.ready(g)};this.composition=d=CueCard.createComposition({queryEditorElement:e,queryEditorOptions:b,outputPaneElement:f,outputPaneOptions:{verticalPadding:4,horizontalPadding:4}});d.queryEditor._onRun=function(){this.run(true)};this.get_state=function(){return{text:d.queryEditor.content()}};this.set_state=function(l){d.queryEditor.content(l.text)};this.destroy=
function(){$(a).hide();$(a).remove()};this.show=function(l){var m=this;m._prefs=l;if(l.emql)this.composition.queryEditor._getQueryEnvelope=function(){return{extended:1}};var p=d.queryEditor._editor;setTimeout(function(){p.setLineNumbers(l.margin);p.setTextWrapping(l.softwrap);m._file.trigger_editor_event("linechange",[p.currentLine()]);if(p._last_selection){var q=p._last_selection.start,r=p._last_selection.end;p.selectLines(q.line,q.character,r.line,r.character);delete p._last_selection}},1);$(window).bind("resize",
i);$(".cuecard-queryEditor-controls-bottom").mjt(ui.templates.query_button_bar());$(m._file.get_element()).show();$(a).show();i()};this.hide=function(){$(a).hide();$(window).unbind("resize",i)};this.undo=function(){d.queryEditor._editor.editor.history.undo()};this.redo=function(){d.queryEditor._editor.editor.history.redo()};this.reindentSelection=function(){d.queryEditor._editor.editor.reindentSelection()};this.query_assist=function(){d.queryEditor.startAssistAtCursor()};this.query_run=function(){d.queryEditor.run(this._file.is_writable())};
this.query_redangle=function(){var l=d.queryEditor,m=l.getQueryModelAndContext();m.model.toInsideOutQueryJson(m.context,CueCard.UI.createBlockingContinuations(function(p,q){l.content(CueCard.jsonize(q,l.getJsonizingSettings()))}))};this.generate_template=function(){var l=this,m=ui.get_app().get_untitled_file_name(),p=d.queryEditor.getQueryModelAndContext().model.toQueryJson();CueCard.CodeGeneration.serializers["acre-template"].generateQueryCall=function(q,r,t,h,j,n,o){r.appendIndent();r.append("<acre:script>");
r.appendLineBreak();r.indent();r.appendIndent();r.append("var "+n+' = acre.require("'+l._file.get_name()+'").query');r.append(";");r.appendLineBreak();if(l._prefs.emql){r.appendIndent();r.append("var "+o+" = acre.freebase.mqlread("+n+", {extended:1});")}else{r.appendIndent();r.append("var "+o+" = acre.freebase.mqlread("+n+");")}r.appendLineBreak();r.unindent();r.appendIndent();r.append("</acre:script>");r.appendLineBreak();return o+".result"};p=CueCard.CodeGeneration.generate(p,CueCard.CodeGeneration.serializers["acre-template"],
{indentLevel:1});ui.do_file_create_new(m,{acre_handler:"mjt"},{text:'<html>\r<head>\r\r  <title>Query-Generated Template</title>\r\r  <style type="text/css" media="screen">\r    * { vertical-align: baseline; font-weight: inherit; font-family: inherit; \r        font-style: inherit; font-size: inherit; border: 0 none; outline: 0; padding: 0; margin: 0; }\r    body { margin: 15px; }\r    ul { list-style: none; }\r    li { padding: 3px; }\r    table { border-collapse: collapse; border-spacing: 0; width: 100%; }\r    th, td { border: 1px solid #ddd; vertical-align: top; padding: 6px; }\r    th { width: 20%; text-align: right; font-size: 11px; font-weight: bold; padding: 6px; color: #666; background: #f5f5f5; }\r    td { width: 80%; font-size: 12px; }\r    img { padding: 1px; border: 1px solid #ccc;}\r    ins { color: #aaa; text-decoration: none;}\r  </style>\r\r</head>\r\r<body>\r'+
p+'  \r  <!-- Freebase attribution template --\>\r  ${acre.require("/freebase/apps/attribution/templates").blanket()}\r</body>\r</html>\r'})};this.goto_line=function(l){var m=d.queryEditor._editor.editor;try{m.jumpToLine(l)}catch(p){m.selectLines(m.prevLine(m.lastLine()),0)}}};
(function(){var a=mjt.define_task(null,[{name:"parent"},{name:"editor_config"}]);a.prototype._task_class="CreateQueryEditor";a.prototype.request=function(){return new QueryEditor(this.parent,this.editor_config,this)};QueryEditor.t_load=function(b,c){CueCard.helper=SERVER.acre.freebase.site_host+"/cuecard/";CueCard.freebaseServiceUrl=SERVER.acre.freebase.service_url+"/";CueCard.urlPrefix="/cuecard/";CueCard.apiProxy.base=SERVER.acre.freebase.site_host+"/cuecard/";var d=$.extend(true,{},EDITORS.QueryEditor.config);
d.readOnly=!b.is_writable();var e=document.createElement("div");$(e).css({height:"100%",width:"100%"});$(b.get_element()).hide().append(e);d.codeMirror.onChange=function(){try{var i=b._loaded_editors.QueryEditor.composition.queryEditor._editor.historySize();b.trigger_editor_event("change",[i.undo,i.redo])}catch(l){}};d.codeMirror.cursorActivity=function(){b.trigger_editor_event("linechange",[b._loaded_editors.QueryEditor.composition.queryEditor._editor.currentLine()])};var f,g=a(e,d).onready(function(i){i.composition.queryEditor._editor.setParser("JSParser");
if(c)i.set_state(c);else f&&i.set_state({text:f.result.text});i._file=b;i._top_element=e;$(">div",e).css("height","100%");$(".cuecard-queryEditor-controls-top").hide();if(d.readOnly){$(b.get_element()).addClass("readonly");$(".cuecard-queryEditor-inner",b.get_element()).append("<div class='readonly-warning'>READ ONLY</div>")}$('<a class="cuecard-permalink" href="javascript:{}">Open in Query Editor</a>').click(function(){var l="http://www.freebase.com/app/queryeditor?q="+encodeURIComponent(i.composition.queryEditor.getUnresolvedQuery());
window.open(l,"_blank")}).appendTo($(e).find(".cuecard-outputPane")[0]);b.trigger_editor_event("newframe",[i.composition.queryEditor._editor.frame])});if(!c&&b.has_been_saved()){f=b.t_get_revision();g.require(f)}return g}})();EDITORS.QueryEditor={editor_class:QueryEditor,supports:{margin:true,linenumbers:true,softwrap:true,undo:true,indent:true,inline_preview:true,emql:true},config:{codeMirror:{parserConfig:{json:true},lineNumbers:false}}};
(function(){function a(d){var e="DummyParser",f={mqlquery:"JSParser",acre_script:"JSParser",mjt:"HTMLMixedParser"},g={"text/html":"HTMLMixedParser","text/css":"CSSParser","text/javascript":"JSParser","application/json":"JSParser"},i=d.get_acre_handler();d=d.get_mime_type();if(d!=="text/plain"){if(d in g)e=g[d]}else if(i in f)e=f[i];return e}var b=mjt.define_task(null,[{name:"parent"},{name:"editor_config"}]);b.prototype._task_class="CreateCodeMirror";b.prototype.request=function(){var d=this,e=new CodeMirror(this.parent,
this.editor_config);this.editor_config.initCallback=function(){d.ready(e)};e.get_state=function(){return{text:this.editor.getCode()}};e.set_state=function(f){this.editor.importCode(f.text)}};CodeMirror.t_load=function(d,e){var f=$.extend(true,{},EDITORS.CodeMirror.config);f.readOnly=!d.is_writable();f.readOnly&&$(d.get_element()).addClass("readonly").append("<div class='readonly-warning'>READ ONLY</div>");f.onChange=function(){if(d._loaded_editors.CodeMirror){var m=d._loaded_editors.CodeMirror.historySize();
d.trigger_editor_event("change",[m.undo,m.redo])}};var g=document.createElement("div");$(g).css({height:"100%",width:"100%"});$(d.get_element()).append(g);var i,l=b(g,f).onready(function(m){m.setParser(a(d));if(e)m.set_state(e);else i&&m.set_state({text:i.result.text});m._file=d;m._top_element=g;d.trigger_editor_event("newframe",[m.frame]);f.cursorActivity=function(){d.trigger_editor_event("linechange",[m.currentLine()])}});if(!e&&d.has_been_saved()){i=d.t_get_revision();l.require(i)}return l};CodeMirror.prototype.destroy=
function(){if("_codeAssist"in this){this._codeAssist.dispose();this._codeAssist=null}$(this._top_element).remove()};CodeMirror.prototype.show=function(d){var e=this,f=e._file;e._prefs=d;setTimeout(function(){e.setLineNumbers(d.margin);e.setTextWrapping(d.softwrap);f.trigger_editor_event("linechange",[e.currentLine()]);$(e._top_element).show();$("iframe",e._top_element).focus();if(e._last_selection){var g=e._last_selection.start,i=e._last_selection.end;e.selectLines(g.line,g.character,i.line,i.character);
delete e._last_selection}d.dotTrigger&&f.is_writable()&&fb.get_script(SERVER.libs.codeassist,function(){if(!e._codeAssist)e._codeAssist=new CodeAssist(e.frame,e,{isMjt:f.get_acre_handler()=="mjt"});e._codeAssist.putSetting("dotTrigger",d.dotTrigger)})},1)};CodeMirror.prototype.hide=function(){var d=this.cursorPosition(),e=this.cursorPosition(false);this._last_selection={start:d,end:e};$(this._top_element).hide()};CodeMirror.prototype.goto_line=function(d){try{this.jumpToLine(d)}catch(e){this.selectLines(this.prevLine(this.lastLine()),
0)}};var c={"acre:doc":"xml-tagname-acre","acre:block":"xml-tagname-acre","acre:script":"xml-tagname-acre"};CodeMirror.style_token=function(d,e){var f=e.content.toLowerCase();if(e.style=="xml-tagname")if(c[f])d.className+=" "+c[f]}})();
EDITORS.CodeMirror={name:"CodeMirror",editor_class:CodeMirror,supports:{hotswap:true,mimetype_change:true,margin:true,linenumbers:true,softwrap:true,undo:true,indent:true,codeassist:true},config:{parserConfig:{triggers:{"acre:script":"JSParser",script:"JSParser",style:"CSSParser"}},activeTokens:CodeMirror.style_token,height:"100%",marginWidth:45,autoMatchParens:true,passDelay:100,undoDelay:250,basefiles:[],parserfile:[SERVER.libs.codemirror],stylesheet:[SERVER.libs.codemirror_css],lineNumbers:true,
highlightActiveLine:true,tabMode:"shift",dotTrigger:false}};var ui={};
(function(){function a(h){h=h.replace(/<\?xml[^>]+>/g,"");h=h.replace(/<style[^>]+>/g,"<style>");return h=h.replace(/type=['"]text\/(css|javascript)['"]/g,"")}function b(h){return h.replace(/acre:/g,"")}function c(h){h=h.replace(/<acre:script>/g,"<script>").replace(/<\/acre:script>/g,"<\/script>");h=h.replace(/<\/?acre:(block|doc)[^>]*>/g,"");h=h.replace(/<[^>]+>/g,b);return h=a(h)}function d(h){/^\s*@charset\s+"UTF-8";/.test(h)||(h='@charset "UTF-8"; '+h);return h}ui.init=function(){ui.templates=
mjt.run("mjtstuff");$("#mjtmain").mjt(ui.templates.body());$("#button-apps").click(function(){ui.do_show_menu("apps")}).attr("title",ui.shortcut.get_keys("Open App"));ui.shortcut.register_keys(document);window.onbeforeunload=ui.warn_user_about_unsaved_files;$(document).keydown(function(h){return!(h.which===8&&h.target.nodeName!=="INPUT"&&h.target.nodeName!=="TEXTAREA")});$(".exit").live("click",ui.do_hide_overlays);$(".app-link").live("click",function(h){if(!(h.ctrlKey||h.metaKey||h.altKey||h.shiftKey)){h=
$(this).attr("apppath");ui.do_hide_overlays();ui.get_app()&&ui.get_app().is_dirty()?ui.do_show_dialog("files_dirty",[h]):ui.do_choose_app(h);return false}});ui.check_browser_hash();setInterval(ui.check_browser_hash,250)};ui.refresh_app_templates=function(h){var j=ui.get_app();$("#header-apptitle").mjt(ui.templates.header(h));if(j){$("#list-column").mjt(ui.templates.list_column());j.is_writable()?$("#about-bar").hide():$("#about-bar").mjt(ui.templates.about_bar()).show()}};ui.refresh_file_templates=
function(){$("#file-list").mjt(ui.templates.file_list());$("#button-bar").mjt(ui.templates.button_bar());ui.finish_drawing()};ui.finish_drawing=function(){$(".refresh").show();ui.set_state();$(window).trigger("resize")};ui.do_show_dialog=function(h,j){function n(o){if(o.keyCode==27){ui.do_hide_dialog_overlays();$(document).unbind("keydown",n)}}ui.do_hide_overlays();if(h=="welcome")ui.dialog=$("<div id='"+h+"'></div>").mjt(ui.templates[h+"_dialog"].apply(this,j||[])).prependTo(document.body);else{$("<div id='dialog-overlay'></div>").prependTo(document.body);
$(document).bind("keydown",n);ui.dialog=$("<div id='dialog-"+h+"' class='dialog'></div>").mjt(ui.templates[h+"_dialog"].apply(this,j||[])).prepend("<div class='dialog-close' onclick='ui.do_hide_overlays()'></div>").prependTo(document.body)}ui.dialog.show();ui.dialog.css("left",($(window).width()-ui.dialog.outerWidth())/2);return false};ui.do_show_menu=function(h,j){function n(){ui.do_hide_menu_overlays();$(document).unbind("keydown",o)}function o(z){z.keyCode==27&&n()}$("<div id='menu-overlay'></div>").prependTo(document.body).click(n);
$(document).bind("keydown",o);$("#button-"+h).addClass("button-open");var s=$("#button-"+h).offset(),u=$("#button-"+h).height();$("<div id='menu-"+h+"' class='menu'></div>").css({top:s.top+u+10,left:s.left}).prependTo(document.body).mjt(ui.templates[h+"_menu"].apply(this,j||[]));return false};ui.do_setup_submenu=function(h,j,n){var o,s,u=false,z=$("#"+h),v=z.closest(".menu"),w=$("<div id='menu-"+j+"' class='menu submenu'></div>");z.mouseenter(function(){o=setTimeout(function(){if(u)w.css("visibility",
"visible");else{w.css({top:z.offset().top,left:v.offset().left+v.width()}).prependTo(document.body).mjt(ui.templates[j+"_menu"].apply(this,n||[])).mouseenter(function(){clearTimeout(s)}).mouseleave(function(){clearTimeout(o);s=setTimeout(function(){w.css("visibility","hidden")},100)});u=true}},250)}).mouseleave(function(){clearTimeout(o);s=setTimeout(function(){w.css("visibility","hidden")},100)})};ui.do_hide_dialog_overlays=function(){delete ui.dialog;$("#dialog-overlay, .dialog").remove();$(".fbs-pane, .fbs-flyout-pane").hide()};
ui.do_hide_menu_overlays=function(){$("#menu-overlay, .menu").remove();$(".button-open").removeClass("button-open");$(".fbs-pane, .fbs-flyout-pane").hide()};ui.do_hide_overlays=function(){ui.do_hide_dialog_overlays();ui.do_hide_menu_overlays()};ui.do_hide_welcome=function(){$("#welcome").remove()};var e=true,f,g,i,l,m,p=false,q=false,r=+new Date;ui.check_browser_hash=function(){if(!q){var h=ui._get_browser_hash();if(h=="0")ui.set_state();else if(e||ui._ui_state_to_browser_hash()!==h){e=false;h=mjt.app.decode_uristate(h);
var j=/[\<\>]/,n=h.path||h.app;n=!j.test(n)?n:null;j=!j.test(h.file)?h.file:null;ui.do_choose_app(n,j,h.line,h.create)}}};ui._get_browser_hash=function(){return window.location.hash.replace(/#!?/,"")};ui._ui_state_to_browser_hash=function(){if(typeof ui.get_app()=="undefined")return null;var h={};if(ui.get_app())h.path=ui.get_app().get_versioned_path();if(ui.get_file())h.path+="/"+ui.get_file().get_relative_path();return mjt.app.encode_uristate(h)};ui.set_state=function(){var h=ui.get_app(),j=ui.get_file();
p=j?j.is_dirty():null;var n="";if(h)n+=(h.get_display_name()||h.get_path())+" - ";if(j)n+=j.get_name()+" - ";n+="Freebase App Editor";document.title=n;h=ui._ui_state_to_browser_hash();if(h!==ui._get_browser_hash())window.location.hash="!"+h;q=false};ui.clear_state=function(){p=m=l=i=null};ui.get_store=function(){return f};ui.set_store=function(h){f=h};ui.set_user=function(h){var j=ui.get_store();h!==j.get_user()&&j.set_user(h);g=j.get_user()};ui.get_app=function(){if(!i)return null;return i};ui.get_file=
function(){if(!l)return null;return l};ui.get_line=function(){return m};ui.get_user=function(){return g};ui.get_recents=function(h,j){var n=$.localStore("recent_"+h,undefined,false);if(n===null)n=[];!j&&n&&n.length>0&&n.shift();return n};ui.add_recent=function(h,j,n){var o=$.localStore("recent_"+h,undefined,false);if(!o||!jQuery.isArray(o))o=[];for(var s=JSON.stringify(j),u=0;u<o.length;u++)if(JSON.stringify(o[u])==s||h=="apps"&&(j&&(o[u].path==j.path||ui.id_to_path(o[u].path)==j.path)||o[u].path==
n))o.splice(u,1);if(j){o.unshift(j);if(o&&o.length>16){j=o.splice(16);if(h=="apps")for(n=0;n<j.length;n++)ui.clear_recents(j[n])}}$.localStore("recent_"+h,o,false)};ui.clear_recents=function(h){$.localStore("recent_"+h,null,false)};ui.do_choose_app=function(h,j,n,o){function s(){ui.clear_state();ui.set_state();ui.refresh_app_templates("open");var y=ui.get_recents("apps",true);if(o=="app"){if(!ui.get_user())location.href=ui.get_store().get_user_account_url("signin")+"create=app";ui.do_show_dialog("new_app")}else if(y.length>
0){var A=y.shift();$.localStore("recent_apps",y,false);ui.do_choose_app(A.path)}else ui.get_user()?ui.do_show_dialog("welcome",[true]):ui.do_show_dialog("welcome")}function u(){if(o=="file"){ui.set_state();ui.do_show_dialog("add_file")}else ui.do_choose_file(j,n)}q=true;var z=ui.get_app(),v=z?z.get_versioned_path():null;if(h&&z&&h==v){ui.refresh_app_templates();u()}else{ui.do_hide_overlays();ui.do_hide_welcome();$(".refresh").hide();if(h){z&&z.destroy();ui.refresh_app_templates("loading");var w=new AcreApp(ui.get_store(),
h);w.t_load().onready(function(){i=w;ui.add_recent("apps",{path:w.get_path(),name:w.get_display_name()});l=null;ui.refresh_app_templates();u();ui.do_status_check()}).onerror(function(y,A,B){if(y=="/api/status/error/input/no_app"){ui.MessagePanel.error(A?A:"Error loading app: "+h+". "+A||"");ui.add_recent("apps",null,h);s()}else{assert.critical(false,"Error connecting to Freebase<br/>"+A);mjt.error(y,A,B);ui.clear_state();ui.set_state();ui.refresh_app_templates("open")}})}else s()}};ui.do_choose_file=
function(h,j){function n(){var z=ui.get_file();if(!z)return ui.refresh_file_templates();var v=ui._get_desired_editor_classname();return z.t_editor_show(v,ui.get_editor_prefs()).onready(function(){j&&setTimeout(function(){z.editor_goto_line(j)},0);ui.refresh_file_templates();ui.set_state()})}q=true;var o=ui.get_app(),s=ui.get_file(),u=o.get_file(h);u||(u=o.get_file());if(!u||u==s)n(j);else{l=u;p=u.is_dirty();if($("#file-area").has(u.get_element()).length===0){$("#file-area").append(u.get_element());
ui._register_editor_event_handlers(u)}s&&s.hide();$(u.get_element()).show();return n(j)}};ui.do_refresh_file=function(){var h=ui.get_file();if(h){h.set_dirty("editor");var j=ui._get_desired_editor_classname();h.t_editor_show(j,ui.get_editor_prefs()).onready(function(){ui.refresh_file_templates();setTimeout(function(){h.editor_goto_line(ui.get_line())},0)})}};ui.do_run_view=function(h,j){var n=ui.get_file();if(n.get_acre_handler()=="mqlquery")n._current_editor.query_run();else{var o=ui.get_file().get_acre_url(j),
s=window.open("about:blank",ui.get_app().get_path().replace(/[\/-]/g,"_"));if(!s){ui.MessagePanel.error("A window couldn't be opened.  Tell your web browser to allow this site to open pop up windows and try again to continue.");return false}ui.do_app_save_all(function(){s.location=o;s.focus()})}};ui.do_status_check=function(){var h={};if(ui.get_app())h.appid=ui.get_app().get_path();ui.get_store().XhrGet("store_status_check",h).enqueue().onready(function(j){ui.get_app().set_last_change(j.change);if(!!j.user!==
!!ui.get_user()){ui.set_user(j.user);if(!j.user){ui.MessagePanel.error("You are no longer signed in.  Sign back in in another window to not lose any changes.");$(window).trigger("fb.user.signedout")}$(window).trigger("fb.user.signedin")}$("#app-edits-shim").mjt(ui.templates.app_edits());ui.refresh_file_templates()})};ui.do_app_create_new=function(h,j,n){var o={appid:h};if(j)o.name=j;if(n)o.clone=n;if(ui.get_store().get_user_apps(h))ui.MessagePanel.error("App with that URL already exists");else{ui.MessagePanel.doing("Creating: "+
j+"...");ui.get_store().XhrPost("create_app",o).enqueue().onready(function(s){ui.MessagePanel.info("Created: "+j);ui.do_choose_app(h);ui.get_store().set_user_apps(s)}).onerror(function(s,u){ui.MessagePanel.error(u?u:"Error creating: "+h+". "+u||"")})}};ui.do_app_move=function(h){var j=ui.get_app(),n=j.get_path();q=true;ui.MessagePanel.doing("Moving app...");j.t_move(h).onready(function(){ui.set_state();ui.add_recent("apps",{path:j.get_path(),name:j.get_display_name()},n);ui.get_store().t_refresh_user_apps();
ui.MessagePanel.info("App moved to "+h)}).onerror(function(o,s){ui.MessagePanel.error(s?s:"Error moving: "+j.get_display_name())})};ui.do_app_set_host=function(h){var j=ui.get_app();ui.MessagePanel.doing("Updating release URL for "+j.get_display_name()+"...");j.t_set_host(h).onready(function(){ui.MessagePanel.info("Release URL updated");$("#app-hosts-list").mjt(ui.templates.app_hosts_list())}).onerror(function(n,o){ui.MessagePanel.error(o?o:"Error updating release URL for: "+j.get_display_name())})};
ui.do_app_set_release=function(h){var j=ui.get_app();ui.MessagePanel.doing("Updating release of "+j.get_display_name()+"...");j.t_set_release(h).onready(function(){ui.MessagePanel.info("Release updated to "+h);$("#app-versions-add").mjt(ui.templates.app_versions_list());$("#app-hosts-list").mjt(ui.templates.app_hosts_list())}).onerror(function(n,o){ui.MessagePanel.error(o?o:"Error releasing: "+j.get_display_name())})};ui.do_app_add_version=function(h,j,n){var o=ui.get_app();ui.MessagePanel.doing("Creating version "+
h);o.t_add_version(h,j,n).onready(function(){ui.MessagePanel.info("Created version "+h);$("#app-versions-add").mjt(ui.templates.app_versions_list())}).onerror(function(s,u){ui.MessagePanel.error("Failed to add version. "+u)})};ui.do_app_remove_version=function(h){var j=ui.get_app();ui.MessagePanel.doing("Removing version "+h);j.t_remove_version(h).onready(function(n){ui.MessagePanel.info("Removed version "+h);$("#app-versions-add").mjt(ui.templates.app_versions_list(n))})};ui.do_app_set_listing=function(h,
j,n){var o=ui.get_app();ui.MessagePanel.doing("Updating app name...");o.t_set_listing(h,j,n).onready(function(){h&&ui.add_recent("apps",{path:o.get_path(),name:o.get_display_name()},o.get_path());ui.MessagePanel.info("Updated app name");ui.refresh_app_templates()}).onerror(function(s,u){ui.MessagePanel.error(u?u:"Error changing app name")})};ui.do_app_add_author=function(h){ui.get_app().t_add_author(h).onready(function(){var j=ui.get_app().get_authors();$("#app-authors-list").mjt(ui.templates.app_authors_list(j))})};
ui.do_app_remove_author=function(h){ui.get_app().t_remove_author(h).onready(function(){var j=ui.get_app().get_authors();$("#app-authors-list").mjt(ui.templates.app_authors_list(j))})};ui.do_app_set_oauth=function(h){var j=ui.get_app();ui.MessagePanel.doing("Setting OAuth state...");j.t_set_oauth(h).onready(function(){ui.MessagePanel.info("OAuth "+(h?"enabled":"disabled"))}).onerror(function(n,o){ui.MessagePanel.error("Failed to update OAuth state: "+o)})};ui.do_app_set_writeuser=function(h){var j=
ui.get_app();ui.MessagePanel.doing("Setting write user...");j.t_set_writeuser(h).onready(function(){ui.MessagePanel.info("Write user "+(h?"enabled":"disabled"))}).onerror(function(n,o){ui.MessagePanel.error("Failed to update writeuser state: "+o)})};ui.do_app_add_apikey=function(h,j,n){var o=ui.get_app();ui.MessagePanel.doing("Adding API key for "+h+"...");o.t_add_apikey(h,j,n).onready(function(s){ui.MessagePanel.info(h+" API key added.");$("#app-apikeys-add").mjt(ui.templates.app_apikeys_list(s.keys))}).onerror(function(s,
u){ui.MessagePanel.error("Failed to add API key: "+u)})};ui.do_app_remove_apikey=function(h){var j=ui.get_app();ui.MessagePanel.doing("Deleting API key for "+h+"...");j.t_remove_apikey(h).onready(function(n){ui.MessagePanel.info(h+" API key deleted.");$("#app-apikeys-add").mjt(ui.templates.app_apikeys_list(n.keys))}).onerror(function(n,o){ui.MessagePanel.error("Failed to delete API key: "+o)})};ui.do_app_save_all=function(h){var j=ui.get_app();if(!j.is_dirty()&&typeof h==="function")h();else{ui.MessagePanel.doing("Saving all files...");
j.t_save_all().onready(function(){ui.MessagePanel.info("All files saved.");ui.refresh_file_templates();typeof h==="function"&&setTimeout(h,500)}).onerror(function(n,o){ui.MessagePanel.error("Failed to save all files: "+o)})}};ui.do_app_delete=function(){var h=ui.get_app();ui.MessagePanel.doing("Deleting: "+h.get_display_name()+"...");h.t_delete().onready(function(j){ui.get_store().set_user_apps(j);ui.MessagePanel.info("Deleted app");i=null;ui.add_recent("apps",null,h.get_path());ui.do_choose_app()}).onerror(function(j,
n){ui.MessagePanel.error(n?n:"Error deleting: "+h.get_display_name())})};ui.do_app_apply_changes=function(h,j,n){for(var o=0;o<j.length;o++)ui.do_file_apply_change(h.files[j[o]]);ui.refresh_file_templates();n&&ui.do_app_save_all()};ui.do_file_create_new=function(h,j,n){if(ui.get_app().get_file(h))ui.MessagePanel.error("File with that name already exists");else{h=new AcreDoc(ui.get_app(),h,j,n);ui.do_choose_file(h.get_name())}};ui.do_file_set_acre_handler=function(h){var j=ui.get_file();if(h!==j.get_acre_handler()){j.set_acre_handler(h);
ui.do_refresh_file()}};ui.do_file_set_mime_type=function(h){var j=ui.get_file();if(h!==j.get_mime_type()){j.set_mime_type(h);ui.do_refresh_file()}};ui.do_file_save=function(h){var j=ui.get_file();if(j.is_dirty()){ui.MessagePanel.doing("Saving file: "+j.get_name()+"...");j.t_save(h).enqueue().onready(function(){ui.refresh_file_templates();ui.MessagePanel.info("File saved: "+j.get_name())}).onerror(function(n,o,s){if(n==="/api/status/error/upload/content_mismatch"){ui.MessagePanel.clear();ui.do_show_dialog("diff_patch",
["save_conflict",s.info])}else if(n==="/api/status/error/auth")ui.MessagePanel.error("You are not currently signed in.  To not lose your changes, sign in in a new tab or window and then try again.");else n==="/api/status/error/file_format/unsupported_mime_type"?ui.MessagePanel.error(o):ui.MessagePanel.error(o||"Error saving: "+j.get_name());ui.refresh_file_templates()})}};ui.do_file_save_as=function(h,j){var n=ui.get_file(),o=h==n.get_app().get_path()?n.get_app():new AcreApp(ui.get_store(),h),s={acre_handler:n.get_acre_handler(),
content_type:n.get_mime_type(),based_on:n.get_app().get_path()+"/"+mjt.freebase.mqlkey_quote(n.get_name())},u=new AcreDoc(o,j,s,n.get_editor_state());ui.MessagePanel.doing("Saving file as: "+j+"...");u.t_save().enqueue().onready(function(){o==ui.get_app()?ui.do_choose_file(u.get_name()):o.destroy();ui.MessagePanel.info("File created: "+j)}).onerror(function(z,v,w){w&&w.code=="/api/status/error/auth"?ui.MessagePanel.error("You are not currently signed in.  To not lose your changes, sign in in a new tab or window and then try again."):
ui.MessagePanel.error(v||"Error creating: "+j)})};ui.do_file_revert_to_saved=function(){ui.get_file().t_revert_to_saved().onready(function(){ui.do_refresh_file()})};ui.do_file_move=function(h,j){var n=ui.get_file(),o=n.get_name();if(h!=o)if(ui.get_app().get_file(h))ui.MessagePanel.error('The name "'+h+'" is already taken. Please choose a different name.',j);else{try{n.set_name(h)}catch(s){ui.MessagePanel.error(s,j);return}ui.do_choose_file(n.get_name())}};ui.do_file_delete=function(h){var j=h?ui.get_app().get_file(h):
ui.get_file();ui.MessagePanel.doing("Deleting file:"+j.get_name()+"...");j.t_delete().onready(function(){ui.MessagePanel.info("File deleted: "+j.get_name());l=null;ui.do_choose_file()}).onerror(function(n,o){ui.MessagePanel.error(o?o:"Error deleting: "+j.get_name())})};ui.do_file_apply_change=function(h,j){var n=h.file1,o=h.file2,s;if(n)if(o){s=ui.get_app().get_file(o.name);s.set_name(n.name);s.set_acre_handler(n.acre_handler);s.set_mime_type(n.content_type);if(h.patch){n=h.patch.text;if(s.is_editor_loaded())s.set_editor_state({text:n});
else{$("#file-area").append(s.get_element());s.t_editor_show("TextareaEditor",{margin:false},{text:n});s.hide()}}else n.revision&&n.revision!==o.revision&&s.set_revision(n.revision)}else{s={acre_handler:n.acre_handler,content_type:n.content_type,based_on:n.fileid};s=new AcreDoc(ui.get_app(),n.name,s,{text:n.text});s.hide()}else{s=ui.get_app().get_file(o.name);s.set_dirty("to_delete")}o&&o.name===ui.get_file().get_name()&&ui.do_refresh_file();j&&ui.do_file_save()};ui.do_file_editor_undo=function(){ui.get_file().editor_undo()};
ui.do_file_editor_redo=function(){ui.get_file().editor_redo()};ui.do_file_editor_goto_line=function(h){ui.get_file().editor_goto_line(h)};ui.do_file_editor_indent=function(){ui.get_file().editor_indent()};ui.get_file_check_options=function(){var h={bitwise:true,eqeqeq:true,forin:true,sub:true,undef:true,useful:1},j=["acre","JSON","XMLHttpRequest","console"];switch(ui.get_file().get_acre_handler()){case "mqlquery":break;case "acre_script":h.predef=j;h.es5=true;break;case "mjt":h.es5=true;h.useful=
0;h.predef=j;h.before_check=c;break;case "passthrough":h.browser=true;switch(ui.get_file().get_mime_type()){case "application/json":break;case "text/javascript":break;case "text/html":h.before_check=a;break;case "text/css":h.before_check=d;break;case "text/plain":h.useful=0;break;default:h.useful=-1;break}break;default:h.useful=-1;break}return h};ui.do_click_error=function(h){h=$(h.target);if(h.hasClass("jslint-error")){var j=h.attr("title");ui.MessagePanel.clear();j=(j+"").replace(/\&/g,"&amp;").replace(/</g,
"&lt;").replace(/>/g,"&gt;");ui.MessagePanel.error(j);h=h.text();ui.get_file().editor_goto_line(h)}};ui.do_file_check=function(){ui.do_hide_overlays();var h=$(".CodeMirror-line-numbers,.editor-margin-line-numbers",ui.get_file().get_element());$(">div.jslint-error",h).attr("title","").removeClass("jslint-error");ui.MessagePanel.clear();var j=ui.get_file_check_options();assert.critical(j,"missing jslint_options");var n=ui.get_file().get_editor_state().text;if(j.before_check)n=j.before_check(n);fb.get_script(SERVER.libs.fulljslint,
function(){if(JSLINT(n,j))ui.MessagePanel.info("No syntax errors found");else{var o=JSLINT.errors,s="Found "+o.length+" errors.  Click any of the red line numbers below to see corresponding error details.",u=$(">div",h);if(u.length)for(var z=0;z<o.length;z++){var v=o[z];if(v){var w=u.eq(v.line-1);w.addClass("jslint-error");w.attr("title",w.attr("title")+" "+v.reason)}}else{o=o.slice(0,3);s=$.map(o,function(y){if(y)return"Line: "+y.line+" "+y.reason})}ui.MessagePanel.error(s);ui.get_file().editor_goto_line(o[0].line)}})};
ui.do_zen_coding=function(){if(ui.get_file().get_editor_name()==="CodeMirror"){var h=ui.get_file()._current_editor.editor,j=h.cursorPosition(),n=h.options.indentUnit,o=/(\s*)(.*)/.exec(h.lineContent(j.line));n=Math.floor(o[1].length/n);if(o=o[2]){o=zen.convert(o,n);if(o.error)ui.MessagePanel.error('Zen Coding syntax error in "'+mjt.htmlencode(o.error)+'".<br> See <a target="_blank" href="http://code.google.com/p/zen-coding/wiki/ZenHTMLSelectorsEn">ZenCoding</a> for help');else{ui.MessagePanel.info('Expanded <a target="_blank" href="http://code.google.com/p/zen-coding/wiki/ZenHTMLSelectorsEn">ZenCoding</a> expression');
h.setLineContent(j.line,o.out)}}}};var t={texteditor:"CodeMirror",syntax:navigator.userAgent.indexOf("iPad")===-1?true:false,margin:true,softwrap:false,dotTrigger:false,flw:200,t_mjt:true,t_acre_script:true,t_mqlquery:true,t_passthrough:true,t_binary:true,t_test:true,emql:false};ui.get_editor_prefs=function(h){function j(o){var s=$.localStore(o);return s===null?t[o]:s=="1"?true:s=="0"?false:s}if(h)return j(h);else{h={};for(var n in t)h[n]=j(n);return h}};ui.set_editor_prefs=function(h,j){var n;if(arguments.length==
1)n=h;else if(arguments.length==2){n={};n[h]=j}for(var o in n)$.localStore(o,n[o]===true?"1":n[o]===false?"0":n[o])};ui._get_desired_editor_classname=function(h){h=h||this.get_file();h=h.get_acre_handler();if(h=="binary")return"ImageEditor";else if(h=="mqlquery")return"QueryEditor";else{h=ui.get_editor_prefs("texteditor");return EDITORS[h]?h:t.texteditor}};ui._register_editor_event_handlers=function(h){h.register_editor_event_handlers({change:ui.editor_change_handler,linechange:ui.editor_linechange_handler,
newframe:ui.editor_newframe_handler})};ui.editor_change_handler=function(h,j){if(+new Date-r>6E4){r=+new Date;ui.do_status_check()}p!=ui.get_file().is_dirty()&&ui.refresh_file_templates();if(h>0){ui._has_undos||$("#button-undo").removeAttr("disabled");ui._has_undos=true}else{ui._has_undos&&$("#button-undo").attr("disabled","disabled");ui._has_undos=false}if(j>0){ui._has_redos||$("#button-redo").removeAttr("disabled");ui._has_redos=true}else{ui._has_redos&&$("#button-redo").attr("disabled","disabled");
ui._has_redos=false}};ui.editor_linechange_handler=function(h){m=h;$("#linenumber").val(h)};ui.editor_newframe_handler=function(h){ui.shortcut.register_keys(h.contentWindow?h.contentWindow.document:h.contentDocument)};ui.warn_user_about_unsaved_files=function(){if(ui&&ui.get_app()&&ui.get_app().is_dirty())return"You have unsaved files! The changes you made to these files will be lost if you leave this page."};ui.get_app_url=function(h){return"http://"+h+ui.get_store().get_acre_host()};ui.get_appeditor_url=
function(h,j){var n;if(typeof h=="string")n=h;else if(h instanceof AcreDoc){n=h.get_app().get_versioned_path();j=h.get_relative_path()}else if(h instanceof AcreApp)n=h.get_versioned_path();var o=window.location.protocol+"//"+window.location.host+window.location.pathname;if(n)o+="#!path="+n;if(j)o+="/"+j;return o};ui.id_to_path=function(h){return"//"+h.split("/").reverse().join(".")+"dev"};ui.get_human_timestamp=function(h){return mjt.freebase.date_from_iso(h).toLocaleString()};ui.get_relative_timestamp=
function(h){var j=new Date;h=mjt.freebase.date_from_iso(h);var n=j.getTime()-h.getTime();j=Math.floor(n/94608E7);h=Math.floor(n/2592E6);var o=Math.floor(n/864E5),s=Math.floor(n/36E5);n=Math.floor(n/6E4);if(j>0)return j===1?"1 year ago":j+" years ago";if(h>0)return h===1?"1 month ago":h+" months ago";if(o>0)return o===1?"1 day ago":o+" days ago";if(s>0)return s===1?"1 hour ago":s+" hours ago";if(n>0)return n===1?"1 minute ago":n+" minutes ago";if(n===0)return"less than a minute ago";if(n<0)return"in the future???"};
ui.order_section_files=function(h){var j={};h=h.get_files();for(var n in h){var o=h[n],s=o.get_name();o=o.get_acre_handler();o=o=="acre_script"&&s.substr(0,5)=="test_"?"test":o;if(typeof j[o]=="undefined")j[o]=[];j[o].push(s)}for(var u in j)j[u].sort(function(z,v){return z.localeCompare(v)});return j};ui.order_lib_files=function(h){var j=[];h=h.get_files();for(var n in h)j.push(h[n].get_name());j.sort(function(o,s){return o.localeCompare(s)});return j};ui.watch_inputs=function(h,j){function n(){var v=
false,w=j.inputs.length,y={};jQuery.each(j.inputs,function(A){var B,D=$("#"+A)[0];if(typeof D=="undefined")D=$("input[name='"+A+"']")[0];if(typeof D!="undefined"){if(D.tagName=="TEXTAREA")B=jQuery.trim($("#"+A).val());else if(D.tagName=="INPUT"){D=$(D).attr("type");if(D=="text")B=jQuery.trim($("#"+A).val());else if(D=="radio")B=$("input[name='"+A+"']:checked").val();else if(D=="checkbox")B=$("#"+A).attr("checked")}else if(D.tagName=="SELECT")B=$("#"+A+" :selected").val();if(B!=j.inputs[A]){v=true;
w-=1;y[A]=B}}});return j.activate_on=="all"?w===0?y:false:v?y:false}function o(){var v=n();if(v){$("#button-"+h).removeAttr("disabled").addClass("button-primary");j.change&&j.change.apply(this,[v])}else $("#button-"+h).attr("disabled","disabled").removeClass("button-primary")}function s(v){$("#"+v).bind("change",function(){o()})}function u(v){var w;$("#"+v).bind("keyup",function(){clearTimeout(w);w=setTimeout(o,j.text_delay||300)})}function z(v){$("input[name='"+v+"']").bind("click",function(){o()})}
jQuery.each(j.inputs,function(v,w){var y=$("#"+v)[0];if(typeof y=="undefined")y=$("input[name='"+v+"']")[0];if(typeof y!="undefined")if(y.tagName=="TEXTAREA")u(v,w);else if(y.tagName=="INPUT"){y=$(y).attr("type");if(y=="text")u(v);else y=="radio"?z(v):s(v)}else y.tagName=="SELECT"&&s(v)});$("#button-"+h).unbind("click").click(function(){var v=n();j.submit.apply(this,[v]);if(j.update_on_submit){jQuery.extend(j.inputs,v);o()}})};ui.populate_diff=function(h,j,n){function o(){var C=h.parent().height()-
v.height();y.height(C);A.height(C);D.height(C);F.height(C)}function s(){var C;if(j.file1||typeof j.file1==="undefined"){C=A.scrollTop();y.scrollTop(C)}else C=F.scrollTop();if(j.file2||typeof j.file2==="undefined"){D.scrollTop(C);F.scrollTop(C)}}function u(C,P,G,K){var I;I=G.length>1?"replace":G[0][0]==-1&&K==="left"?"delete":G[0][0]==1&&K==="right"?"insert":"eq";var J=$('<div class="line"></div>'),L=K==="left"?1:-1;if(G.length==1&&G[0][0]==L)J.append("<pre> </pre>");else{J.append($("<pre></pre>").text(O[K]));
G.length===1&&G[0][0]===L||(O[K]+=1)}C.append(J);C=$('<div class="code"></div>').addClass(I);I=$("<pre></pre>");J=false;for(L=0;L<G.length;L++){var H=G[L],N=H[1]===""?" ":H[1];switch(H[0]){case 0:J=true;H=$('<span class="text-eq"></span>').text(N);I.append(H);break;case 1:if(K==="right"){J=true;H=$('<span class="text-add"></span>').text(N);I.append(H)}break;case -1:if(K==="left"){J=true;H=$('<span class="text-delete"></span>').text(N);I.append(H)}break}}J||I.text(" ");C.append(I);P.append(C)}function z(C){C=
C.fileid.split("/");C.pop();return C.join("/")}var v=$('<div class="diff-header-container"></div>'),w=$('<div class="diff-header"></div>'),y=$('<div class="diff-line-container"></div>'),A=$('<div class="diff-code-container"></div>'),B=$('<div class="diff-header"></div>'),D=$('<div class="diff-line-container"></div>'),F=$('<div class="diff-code-container"></div>'),O={left:1,right:1};if(j.labels&&j.labels.length){if(j.labels[0]){n=$("<h3></h3>");n.text(j.labels[0]);B.append(n);v.append(B)}if(j.labels[1]){n=
$("<h3></h3>");n.text(j.labels[1]);w.append(n);v.append(w)}}else{if(j.file2){var E=$("<h3></h3>");if(!j.file1){B.addClass("full");F.addClass("full");E.append("Delete: ")}(j.file1&&j.file2?j.file1.name!==j.file2.name:false)&&E.addClass("change");E.append(j.file2.name);z(j.file2)!==ui.get_app().get_path()&&E.append("in "+z(j.file2));var M=$("<h3></h3>");(j.file1&&j.file2?j.file1.acre_handler!==j.file2.acre_handler||j.file1.content_type!==j.file2.content_type:false)&&M.addClass("change");M.append(ui.get_store().get_acre_handlers()[j.file2.acre_handler].name);
j.file2.content_type&&M.append(" ("+j.file2.content_type+")");B.append(E).append(M);if(n==="get_file_diff"){E=$("<h3></h3>");j.file2.last_modified&&E.append("Last Mod: "+ui.get_human_timestamp(j.file2.last_modified));B.append(E)}v.append(B)}if(j.file1){B=$("<h3></h3>");if(j.file2)n=="get_file_merge"&&B.append("After Merge: ");else{w.addClass("full");A.addClass("full");B.append("Create: ")}B.append(j.file1.name);n=="get_file_diff"&&z(j.file1)!==ui.get_app().get_path()&&B.append("in "+z(j.file1));E=
$("<h3></h3>");E.append(ui.get_store().get_acre_handlers()[j.file1.acre_handler].name);j.file1.content_type&&E.append(" ("+j.file1.content_type+")");w.append(B).append(E);if(n==="get_file_diff"){n=$("<h3></h3>");j.file1.last_modified&&n.append("Last Mod: "+ui.get_human_timestamp(j.file1.last_modified));w.append(n)}v.append(w)}}h.append(v);if(j.message)h.append($('<div class="message"></div>').text(j.message));else if(j.file1&&j.file2&&j.file1.revision===j.file2.revision)h.append('<div class="message">No change in content</div>');
else if(j.file2&&j.file2.binary||j.file1&&j.file1.binary){if(j.file2&&j.file2.binary){D.append("<pre> </pre>");F.append('<div class="image"><div class="image-preview"><img src="'+j.file2.binary+'" /></div></div>');h.append(D).append(F)}if(j.file1&&j.file1.binary){y.append("<pre> </pre>");A.append('<div class="image"><div class="image-preview"><img src="'+j.file1.binary+'" /></div></div>');h.append(y).append(A)}}else if(j.diff){for(w=0;w<j.diff.length;w++){n=j.diff[w];if(j.file2||typeof j.file2===
"undefined")u(D,F,n,"left");if(j.file1||typeof j.file1==="undefined")u(y,A,n,"right")}if(j.file2||typeof j.file2==="undefined"){D.append('<div class="line"><pre> </pre></div>');h.append(D).append(F);F.scroll(s)}if(j.file1||typeof j.file1==="undefined"){y.append('<div class="line"><pre> </pre></div>');h.append(y).append(A);A.scroll(s)}if((j.file1||typeof j.file1==="undefined")&&(j.file2||typeof j.file2==="undefined"))F.css("overflow-y","hidden")}o();$(window).resize(o)};ui.MessagePanel=function(){function h(s,
u,z){if(o&&o==="error")mjt.error("MessagePanel: Already displaying error. Ignoring: "+s+": "+u);else{$("#message-panel").hide().mjt(ui.templates.message_panel(s,u,null));o=s;window.clearTimeout(j);n=function(){$("#message-panel").empty();o=n=null};j=window.setTimeout(n,z);$("#message-panel").slideDown(300)}}var j,n,o;return{doing:function(s,u){h("doing",s,2E6,u);return""},info:function(s,u){h("info",s,4E3,u);return""},error:function(s,u){h("error",s,6E3,u);return""},clear:function(){window.clearTimeout(j);
n&&n()}}}();ui.shortcut={};(function(){var h=[{op:"Code Assist"},{op:"Open App",key:"O",action:function(){ui.do_show_menu("apps",[true])}},{op:"Save File",key:"S",action:function(){ui.do_file_save()}},{op:"View",key:"Shift-P",action:function(){ui.do_run_view(null,false)}},{op:"View with Console",key:"P",action:function(){ui.do_run_view(null,true)}},{op:"Undo",key:"Z",action:function(){ui.do_file_editor_undo()}},{op:"Redo",key:"Shift-Z",action:function(){ui.do_file_editor_redo()}},{op:"Redo",key:"Y",
action:function(){ui.do_file_editor_redo()}},{op:"Check Syntax",key:"Shift-C",action:function(){ui.do_file_check()}},{op:"Expand Expression",key:"E",action:function(){ui.do_zen_coding()}},{op:"Indent Selection",key:"Shift-I",action:function(){ui.do_file_editor_indent()}},{op:"Jump to Line",key:"J",action:function(){$("#linenumber").focus().select()}}],j=navigator.platform.indexOf("Mac")===0?"Meta":"Ctrl";ui.shortcut.register_keys=function(n){$.each(h,function(o,s){shortcut.add(j+"-"+s.key,s.action,
{target:n})})};ui.shortcut.get_shortcuts=function(){return h};ui.shortcut.get_keys=function(n){var o;if(n=="Code Assist")o=(navigator.platform.indexOf("Mac")===0?"Alt-":"Ctrl-")+"Space";else $.each(h,function(s,u){if(u.op==n)o=(navigator.platform.indexOf("Mac")===0?"&#8984;-":"Ctrl-")+u.key});return o}})()})();
$(document).ready(function(){if($.browser.msie&&$.browser.version<"8.0")assert.critical(false,"Internet Explorer 6 and 7 are not supported.  IE8+, Firefox 3+ and Safari 3+ are.Another option is to install <a href='http://www.google.com/chromeframe'>Google Chrome Frame</a>");else{ui.set_store(new FreebaseStore);var a=ui.get_store();a.t_init().onready(function(){ui.set_user(a.get_user());ui.init();a.TestCookies(a).enqueue().onerror(function(){ui.MessagePanel.error("Your browser configuration may not always let you see your latest changes when clicking <b>View</b> (third-party cookies).<br/><br/>Hold down the <b>Shift</b> key when clicking the browser <b>Refresh</b> button to ensure you're seeing the latest.")})}).onerror(function(b,
c,d){assert.critical(false,"Error connecting to Freebase<br/>"+c);mjt.error(b,c,d)})}});
