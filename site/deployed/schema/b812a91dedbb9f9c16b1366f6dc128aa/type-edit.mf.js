/*
 
 jQuery Tools @VERSION / Expose - Dim the lights

 NO COPYRIGHTS OR LICENSES. DO WHAT YOU LIKE.

 http://flowplayer.org/tools/toolbox/expose.html

 Since: Mar 2010
 Date: @DATE 
 
 jQuery Tools @VERSION Overlay - Overlay base. Extend it.

 NO COPYRIGHTS OR LICENSES. DO WHAT YOU LIKE.

 http://flowplayer.org/tools/overlay/

 Since: March 2008
 Date: @DATE 
*/
(function(a){function l(){if(a.browser.msie){var h=a(document).height(),j=a(window).height();return[window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,h-j<20?j:h]}return[a(document).width(),a(document).height()]}function i(h){if(h)return h.call(a.mask)}a.tools=a.tools||{version:"@VERSION"};var c;c=a.tools.expose={conf:{maskId:"exposeMask",loadSpeed:"slow",closeSpeed:"fast",closeOnClick:true,closeOnEsc:true,zIndex:9998,opacity:0.8,startOpacity:0,color:"#fff",onLoad:null,
onClose:null}};var b,e,d,f,g;a.mask={load:function(h,j){if(d)return this;if(typeof h=="string")h={color:h};h=h||f;f=h=a.extend(a.extend({},c.conf),h);b=a("#"+h.maskId);if(!b.length){b=a("<div/>").attr("id",h.maskId);a("body").append(b)}var o=l();b.css({position:"absolute",top:0,left:0,width:o[0],height:o[1],display:"none",opacity:h.startOpacity,zIndex:h.zIndex});h.color&&b.css("backgroundColor",h.color);if(i(h.onBeforeLoad)===false)return this;h.closeOnEsc&&a(document).bind("keydown.mask",function(m){m.keyCode==
27&&a.mask.close(m)});h.closeOnClick&&b.bind("click.mask",function(m){a.mask.close(m)});a(window).bind("resize.mask",function(){a.mask.fit()});if(j&&j.length){g=j.eq(0).css("zIndex");a.each(j,function(){var m=a(this);/relative|absolute|fixed/i.test(m.css("position"))||m.css("position","relative")});e=j.css({zIndex:Math.max(h.zIndex+1,g=="auto"?0:g)})}b.css({display:"block"}).fadeTo(h.loadSpeed,h.opacity,function(){a.mask.fit();i(h.onLoad)});d=true;return this},close:function(){if(d){if(i(f.onBeforeClose)===
false)return this;b.fadeOut(f.closeSpeed,function(){i(f.onClose);e&&e.css({zIndex:g})});a(document).unbind("keydown.mask");b.unbind("click.mask");a(window).unbind("resize.mask");d=false}return this},fit:function(){if(d){var h=l();b.css({width:h[0],height:h[1]})}},getMask:function(){return b},isLoaded:function(){return d},getConf:function(){return f},getExposed:function(){return e}};a.fn.mask=function(h){a.mask.load(h);return this};a.fn.expose=function(h){a.mask.load(h,this);return this}})(jQuery);
(function(a){function l(b,e){var d=this,f=b.add(d),g=a(window),h,j,o,m=a.tools.expose&&(e.mask||e.expose),r=Math.random().toString().slice(10);if(m){if(typeof m=="string")m={color:m};m.closeOnClick=m.closeOnEsc=false}var q=e.target||b.attr("rel");j=q?a(q):b;if(!j.length)throw"Could not find Overlay: "+q;b&&b.index(j)==-1&&b.click(function(k){d.load(k);return k.preventDefault()});a.extend(d,{load:function(k){if(d.isOpened())return d;var n=c[e.effect];if(!n)throw'Overlay: cannot find effect : "'+e.effect+
'"';e.oneInstance&&a.each(i,function(){this.close(k)});k=k||a.Event();k.type="onBeforeLoad";f.trigger(k);if(k.isDefaultPrevented())return d;o=true;m&&a(j).expose(m);var p=e.top,t=e.left,u=j.outerWidth({margin:true}),v=j.outerHeight({margin:true});if(typeof p=="string")p=p=="center"?Math.max((g.height()-v)/2,0):parseInt(p,10)/100*g.height();if(t=="center")t=Math.max((g.width()-u)/2,0);n[0].call(d,{top:p,left:t},function(){if(o){k.type="onLoad";f.trigger(k)}});m&&e.closeOnClick&&a.mask.getMask().one("click",
d.close);e.closeOnClick&&a(document).bind("click."+r,function(s){a(s.target).parents(j).length||d.close(s)});e.closeOnEsc&&a(document).bind("keydown."+r,function(s){s.keyCode==27&&d.close(s)});return d},close:function(k){if(!d.isOpened())return d;k=k||a.Event();k.type="onBeforeClose";f.trigger(k);if(!k.isDefaultPrevented()){o=false;c[e.effect][1].call(d,function(){k.type="onClose";f.trigger(k)});a(document).unbind("click."+r).unbind("keydown."+r);m&&a.mask.close();return d}},getOverlay:function(){return j},
getTrigger:function(){return b},getClosers:function(){return h},isOpened:function(){return o},getConf:function(){return e}});a.each("onBeforeLoad,onStart,onLoad,onBeforeClose,onClose".split(","),function(k,n){a.isFunction(e[n])&&a(d).bind(n,e[n]);d[n]=function(p){a(d).bind(n,p);return d}});h=j.find(e.close||".close");if(!h.length&&!e.close){h=a('<a class="close"></a>');j.prepend(h)}h.click(function(k){d.close(k)});e.load&&d.load()}a.tools=a.tools||{version:"@VERSION"};a.tools.overlay={addEffect:function(b,
e,d){c[b]=[e,d]},conf:{close:null,closeOnClick:true,closeOnEsc:true,closeSpeed:"fast",effect:"default",fixed:!a.browser.msie||a.browser.version>6,left:"center",load:false,mask:null,oneInstance:true,speed:"normal",target:null,top:"10%"}};var i=[],c={};a.tools.overlay.addEffect("default",function(b,e){var d=this.getConf(),f=a(window);if(!d.fixed){b.top+=f.scrollTop();b.left+=f.scrollLeft()}b.position=d.fixed?"fixed":"absolute";this.getOverlay().css(b).fadeIn(d.speed,e)},function(b){this.getOverlay().fadeOut(this.getConf().closeSpeed,
b)});a.fn.overlay=function(b){var e=this.data("overlay");if(e)return e;if(a.isFunction(b))b={onBeforeLoad:b};b=a.extend(true,{},a.tools.overlay.conf,b);this.each(function(){e=new l(a(this),b);i.push(e);a(this).data("overlay",e)});return b.api?e:this}})(jQuery);
(function(a,l){var i=l.schema.edit={init_edit_form:function(c){if(c.mode==="add")a("tbody",c.table).append(c.row);else if(c.mode==="edit")c.trigger_row.before(c.row);else throw"Unknown edit type mode: "+c.mode;c.trigger_row.before(c.submit_row);var b=c.event_prefix||"fb.schema.edit.";c.row.bind(b+"submit",function(){console.log(b+"submit");i.submit_edit_form(c)}).bind(b+"cancel",function(){console.log(b+"cancel");i.cancel_edit_form(c)}).bind(b+"error",function(e,d,f){console.log(b+"error",d,f);i.row_error(d,
f)}).bind(b+"success",function(){console.log(b+"success");c.row.removeClass("loading")});a(".button-submit",c.submit_row).click(function(){c.row.trigger(b+"submit")});a(".button-cancel",c.submit_row).click(function(){c.row.trigger(b+"cancel")});typeof c.init_form==="function"&&c.init_form(c);c.row.showRow(function(){a(":text:first",c.row).focus()});c.trigger_row.hide();c.submit_row.show()},cancel_edit_form:function(c){c.row.hideRow(function(){a(this).remove()});i.clear_row_message(c.row);c.submit_row.remove();
c.trigger_row.show();c.trigger.removeClass("editing")},submit_edit_form:function(c){if(!c.row.is(".loading")){document.activeElement&&a(document.activeElement).blur();i.clear_row_message(c.row);typeof c.validate_form==="function"&&c.validate_form(c);if(!i.has_row_message(c.row,"error")){c.row.addClass("loading");typeof c.submit_form==="function"&&c.submit_form(c)}}},ajax_error_handler:function(c,b,e){var d;try{d=JSON.parse(c.responseText);d=d.messages[0].message}catch(f){d=c.responseText}if(b)i.row_error(b,
d);else e&&i.form_error(e,d)},row_error:function(c,b){return i.row_message(c,b,"error")},row_message:function(c,b,e){var d=a('<a class="close-msg" href="#">Close</a>').click(function(f){return l.schema.close_message.apply(this,[f,".row-msg:first"])});b=a("<span>").text(b);d=a('<td colspan="5">').append(d).append(b);d=a('<tr class="row-msg">').append(d);e&&d.addClass("row-msg-"+e);c.before(d);d.hide().showRow();b=c.data("row-msg");if(!b){b={};c.data("row-msg",b)}if(b[e])b[e].push(d);else b[e]=[d];
return d},clear_row_message:function(c){var b=c.data("row-msg");if(b){a.each(b,function(e,d){a.each(d,function(f,g){g.remove()})});c.removeData("row-msg")}},has_row_message:function(c,b){var e=c.data("row-msg");if(b)return e&&e[b]&&e[b].length;return e!=null},init_settings_form:function(c){a(document.body).append(c.form.hide());var b=c.event_prefix||"fb.schema.edit.settings.";c.form.bind(b+"submit",function(){console.log(b+"submit");i.submit_settings_form(c)}).bind(b+"error",function(e,d){console.log(b+
"error",d);i.form_error(c.form,d)}).bind(b+"success",function(){console.log(b+"success");c.form.removeClass("loading")});a(".button-submit",c.form).click(function(){c.form.trigger(b+"submit")});typeof c.init_form==="function"&&c.init_form(c);c.form.overlay({close:".button-cancel",closeOnClick:false,load:true,mask:{color:"#000",loadSpeed:200,opacity:0.5}})},submit_settings_form:function(c){if(!c.form.is(".loading")){document.activeElement&&a(document.activeElement).blur();i.clear_form_message(c.form);
typeof c.validate_form==="function"&&c.validate_form(c);if(!i.has_form_message(c.form,"error")){c.form.addClass("loading");typeof c.submit_form==="function"&&c.submit_form(c)}}},form_error:function(c,b){return i.form_message(c,b,"error")},form_message:function(c,b,e){b=a("<div class='form-msg'>").text(b).hide();a(".form-group",c).prepend(b);b.slideDown();var d=c.data("form-msg");if(!d){d={};c.data("form-msg",d)}if(d[e])d[e].push(b);else d[e]=[b];return b},clear_form_message:function(c){var b=c.data("form-msg");
if(b){a.each(b,function(e,d){a.each(d,function(f,g){g.remove()})});c.removeData("form-msg")}},has_form_message:function(c,b){var e=c.data("form-msg");if(b)return e&&e[b]&&e[b].length;return e!=null}}})(jQuery,window.freebase);
(function(a){a.suggest||alert("$.suggest required");var l={_init:a.suggest.suggest.prototype._init,status_start:a.suggest.suggest.prototype.status_start,status_loading:a.suggest.suggest.prototype.status_loading,status_select:a.suggest.suggest.prototype.status_select,create_item:a.suggest.suggest.prototype.create_item,focus:a.suggest.suggest.prototype.focus};a.fn.placeholder=a.noop;a.suggest("suggest_expected_type",a.extend(true,{},a.suggest.suggest.prototype,{_init:function(){var c=this;l._init.call(c);
this.ect_pane=a('<div class="ect-pane fbs-reset">');this.ect_menu=a('<div class="ect-menu-dialog"><span class="ect-menu-title">or choose from the data types below</span></div>');this.ect_list=a('<ul class="ect-menu clear">');a.each(["text","numeric","date","boolean","image","weblink","address"],function(b,e){c.ect_list.append(c["create_ect_"+e].call(c))});this.ect_unit=a('<div class="ect-unit-dialog"><h2 class="ect-unit-dialog-title">Select measurement type</h2><div class="ect-unit-field"><label for="dimension">The kind of thing to measure</label><select name="dimension"></select></div><div class="ect-unit-field"><label for="dimension-unit">The unit to measure it in</label><select name="dimension-unit"></select></div><div class="ect-unit-submit"><button class="button button-primary button-submit">OK</button><button class="button button-cancel">Cancel</button></div></div>').hide();
this.ect_dimension=a("select:first",this.ect_unit);this.ect_dimension_units=a("select:eq(1)",this.ect_unit);this.ect_dimension.change(function(){var b=a("[selected]",this).data("units");if(c.ect_dimension_units.data("units")!==b){c.ect_dimension_units.empty();a.each(b,function(e,d){var f=d.name;if(d["/freebase/unit_profile/abbreviation"])f+=" ("+d["/freebase/unit_profile/abbreviation"]+")";f=a("<option>").text(f).attr("value",d.id).data("data",d);c.ect_dimension_units.append(f);d.id==="/en/meter"&&
f.attr("selected","selected")})}});a(".button-cancel",this.ect_unit).click(function(b){c.ect_menu.show();c.ect_unit.hide();c.status.show();c.input.focus().removeData("dont_hide");b.stopPropagation()});a(".button-submit",this.ect_unit).click(function(b){var e={name:"Measurment",id:"/type/float",unit:a("[selected]",c.ect_dimension_units).data("data")};c.input.val(e.name).data("data.suggest",e).trigger("fb-select",e);c.input.focus().removeData("dont_hide");c.ect_menu.show();c.ect_unit.hide();c.hide_all();
b.stopPropagation()});this.ect_pane.append(this.ect_menu);this.ect_pane.append(this.ect_unit);this.ect_menu.append(this.ect_list);this.ect_pane.bind("ect",function(b,e){a(".trigger",this).each(function(){var d=a(this).data("tooltip");d&&d.hide()});if(e.id==="/type/float"&&e.name==="Measurement"){c.ect_menu.hide();c.ect_unit.show();c.status.hide()}else{c.input.val(e.name).data("data.suggest",e).trigger("fb-select",e);c.hide_all()}}).bind("mouseup",function(b){b.stopPropagation()});this.pane.append(this.ect_pane);
a.suggest.suggest_expected_type.load_dimensions()},status_start:function(){l.status_start.apply(this);this.ect_pane.show();this.ect_unit.is(":visible")&&this.status.hide()},status_loading:function(){l.status_loading.apply(this);this.ect_pane.hide()},status_select:function(){l.status_select.apply(this);this.ect_pane.hide()},create_ect_text:function(){var c=this.create_ect_item("Text");a("> a",c).after(this.create_ect_tooltip([{name:"Short Text Input",id:"/type/text"},{name:"Machine readable string",
id:"/type/rawstring"}])).tooltip(this.options.tooltip_options);return c},create_ect_numeric:function(){var c=this.create_ect_item("Numeric");a("> a",c).after(this.create_ect_tooltip([{name:"Integer",id:"/type/int"},{name:"Decimal point number",id:"/type/float"},{name:"Measurement",id:"/type/float"},{name:"Dated Currency",id:"/measurement_unit/dated_money_value"},{name:"Dated Integer",id:"/measurement_unit/dated_integer"},{name:"Dated Decimal Point Number",id:"/measurement_unit/dated_float"},{name:"Integer Range",
id:"/measurement_unit/integer_range"},{name:"Decimal Point Number Range",id:"/measurement_unit/floating_point_range"}])).tooltip(this.options.tooltip_options);return c},create_ect_date:function(){var c=this.create_ect_item("Date/Time","date");a("> a",c).after(this.create_ect_tooltip([{name:"Date/Time",id:"/type/datetime"},{name:"Day of Week",id:"/time/day_of_week"},{name:"Date of Year",id:"/time/day_of_year"},{name:"Time interval",id:"/measurement_unit/time_interval"}])).tooltip(this.options.tooltip_options);
return c},create_ect_boolean:function(){var c=this.create_ect_item("Boolean");a("> a",c).data("ect",{name:"Boolean",id:"/type/boolean"}).click(function(){a(this).trigger("ect",a(this).data("ect"))});return c},create_ect_image:function(){var c=this.create_ect_item("Image");a("> a",c).data("ect",{name:"Image",id:"/common/image"}).click(function(){a(this).trigger("ect",a(this).data("ect"))});return c},create_ect_weblink:function(){var c=this.create_ect_item("Weblink");a("> a",c).data("ect",{name:"Weblink",
id:"/common/webpage"}).click(function(){a(this).trigger("ect",a(this).data("ect"))});return c},create_ect_address:function(){var c=this.create_ect_item("Address");a("> a",c).data("ect",{name:"Address",id:"/location/mailing_address"}).click(function(){a(this).trigger("ect",a(this).data("ect"))});return c},create_ect_item:function(c,b){b||(b=c.toLowerCase());var e=a('<li class="ect-menu-item">'),d=a('<a href="javascript:void(0);" class="ect-icon trigger">');d.addClass("ect-"+b);e.append(d);e.append(document.createTextNode(c));
return e},create_ect_tooltip:function(c){var b=a('<ul class="row-menu tooltip">');a.each(c,function(e,d){var f=a('<li class="row-menu-item">'),g=a('<a href="javascript:void(0);">').attr("title",d.id).data("ect",d).click(function(){a(this).trigger("ect",a(this).data("ect"))});g.text(d.name);f.append(g);b.append(f)});return b},create_item:function(c,b){var e=l.create_item.apply(this,[c,b]),d=c.id.split("/");d.pop();d=d.join("/");a("."+this.options.css.item_type,e).text(d);return e},focus:function(c){l.focus.apply(this,
[c]);this.input.removeData("dont_hide")}}));var i=a.suggest.suggest_expected_type;a.extend(i,{defaults:a.extend(true,{},a.suggest.suggest.defaults,{category:"expected_type",tooltip_options:{events:{def:"click,mouseout"},position:"bottom right",offset:[-10,-10],effect:"fade",delay:300,relative:true}}),set_dimensions:function(c){a(".ect-pane select[name=dimension]").each(function(){var b=a(this);if(b.data("dimensions")!==c){var e;a.each(c,function(d,f){var g=a("<option>").text(f.name).attr("value",
f.id).data("units",f.units);b.append(g);if(f.id==="/en/length")e=g});b.data("dimensions",c);if(e){e.attr("selected","selected");b.change()}}})},load_dimensions:function(){function c(e){return e<10?"0"+e:e}if(i.dimensions)i.set_dimensions(i.dimensions);else if(!i.load_dimensions.lock){i.load_dimensions.lock=true;var b=new Date;b=[b.getFullYear(),c(b.getMonth()+1),c(b.getDate())].join("-");a.ajax({url:"http://api.freebase.com/api/service/mqlread",data:{query:JSON.stringify({query:[{id:null,name:null,
type:"/measurement_unit/dimension",units:[{id:null,name:null,type:"/type/unit","/freebase/unit_profile/abbreviation":null}]}],as_of_time:b})},dataType:"jsonp",jsonpCallback:"jQuery.suggest.suggest_expected_type.jsonpCallback"})}},jsonpCallback:function(c){if(c.code==="/api/status/ok"){i.dimensions=c.result.sort(i.sort_by_name);a.each(i.dimensions,function(b,e){e.units.sort(i.sort_by_name)});i.set_dimensions(i.dimensions)}},sort_by_name:function(c,b){return b.name<c.name}})})(jQuery);
(function(a){a.suggest||alert("$.suggest required");var l={create_item:a.suggest.suggest.prototype.create_item};a.fn.placeholder=a.noop;a.suggest("suggest_property",a.extend(true,{},a.suggest.suggest.prototype,{create_item:function(i,c){var b=l.create_item.apply(this,[i,c]),e=i.id.split("/");e.pop();e=e.join("/");a("."+this.options.css.item_type,b).text(e);return b}}));a.extend(a.suggest.suggest_property,{defaults:a.extend(true,{},a.suggest.suggest.defaults,{type:"/type/property",type_strict:"any"})})})(jQuery);
(function(a,l){var i=l.schema.edit,c=l.schema.type.edit={type_settings_begin:function(b,e){a.ajax({url:acre.request.app_url+"/schema/type/type_settings_begin",data:{id:e},dataType:"json",success:function(d){d=a(d.result.html);d={event_prefix:"fb.schema.type.settings.",ajax:{url:acre.request.app_url+"/schema/type/type_settings_submit",data:{id:e}},init_form:c.init_type_settings_form,validate_form:c.validate_type_settings_form,submit_form:c.submit_type_settings_form,form:d};i.init_settings_form(d);
d.form.bind(d.event_prefix+"success",function(f,g){window.location=g.location})}})},init_type_settings_form:function(b){a(":input:not(textarea)",b.form).keypress(function(e){e.keyCode===13&&!e.isDefaultPrevented()&&b.form.trigger(b.event_prefix+"submit")})},validate_type_settings_form:function(b){var e=a.trim(a("input[name=name]",b.form).val()),d=a.trim(a("input[name=key]",b.form).val()).toLowerCase();if(e===""||d==="")b.form.trigger(b.event_prefix+"error","Name and Key are required");else/^[a-z][a-z0-9_\-]{3,}$/.test(d)||
b.form.trigger(b.event_prefix+"error","Key must be four or more alphanumeric characters, no spaces and not begin with a number")},submit_type_settings_form:function(b){var e=a.trim(a(":input[name=name]",b.row).val()),d=a.trim(a("input[name=key]",b.form).val()).toLowerCase(),f=a(":input[name=role]",b.row);f=f.is(":checked")?f.val():"";e={name:e,key:d,domain:a("input[name=namespace]",b.form).val(),description:a("textarea[name=description]",b.form).val(),role:f};a.ajax({url:b.ajax.url,type:"POST",dataType:"json",
data:a.extend(e,b.ajax.data),success:function(g,h,j){if(g.code==="/api/status/error")return i.ajax_error_handler(j,null,b.form);b.form.trigger(b.event_prefix+"success",g.result)},error:function(g){i.ajax_error_handler(g,null,b.form)}})},init_delegate_property:function(b){a(".nav-toggle",b.row).click(function(){c.toggle_delegate_property(a(this),b);return false})},toggle_delegate_property:function(b,e){if(b.is(".current"))return false;var d=b.parents(".nav:first");a(".nav-toggle",d).removeClass("current");
b.addClass("current");var f=a(".fb-property-expected-type",e.row);a("input",f).val("");f=a("input[name=unique]",e.row).removeAttr("checked");a(".form-msg",e.row).remove();if(b.is(".nav-delegate")){a(".nav-delegate-msg",d).show();a("input[name=expected_type_input]",e.row).hide().prev(".form-label").text("Property to use");d=a("input[name=delegated]",e.row).show();a("label[for=master]",e.row).find("span").text("Delegated");f.attr("disabled","disabled");if(!d.data("suggest_property")){console.log("init delegated suggest");
d.unbind().suggest_property({service_url:acre.freebase.service_url}).bind("fb-select",function(g,h){a(this).val(h.id);setTimeout(function(){c.delegate_property_begin(e,h.id)},0)}).keypress(function(g){if(g.keyCode===13&&!g.isDefaultPrevented()){console.log("enter");e.row.trigger(e.event_prefix+"submit")}}).keyup(function(g){g.keyCode===27&&e.row.trigger(e.event_prefix+"cancel")})}}else{a(".nav-delegate-msg",d).hide();a("input[name=delegated]",e.row).hide();a("input[name=expected_type_input]",e.row).show().prev(".form-label").text("Expected Type");
a("label[for=master]",e.row).find("span").text("Master");f.removeAttr("disabled")}a("input[name=name]",e.row).focus()},delegate_property_begin:function(b,e){b.row.addClass("loading");a.ajax({url:acre.request.app_url+"/schema/type/delegate_property_begin",data:{id:e},dataType:"json",success:function(d,f,g){if(d.code==="/api/status/error")return i.ajax_error_handler(g,b.row);d=d.result;f={id:d.expected_type,unit:d.unit};a("input[name=expected_type_input]",b.row).trigger("fb-select",f);d.unique&&a("input[name=unique]",
b.row).attr("checked","checked");a(".form-msg",b.row).remove();f=a(".form-field:first",b.row);d=a(d.message);f.before(d)},error:function(d){i.ajax_error_handler(d,b.row)},complete:function(){b.row.removeClass("loading")}})},add_property_begin:function(b,e){var d=b.parents("tr:first");a.ajax({url:acre.request.app_url+"/schema/type/add_property_begin",data:{id:e},dataType:"json",success:function(f,g,h){if(f.code==="/api/status/error")return i.ajax_error_handler(h,d);f=a(f.result.html);var j={mode:"add",
event_prefix:"fb.schema.type.add.property.",ajax:{url:acre.request.app_url+"/schema/type/add_property_submit"},init_form:c.init_property_form,validate_form:c.validate_property_form,submit_form:c.submit_property_form,table:b.parents("table:first"),trigger:b,trigger_row:d,row:a(".edit-row",f).hide(),submit_row:a(".edit-row-submit",f).hide()};i.init_edit_form(j);a.trim(a(".page-meta .flags").text())==="Compound Value Type"?a(".nav",j.row).hide():c.init_delegate_property(j);j.row.bind("fb.schema.type.add.property.success",
function(){var o=a("tbody:first .table-empty-column",j.table);o.length&&o.parents("tr:first").hide().prev("tr").show();a(".button-cancel",j.submit_row).text("Done");c.init_property_form(j)})},error:function(f){i.ajax_error_handler(f,d)}})},edit_property_begin:function(b,e){var d=b.parents("tr:first");a.ajax({url:acre.request.app_url+"/schema/type/edit_property_begin",data:{id:e},dataType:"json",success:function(f,g,h){if(f.code==="/api/status/error")return i.ajax_error_handler(h,d);f=a(f.result.html);
var j={mode:"edit",event_prefix:"fb.schema.type.edit.property.",ajax:{url:acre.request.app_url+"/schema/type/edit_property_submit",data:{id:e}},init_form:c.init_property_form,validate_form:c.validate_property_form,submit_form:c.submit_property_form,table:b.parents("table:first"),trigger:b,trigger_row:d,row:a(".edit-row",f).hide(),submit_row:a(".edit-row-submit",f).hide()};i.init_edit_form(j);j.row.bind("fb.schema.type.edit.property.success",function(){j.trigger_row.remove();j.row.remove();j.submit_row.remove()})},
error:function(f){i.ajax_error_handler(f,d)}})},init_property_form:function(b){var e=a("input[name=name]",b.row),d=a("input[name=key]",b.row),f=a("input[name=expected_type_input]",b.row),g=a("input[name=expected_type]",b.row),h=a("input[name=expected_type_new]",b.row),j=a("input[name=unit]",b.row),o=a("textarea[name=description]",b.row),m=a("input[name=disambiguator]",b.row),r=a("input[name=unique]",b.row),q=a("input[name=hidden]",b.row);if(b.mode==="add"){a(".nav-toggle:first",b.row).click();e.val("");
d.val("").data("changed",false);f.val("");g.val("");h.val("");j.val("");o.val("");a.each([m,r,q],function(k,n){n.is(":disabled")||n.removeAttr("checked")})}else d.data("changed",true);if(!b.row.data("initialized")){d.change(function(){a(this).data("changed",true)});e.change(function(){if(!d.data("changed")){var k=a.trim(e.val()).toLowerCase().replace(/\s+/g,"-");d.val(k)}});f.suggest_expected_type({service_url:acre.freebase.service_url,suggest_new:"Create new type"}).bind("fb-select",function(k,n){if(n.unit){f.val(n.id+
" ("+n.unit.name+")");g.val(n.id);h.val("");j.val(n.unit.id)}else{f.val(n.id);g.val(n.id);h.val("");j.val("");n.id==="/type/boolean"&&a("input[name=unique]",b.row).attr("checked","checked")}}).bind("fb-textchange",function(){g.val("");h.val("");j.val("")}).bind("fb-select-new",function(k,n){h.val(a.trim(n));g.val("");j.val("")});a(":input:not(textarea)",b.row).keypress(function(k){if(k.keyCode===13&&!k.isDefaultPrevented()){console.log("enter");b.row.trigger(b.event_prefix+"submit")}}).keyup(function(k){k.keyCode===
27&&b.row.trigger(b.event_prefix+"cancel")});b.row.data("initialized",true)}e.focus()},submit_property_form:function(b){var e=a.trim(a(":input[name=name]",b.row).val()),d=a.trim(a(":input[name=key]",b.row).val()).toLowerCase(),f=a(":input[name=expected_type]",b.row).val(),g=a(":input[name=expected_type_new]",b.row).val(),h=a(":input[name=unit]",b.row).val(),j=a(":input[name=description]",b.row).val(),o=a(":input[name=disambiguator]",b.row).is(":checked")?1:0,m=a(":input[name=unique]",b.row).is(":checked")?
1:0,r=a(":input[name=hidden]",b.row).is(":checked")?1:0;e={type:a(":input[name=type]",b.row).val(),name:e,key:d,expected_type:f,expected_type_new:g,unit:h,description:j,disambiguator:o,unique:m,hidden:r};if(b.mode==="add")if(a(".nav-delegate",b.row).is(".current"))e.delegated=a(":input[name=delegated]",b.row).val();e={url:b.ajax.url,type:"POST",dataType:"json",data:a.extend(e,b.ajax.data)};e.success=b.ajax.success||function(q,k,n){if(q.code==="/api/status/error")return i.ajax_error_handler(n,b.row);
var p=a(q.result.html).addClass("new-row");b.row.before(p);p.hide();p.showRow(function(){l.schema.init_row_menu(p);a(".edit",p).show()},null,"slow");b.row.trigger(b.event_prefix+"success")};e.error=b.ajax.error||function(q){i.ajax_error_handler(q,b.row)};a.ajax(e)},validate_property_form:function(b){var e=a.trim(a(":input[name=name]",b.row).val()),d=a.trim(a(":input[name=key]",b.row).val()),f=a(":input[name=expected_type]",b.row).val(),g=a(":input[name=expected_type_new]",b.row).val();if(e===""||
d===""||f===""&&g==="")b.row.trigger(b.event_prefix+"error",[b.row,"Name, Key and Expected Type are required"])},delete_property_begin:function(b,e){var d=b.parents("tr:first");d.parents("table:first");a.ajax({url:acre.request.app_url+"/schema/type/delete_property_submit",data:{id:e,user:l.user.id},type:"POST",dataType:"json",success:function(f,g,h){if(f.code==="/api/status/error")return i.ajax_error_handler(h,d);f=a(f.result.html).addClass("new-row");d.before(f);f.hide();d.remove();f.showRow()},
error:function(f){i.ajax_error_handler(f,d)}})},undo_delete_property_begin:function(b,e){var d=b.parents("tr:first");d.parents("table:first");a.ajax({url:acre.request.app_url+"/schema/type/undo_delete_property_submit",data:{prop_info:JSON.stringify(e)},type:"POST",dataType:"json",success:function(f,g,h){if(f.code==="/api/status/error")return i.ajax_error_handler(h,d);var j=a(f.result.html).addClass("new-row");d.before(j);j.hide();d.remove();j.showRow(function(){l.schema.init_row_menu(j);a(".edit",
j).show()},null,"slow")},error:function(f){i.ajax_error_handler(f,d)}})},add_included_type_begin:function(b,e){var d=b.parents("tr:first");a.ajax({url:acre.request.app_url+"/schema/type/add_included_type_begin",data:{id:e},dataType:"json",success:function(f,g,h){if(f.code==="/api/status/error")return i.ajax_error_handler(h,d);f=a(f.result.html);var j={mode:"edit",event_prefix:"fb.schema.type.add.included_type.",ajax:{url:acre.request.app_url+"/schema/type/add_included_type_submit"},init_form:c.init_included_type_form,
validate_form:c.validate_included_type_form,submit_form:c.submit_included_type_form,table:b.parents("table:first"),trigger:b,trigger_row:d,row:a(".edit-row",f).hide(),submit_row:a(".edit-row-submit",f).hide()};i.init_edit_form(j);j.row.bind("fb.schema.type.add.included_type.success",function(){a(".button-cancel",j.submit_row).text("Done");c.init_included_type_form(j)})},error:function(f){i.ajax_error_handler(f,d)}})},init_included_type_form:function(b){var e=a("input[name=included_type_input]",b.row).val(""),
d=a("input[name=included_type]",b.row).val("");if(!b.row.data("initialized")){e.suggest({service_url:acre.freebase.service_url,category:"cotype",suggest_new:"Create new type"}).bind("fb-select",function(f,g){e.val(g.id);d.val(g.id)}).bind("fb-textchange",function(){d.val("")});a(":input:not(textarea)",b.row).keypress(function(f){f.keyCode===13&&!f.isDefaultPrevented()&&b.row.trigger(b.event_prefix+"submit")}).keyup(function(f){f.keyCode===27&&b.row.trigger(b.event_prefix+"cancel")});b.row.data("initialized",
true)}e.focus()},validate_included_type_form:function(b){a.trim(a(":input[name=included_type]",b.row).val())===""&&b.row.trigger(b.event_prefix+"error",[b.row,"Please choose a type to include"])},submit_included_type_form:function(b){var e={id:a(":input[name=id]",b.row).val(),included_type:a.trim(a(":input[name=included_type]",b.row).val())};a.ajax({url:b.ajax.url,type:"POST",dataType:"json",data:a.extend(e,b.ajax.data),success:function(d,f,g){if(d.code==="/api/status/error")return i.ajax_error_handler(g,
b.row);f=a("<table>");f.html(d.result.html);var h=a(">thead",f);b.table.append(h);a("tr:first",h).hide().showRow(function(){a(".tbody-header",h).each(function(){a(this).data("ajax",true).click(l.schema.type.toggle);a(".edit",this).show()});b.row.trigger(b.event_prefix+"success")},null,"slow")},error:function(d){i.ajax_error_handler(d,b.row)}})},delete_included_type_begin:function(b,e,d){var f=b.parents("tr:first");f.parents("table:first");a.ajax({url:acre.request.app_url+"/schema/type/delete_included_type_submit",
data:{id:e,included_type:d},type:"POST",dataType:"json",success:function(g,h,j){if(g.code==="/api/status/error")return i.ajax_error_handler(j,f);g=a(g.result.html).addClass("new-row");f.before(g);g.hide();f.parent("thead").next("tbody:first").remove();f.remove();g.showRow()},error:function(g){i.ajax_error_handler(g,f)}})},undo_delete_included_type_begin:function(b,e,d){var f=b.parents("tr:first");f.parents("table:first");a.ajax({url:acre.request.app_url+"/schema/type/undo_delete_included_type_submit",
data:{id:e,included_type:d},type:"POST",dataType:"json",success:function(g,h,j){if(g.code==="/api/status/error")return i.ajax_error_handler(j,f);g=a(g.result.html);var o=a(">tr",g).addClass("new-row");h=f.parents("thead:first");h.before(g);o.hide();h.remove();o.showRow(function(){a(".tbody-header",o).each(function(){a(this).data("ajax",true).click(l.schema.type.toggle);a(".edit",this).show()})},null,"slow")},error:function(g){i.ajax_error_handler(g,f)}})},reverse_property_begin:function(b,e,d){var f=
b.parents("tr:first");a.ajax({url:acre.request.app_url+"/schema/type/reverse_property_begin",data:{id:e,master:d},dataType:"json",success:function(g,h,j){if(g.code==="/api/status/error")return i.ajax_error_handler(j,f);g=a(g.result.html);var o={mode:"edit",event_prefix:"fb.schema.type.reverse.property.",ajax:{url:acre.request.app_url+"/schema/type/add_property_submit",data:{master_property:d},success:function(m,r,q){if(m.code==="/api/status/error")return i.ajax_error_handler(q,o.row);c.reverse_property_success(o,
m)}},init_form:c.init_property_form,validate_form:c.validate_property_form,submit_form:c.submit_property_form,table:b.parents("table:first"),trigger:b,trigger_row:f,row:a(".edit-row",g).hide(),submit_row:a(".edit-row-submit",g).hide()};i.init_edit_form(o)},error:function(g){i.ajax_error_handler(g,f)}})},reverse_property_success:function(b,e){var d=a(e.result.html).addClass("new-row"),f=a("#type-table table:first > tbody");f.append(d);d.hide();d.showRow(function(){l.schema.init_row_menu(d);l.schema.type.init_tooltips(d);
a(".edit",d).show()},null,"slow");f=a(".table-empty-column",f);f.length&&f.parents("tr:first").hide().prev("tr").show();b.trigger_row.remove();b.row.remove();b.submit_row.remove()}}})(jQuery,window.freebase);
