/*
 
 jQuery Tools @VERSION / Expose - Dim the lights

 NO COPYRIGHTS OR LICENSES. DO WHAT YOU LIKE.

 http://flowplayer.org/tools/toolbox/expose.html

 Since: Mar 2010
 Date: @DATE 
 
 jQuery Tools @VERSION Overlay - Overlay base. Extend it.

 NO COPYRIGHTS OR LICENSES. DO WHAT YOU LIKE.

 http://flowplayer.org/tools/overlay/

 Since: March 2008
 Date: @DATE 
*/
(function(a){function m(){if(a.browser.msie){var h=a(document).height(),j=a(window).height();return[window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,h-j<20?j:h]}return[a(document).width(),a(document).height()]}function i(h){if(h)return h.call(a.mask)}a.tools=a.tools||{version:"@VERSION"};var d;d=a.tools.expose={conf:{maskId:"exposeMask",loadSpeed:"slow",closeSpeed:"fast",closeOnClick:true,closeOnEsc:true,zIndex:9998,opacity:0.8,startOpacity:0,color:"#fff",onLoad:null,
onClose:null}};var b,e,c,f,g;a.mask={load:function(h,j){if(c)return this;if(typeof h=="string")h={color:h};h=h||f;f=h=a.extend(a.extend({},d.conf),h);b=a("#"+h.maskId);if(!b.length){b=a("<div/>").attr("id",h.maskId);a("body").append(b)}var l=m();b.css({position:"absolute",top:0,left:0,width:l[0],height:l[1],display:"none",opacity:h.startOpacity,zIndex:h.zIndex});h.color&&b.css("backgroundColor",h.color);if(i(h.onBeforeLoad)===false)return this;h.closeOnEsc&&a(document).bind("keydown.mask",function(n){n.keyCode==
27&&a.mask.close(n)});h.closeOnClick&&b.bind("click.mask",function(n){a.mask.close(n)});a(window).bind("resize.mask",function(){a.mask.fit()});if(j&&j.length){g=j.eq(0).css("zIndex");a.each(j,function(){var n=a(this);/relative|absolute|fixed/i.test(n.css("position"))||n.css("position","relative")});e=j.css({zIndex:Math.max(h.zIndex+1,g=="auto"?0:g)})}b.css({display:"block"}).fadeTo(h.loadSpeed,h.opacity,function(){a.mask.fit();i(h.onLoad)});c=true;return this},close:function(){if(c){if(i(f.onBeforeClose)===
false)return this;b.fadeOut(f.closeSpeed,function(){i(f.onClose);e&&e.css({zIndex:g})});a(document).unbind("keydown.mask");b.unbind("click.mask");a(window).unbind("resize.mask");c=false}return this},fit:function(){if(c){var h=m();b.css({width:h[0],height:h[1]})}},getMask:function(){return b},isLoaded:function(){return c},getConf:function(){return f},getExposed:function(){return e}};a.fn.mask=function(h){a.mask.load(h);return this};a.fn.expose=function(h){a.mask.load(h,this);return this}})(jQuery);
(function(a){function m(b,e){var c=this,f=b.add(c),g=a(window),h,j,l,n=a.tools.expose&&(e.mask||e.expose),r=Math.random().toString().slice(10);if(n){if(typeof n=="string")n={color:n};n.closeOnClick=n.closeOnEsc=false}var q=e.target||b.attr("rel");j=q?a(q):b;if(!j.length)throw"Could not find Overlay: "+q;b&&b.index(j)==-1&&b.click(function(k){c.load(k);return k.preventDefault()});a.extend(c,{load:function(k){if(c.isOpened())return c;var o=d[e.effect];if(!o)throw'Overlay: cannot find effect : "'+e.effect+
'"';e.oneInstance&&a.each(i,function(){this.close(k)});k=k||a.Event();k.type="onBeforeLoad";f.trigger(k);if(k.isDefaultPrevented())return c;l=true;n&&a(j).expose(n);var p=e.top,t=e.left,u=j.outerWidth({margin:true}),v=j.outerHeight({margin:true});if(typeof p=="string")p=p=="center"?Math.max((g.height()-v)/2,0):parseInt(p,10)/100*g.height();if(t=="center")t=Math.max((g.width()-u)/2,0);o[0].call(c,{top:p,left:t},function(){if(l){k.type="onLoad";f.trigger(k)}});n&&e.closeOnClick&&a.mask.getMask().one("click",
c.close);e.closeOnClick&&a(document).bind("click."+r,function(s){a(s.target).parents(j).length||c.close(s)});e.closeOnEsc&&a(document).bind("keydown."+r,function(s){s.keyCode==27&&c.close(s)});return c},close:function(k){if(!c.isOpened())return c;k=k||a.Event();k.type="onBeforeClose";f.trigger(k);if(!k.isDefaultPrevented()){l=false;d[e.effect][1].call(c,function(){k.type="onClose";f.trigger(k)});a(document).unbind("click."+r).unbind("keydown."+r);n&&a.mask.close();return c}},getOverlay:function(){return j},
getTrigger:function(){return b},getClosers:function(){return h},isOpened:function(){return l},getConf:function(){return e}});a.each("onBeforeLoad,onStart,onLoad,onBeforeClose,onClose".split(","),function(k,o){a.isFunction(e[o])&&a(c).bind(o,e[o]);c[o]=function(p){a(c).bind(o,p);return c}});h=j.find(e.close||".close");if(!h.length&&!e.close){h=a('<a class="close"></a>');j.prepend(h)}h.click(function(k){c.close(k)});e.load&&c.load()}a.tools=a.tools||{version:"@VERSION"};a.tools.overlay={addEffect:function(b,
e,c){d[b]=[e,c]},conf:{close:null,closeOnClick:true,closeOnEsc:true,closeSpeed:"fast",effect:"default",fixed:!a.browser.msie||a.browser.version>6,left:"center",load:false,mask:null,oneInstance:true,speed:"normal",target:null,top:"10%"}};var i=[],d={};a.tools.overlay.addEffect("default",function(b,e){var c=this.getConf(),f=a(window);if(!c.fixed){b.top+=f.scrollTop();b.left+=f.scrollLeft()}b.position=c.fixed?"fixed":"absolute";this.getOverlay().css(b).fadeIn(c.speed,e)},function(b){this.getOverlay().fadeOut(this.getConf().closeSpeed,
b)});a.fn.overlay=function(b){var e=this.data("overlay");if(e)return e;if(a.isFunction(b))b={onBeforeLoad:b};b=a.extend(true,{},a.tools.overlay.conf,b);this.each(function(){e=new m(a(this),b);i.push(e);a(this).data("overlay",e)});return b.api?e:this}})(jQuery);
(function(a,m){var i=m.schema.edit={init_edit_form:function(d){if(d.mode==="add")a("tbody",d.table).append(d.row);else if(d.mode==="edit")d.trigger_row.before(d.row);else throw"Unknown edit type mode: "+d.mode;d.trigger_row.before(d.submit_row);var b=d.event_prefix||"fb.schema.edit.";d.row.bind(b+"submit",function(){console.log(b+"submit");i.submit_edit_form(d)}).bind(b+"cancel",function(){console.log(b+"cancel");i.cancel_edit_form(d)}).bind(b+"error",function(e,c,f){console.log(b+"error",c,f);i.row_error(c,
f)}).bind(b+"success",function(){console.log(b+"success");d.row.removeClass("loading")});a(".button-submit",d.submit_row).click(function(){d.row.trigger(b+"submit")});a(".button-cancel",d.submit_row).click(function(){d.row.trigger(b+"cancel")});typeof d.init_form==="function"&&d.init_form(d);d.row.showRow(function(){a(":text:first",d.row).focus()});d.trigger_row.hide();d.submit_row.show()},cancel_edit_form:function(d){d.row.hideRow(function(){a(this).remove()});i.clear_row_message(d.row);d.submit_row.remove();
d.trigger_row.show();d.trigger.removeClass("editing")},submit_edit_form:function(d){if(!d.row.is(".loading")){document.activeElement&&a(document.activeElement).blur();i.clear_row_message(d.row);typeof d.validate_form==="function"&&d.validate_form(d);if(!i.has_row_message(d.row,"error")){d.row.addClass("loading");typeof d.submit_form==="function"&&d.submit_form(d)}}},ajax_error_handler:function(d,b,e){var c;try{c=JSON.parse(d.responseText);c=c.messages[0].message}catch(f){c=d.responseText}if(b)i.row_error(b,
c);else e&&i.form_error(e,c)},row_error:function(d,b){return i.row_message(d,b,"error")},row_message:function(d,b,e){var c=a('<a class="close-msg" href="#">Close</a>').click(function(f){return m.schema.close_message.apply(this,[f,".row-msg:first"])});b=a("<span>").text(b);c=a('<td colspan="5">').append(c).append(b);c=a('<tr class="row-msg">').append(c);e&&c.addClass("row-msg-"+e);d.before(c);c.hide().showRow();b=d.data("row-msg");if(!b){b={};d.data("row-msg",b)}if(b[e])b[e].push(c);else b[e]=[c];
return c},clear_row_message:function(d){var b=d.data("row-msg");if(b){a.each(b,function(e,c){a.each(c,function(f,g){g.remove()})});d.removeData("row-msg")}},has_row_message:function(d,b){var e=d.data("row-msg");if(b)return e&&e[b]&&e[b].length;return e!=null},init_settings_form:function(d){a(document.body).append(d.form.hide());var b=d.event_prefix||"fb.schema.edit.settings.";d.form.bind(b+"submit",function(){console.log(b+"submit");i.submit_settings_form(d)}).bind(b+"error",function(e,c){console.log(b+
"error",c);i.form_error(d.form,c)}).bind(b+"success",function(){console.log(b+"success");d.form.removeClass("loading")});a(".button-submit",d.form).click(function(){d.form.trigger(b+"submit")});typeof d.init_form==="function"&&d.init_form(d);d.form.overlay({close:".button-cancel",closeOnClick:false,load:true,mask:{color:"#000",loadSpeed:200,opacity:0.5}})},submit_settings_form:function(d){if(!d.form.is(".loading")){document.activeElement&&a(document.activeElement).blur();i.clear_form_message(d.form);
typeof d.validate_form==="function"&&d.validate_form(d);if(!i.has_form_message(d.form,"error")){d.form.addClass("loading");typeof d.submit_form==="function"&&d.submit_form(d)}}},form_error:function(d,b){return i.form_message(d,b,"error")},form_message:function(d,b,e){b=a("<div class='form-msg'>").text(b).hide();a(".form-group",d).prepend(b);b.slideDown();var c=d.data("form-msg");if(!c){c={};d.data("form-msg",c)}if(c[e])c[e].push(b);else c[e]=[b];return b},clear_form_message:function(d){var b=d.data("form-msg");
if(b){a.each(b,function(e,c){a.each(c,function(f,g){g.remove()})});d.removeData("form-msg")}},has_form_message:function(d,b){var e=d.data("form-msg");if(b)return e&&e[b]&&e[b].length;return e!=null}}})(jQuery,window.freebase);
(function(a){a.suggest||alert("$.suggest required");var m={_init:a.suggest.suggest.prototype._init,status_start:a.suggest.suggest.prototype.status_start,status_loading:a.suggest.suggest.prototype.status_loading,status_select:a.suggest.suggest.prototype.status_select,create_item:a.suggest.suggest.prototype.create_item,focus:a.suggest.suggest.prototype.focus};a.fn.placeholder=a.noop;a.suggest("suggest_expected_type",a.extend(true,{},a.suggest.suggest.prototype,{_init:function(){var d=this;m._init.call(d);
this.ect_pane=a('<div class="ect-pane fbs-reset">');this.ect_menu=a('<div class="ect-menu-dialog"><span class="ect-menu-title">or choose from the data types below</span></div>');this.ect_list=a('<ul class="ect-menu clear">');a.each(["text","numeric","date","boolean","image","weblink","address"],function(b,e){d.ect_list.append(d["create_ect_"+e].call(d))});this.ect_unit=a('<div class="ect-unit-dialog"><h2 class="ect-unit-dialog-title">Select measurement type</h2><div class="ect-unit-field"><label for="dimension">The kind of thing to measure</label><select name="dimension"></select></div><div class="ect-unit-field"><label for="dimension-unit">The unit to measure it in</label><select name="dimension-unit"></select></div><div class="ect-unit-submit"><button class="button button-primary button-submit">OK</button><button class="button button-cancel">Cancel</button></div></div>').hide();
this.ect_dimension=a("select:first",this.ect_unit);this.ect_dimension_units=a("select:eq(1)",this.ect_unit);this.ect_dimension.change(function(){var b=a("[selected]",this).data("units");if(d.ect_dimension_units.data("units")!==b){d.ect_dimension_units.empty();a.each(b,function(e,c){var f=c.name;if(c["/freebase/unit_profile/abbreviation"])f+=" ("+c["/freebase/unit_profile/abbreviation"]+")";f=a("<option>").text(f).attr("value",c.id).data("data",c);d.ect_dimension_units.append(f);c.id==="/en/meter"&&
f.attr("selected","selected")})}});a(".button-cancel",this.ect_unit).click(function(b){d.ect_menu.show();d.ect_unit.hide();d.status.show();d.input.focus().removeData("dont_hide");b.stopPropagation()});a(".button-submit",this.ect_unit).click(function(b){var e={name:"Measurment",id:"/type/float",unit:a("[selected]",d.ect_dimension_units).data("data")};d.input.val(e.name).data("data.suggest",e).trigger("fb-select",e);d.input.focus().removeData("dont_hide");d.ect_menu.show();d.ect_unit.hide();d.hide_all();
b.stopPropagation()});this.ect_pane.append(this.ect_menu);this.ect_pane.append(this.ect_unit);this.ect_menu.append(this.ect_list);this.ect_pane.bind("ect",function(b,e){a(".trigger",this).each(function(){var c=a(this).data("tooltip");c&&c.hide()});if(e.id==="/type/float"&&e.name==="Measurement"){d.ect_menu.hide();d.ect_unit.show();d.status.hide()}else{d.input.val(e.name).data("data.suggest",e).trigger("fb-select",e);d.hide_all()}}).bind("mouseup",function(b){b.stopPropagation()});this.pane.append(this.ect_pane);
a.suggest.suggest_expected_type.load_dimensions()},status_start:function(){m.status_start.apply(this);this.ect_pane.show();this.ect_unit.is(":visible")&&this.status.hide()},status_loading:function(){m.status_loading.apply(this);this.ect_pane.hide()},status_select:function(){m.status_select.apply(this);this.ect_pane.hide()},create_ect_text:function(){var d=this.create_ect_item("Text");a("> a",d).after(this.create_ect_tooltip([{name:"Short Text Input",id:"/type/text"},{name:"Machine readable string",
id:"/type/rawstring"}])).tooltip(this.options.tooltip_options);return d},create_ect_numeric:function(){var d=this.create_ect_item("Numeric");a("> a",d).after(this.create_ect_tooltip([{name:"Integer",id:"/type/int"},{name:"Decimal point number",id:"/type/float"},{name:"Measurement",id:"/type/float"},{name:"Dated Currency",id:"/measurement_unit/dated_money_value"},{name:"Dated Integer",id:"/measurement_unit/dated_integer"},{name:"Dated Decimal Point Number",id:"/measurement_unit/dated_float"},{name:"Integer Range",
id:"/measurement_unit/integer_range"},{name:"Decimal Point Number Range",id:"/measurement_unit/floating_point_range"}])).tooltip(this.options.tooltip_options);return d},create_ect_date:function(){var d=this.create_ect_item("Date/Time","date");a("> a",d).after(this.create_ect_tooltip([{name:"Date/Time",id:"/type/datetime"},{name:"Day of Week",id:"/time/day_of_week"},{name:"Date of Year",id:"/time/day_of_year"},{name:"Time interval",id:"/measurement_unit/time_interval"}])).tooltip(this.options.tooltip_options);
return d},create_ect_boolean:function(){var d=this.create_ect_item("Boolean");a("> a",d).data("ect",{name:"Boolean",id:"/type/boolean"}).click(function(){a(this).trigger("ect",a(this).data("ect"))});return d},create_ect_image:function(){var d=this.create_ect_item("Image");a("> a",d).data("ect",{name:"Image",id:"/common/image"}).click(function(){a(this).trigger("ect",a(this).data("ect"))});return d},create_ect_weblink:function(){var d=this.create_ect_item("Weblink");a("> a",d).data("ect",{name:"Weblink",
id:"/common/webpage"}).click(function(){a(this).trigger("ect",a(this).data("ect"))});return d},create_ect_address:function(){var d=this.create_ect_item("Address");a("> a",d).data("ect",{name:"Address",id:"/location/mailing_address"}).click(function(){a(this).trigger("ect",a(this).data("ect"))});return d},create_ect_item:function(d,b){b||(b=d.toLowerCase());var e=a('<li class="ect-menu-item">'),c=a('<a href="javascript:void(0);" class="ect-icon trigger">');c.addClass("ect-"+b);e.append(c);e.append(document.createTextNode(d));
return e},create_ect_tooltip:function(d){var b=a('<ul class="row-menu tooltip">');a.each(d,function(e,c){var f=a('<li class="row-menu-item">'),g=a('<a href="javascript:void(0);">').attr("title",c.id).data("ect",c).click(function(){a(this).trigger("ect",a(this).data("ect"))});g.text(c.name);f.append(g);b.append(f)});return b},create_item:function(d,b){var e=m.create_item.apply(this,[d,b]),c=d.id.split("/");c.pop();c=c.join("/");a("."+this.options.css.item_type,e).text(c);return e},focus:function(d){m.focus.apply(this,
[d]);this.input.removeData("dont_hide")}}));var i=a.suggest.suggest_expected_type;a.extend(i,{defaults:a.extend(true,{},a.suggest.suggest.defaults,{category:"expected_type",tooltip_options:{events:{def:"click,mouseout"},position:"bottom right",offset:[-10,-10],effect:"fade",delay:300,relative:true}}),set_dimensions:function(d){a(".ect-pane select[name=dimension]").each(function(){var b=a(this);if(b.data("dimensions")!==d){var e;a.each(d,function(c,f){var g=a("<option>").text(f.name).attr("value",
f.id).data("units",f.units);b.append(g);if(f.id==="/en/length")e=g});b.data("dimensions",d);if(e){e.attr("selected","selected");b.change()}}})},load_dimensions:function(){function d(e){return e<10?"0"+e:e}if(i.dimensions)i.set_dimensions(i.dimensions);else if(!i.load_dimensions.lock){i.load_dimensions.lock=true;var b=new Date;b=[b.getFullYear(),d(b.getMonth()+1),d(b.getDate())].join("-");a.ajax({url:"http://api.freebase.com/api/service/mqlread",data:{query:JSON.stringify({query:[{id:null,name:null,
type:"/measurement_unit/dimension",units:[{id:null,name:null,type:"/type/unit","/freebase/unit_profile/abbreviation":null}]}],as_of_time:b})},dataType:"jsonp",jsonpCallback:"jQuery.suggest.suggest_expected_type.jsonpCallback"})}},jsonpCallback:function(d){if(d.code==="/api/status/ok"){i.dimensions=d.result.sort(i.sort_by_name);a.each(i.dimensions,function(b,e){e.units.sort(i.sort_by_name)});i.set_dimensions(i.dimensions)}},sort_by_name:function(d,b){return b.name<d.name}})})(jQuery);
(function(a){a.suggest||alert("$.suggest required");var m={create_item:a.suggest.suggest.prototype.create_item};a.fn.placeholder=a.noop;a.suggest("suggest_property",a.extend(true,{},a.suggest.suggest.prototype,{create_item:function(i,d){var b=m.create_item.apply(this,[i,d]),e=i.id.split("/");e.pop();e=e.join("/");a("."+this.options.css.item_type,b).text(e);return b}}));a.extend(a.suggest.suggest_property,{defaults:a.extend(true,{},a.suggest.suggest.defaults,{type:"/type/property",type_strict:"any"})})})(jQuery);
(function(a,m){var i=m.schema.edit,d=m.schema.type.edit={type_settings_begin:function(b,e){a.ajax({url:acre.request.app_url+"/schema/type/type_settings_begin",data:{id:e},dataType:"json",success:function(c){c=a(c.result.html);c={event_prefix:"fb.schema.type.settings.",ajax:{url:acre.request.app_url+"/schema/type/type_settings_submit",data:{id:e}},init_form:d.init_type_settings_form,validate_form:d.validate_type_settings_form,submit_form:d.submit_type_settings_form,form:c};i.init_settings_form(c);
c.form.bind(c.event_prefix+"success",function(f,g){window.location=g.location})}})},init_type_settings_form:function(b){a(":input:not(textarea)",b.form).keypress(function(e){e.keyCode===13&&!e.isDefaultPrevented()&&b.form.trigger(b.event_prefix+"submit")})},validate_type_settings_form:function(b){var e=a.trim(a("input[name=name]",b.form).val()),c=a.trim(a("input[name=key]",b.form).val()).toLowerCase();if(e===""||c==="")b.form.trigger(b.event_prefix+"error","Name and Key are required");else/^[a-z][a-z0-9_\-]{3,}$/.test(c)||
b.form.trigger(b.event_prefix+"error","Key must be four or more alphanumeric characters, no spaces and not begin with a number")},submit_type_settings_form:function(b){var e=a.trim(a(":input[name=name]",b.row).val()),c=a.trim(a("input[name=key]",b.form).val()).toLowerCase(),f=a(":input[name=role]",b.row);f=f.is(":checked")?f.val():"";e={name:e,key:c,domain:a("input[name=namespace]",b.form).val(),description:a("textarea[name=description]",b.form).val(),role:f};a.ajax({url:b.ajax.url,type:"POST",dataType:"json",
data:a.extend(e,b.ajax.data),success:function(g,h,j){if(g.code==="/api/status/error")return i.ajax_error_handler(j,null,b.form);b.form.trigger(b.event_prefix+"success",g.result)},error:function(g){i.ajax_error_handler(g,null,b.form)}})},init_delegate_property:function(b){a(".nav-toggle",b.row).click(function(){d.toggle_delegate_property(a(this),b);return false})},toggle_delegate_property:function(b,e){if(b.is(".current"))return false;var c=b.parents(".nav:first");a(".nav-toggle",c).removeClass("current");
b.addClass("current");var f=a(".fb-property-expected-type",e.row);a("input",f).val("");f=a("input[name=unique]",e.row).removeAttr("checked");a(".form-msg",e.row).remove();if(b.is(".nav-delegate")){a(".nav-delegate-msg",c).show();a("input[name=expected_type_input]",e.row).hide().prev(".form-label").text("Property to use");c=a("input[name=delegated]",e.row).show();a("label[for=master]",e.row).find("span").text("Delegated");f.attr("disabled","disabled");c.data("suggest_property")||c.unbind().suggest_property({service_url:acre.freebase.service_url}).bind("fb-select",
function(g,h){a(this).val(h.id);setTimeout(function(){d.delegate_property_begin(e,h.id)},0)}).keypress(function(g){g.keyCode===13&&!g.isDefaultPrevented()&&e.row.trigger(e.event_prefix+"submit")}).keyup(function(g){g.keyCode===27&&e.row.trigger(e.event_prefix+"cancel")})}else{a(".nav-delegate-msg",c).hide();a("input[name=delegated]",e.row).hide();a("input[name=expected_type_input]",e.row).show().prev(".form-label").text("Expected Type");a("label[for=master]",e.row).find("span").text("Master");f.removeAttr("disabled")}a("input[name=name]",
e.row).focus()},delegate_property_begin:function(b,e){b.row.addClass("loading");a.ajax({url:acre.request.app_url+"/schema/type/delegate_property_begin",data:{id:e},dataType:"json",success:function(c,f,g){if(c.code==="/api/status/error")return i.ajax_error_handler(g,b.row);c=c.result;f={id:c.expected_type,unit:c.unit};a("input[name=expected_type_input]",b.row).trigger("fb-select",f);c.unique&&a("input[name=unique]",b.row).attr("checked","checked");a(".form-msg",b.row).remove();f=a(".form-field:first",
b.row);c=a(c.message);f.before(c)},error:function(c){i.ajax_error_handler(c,b.row)},complete:function(){b.row.removeClass("loading")}})},add_property_begin:function(b,e){var c=b.parents("tr:first");a.ajax({url:acre.request.app_url+"/schema/type/add_property_begin",data:{id:e},dataType:"json",success:function(f,g,h){if(f.code==="/api/status/error")return i.ajax_error_handler(h,c);f=a(f.result.html);var j={mode:"add",event_prefix:"fb.schema.type.add.property.",ajax:{url:acre.request.app_url+"/schema/type/add_property_submit"},
init_form:d.init_property_form,validate_form:d.validate_property_form,submit_form:d.submit_property_form,table:b.parents("table:first"),trigger:b,trigger_row:c,row:a(".edit-row",f).hide(),submit_row:a(".edit-row-submit",f).hide()};i.init_edit_form(j);a.trim(a(".page-meta .flags").text())==="Compound Value Type"?a(".nav",j.row).hide():d.init_delegate_property(j);j.row.bind("fb.schema.type.add.property.success",function(){var l=a("tbody:first .table-empty-column",j.table);l.length&&l.parents("tr:first").hide().prev("tr").show();
a(".button-cancel",j.submit_row).text("Done");d.init_property_form(j)})},error:function(f){i.ajax_error_handler(f,c)}})},edit_property_begin:function(b,e){var c=b.parents("tr:first");a.ajax({url:acre.request.app_url+"/schema/type/edit_property_begin",data:{id:e},dataType:"json",success:function(f,g,h){if(f.code==="/api/status/error")return i.ajax_error_handler(h,c);f=a(f.result.html);var j={mode:"edit",event_prefix:"fb.schema.type.edit.property.",ajax:{url:acre.request.app_url+"/schema/type/edit_property_submit",
data:{id:e}},init_form:d.init_property_form,validate_form:d.validate_property_form,submit_form:d.submit_property_form,table:b.parents("table:first"),trigger:b,trigger_row:c,row:a(".edit-row",f).hide(),submit_row:a(".edit-row-submit",f).hide()};i.init_edit_form(j);j.row.bind("fb.schema.type.edit.property.success",function(){j.trigger_row.remove();j.row.remove();j.submit_row.remove()})},error:function(f){i.ajax_error_handler(f,c)}})},init_property_form:function(b){var e=a("input[name=name]",b.row),
c=a("input[name=key]",b.row),f=a("input[name=expected_type_input]",b.row),g=a("input[name=expected_type]",b.row),h=a("input[name=expected_type_new]",b.row),j=a("input[name=unit]",b.row),l=a("textarea[name=description]",b.row),n=a("input[name=disambiguator]",b.row),r=a("input[name=unique]",b.row),q=a("input[name=hidden]",b.row);if(b.mode==="add"){a(".nav-toggle:first",b.row).click();e.val("");c.val("").data("changed",false);f.val("");g.val("");h.val("");j.val("");l.val("");a.each([n,r,q],function(k,
o){o.is(":disabled")||o.removeAttr("checked")})}else c.data("changed",true);if(!b.row.data("initialized")){c.change(function(){a(this).data("changed",true)});e.change(function(){if(!c.data("changed")){var k=a.trim(e.val()).toLowerCase().replace(/\s+/g,"-");c.val(k)}});f.suggest_expected_type({service_url:acre.freebase.service_url,suggest_new:"Create new type"}).bind("fb-select",function(k,o){if(o.unit){f.val(o.id+" ("+o.unit.name+")");g.val(o.id);h.val("");j.val(o.unit.id)}else{f.val(o.id);g.val(o.id);
h.val("");j.val("");o.id==="/type/boolean"&&a("input[name=unique]",b.row).attr("checked","checked")}}).bind("fb-textchange",function(){g.val("");h.val("");j.val("")}).bind("fb-select-new",function(k,o){h.val(a.trim(o));g.val("");j.val("")});a(":input:not(textarea)",b.row).keypress(function(k){k.keyCode===13&&!k.isDefaultPrevented()&&b.row.trigger(b.event_prefix+"submit")}).keyup(function(k){k.keyCode===27&&b.row.trigger(b.event_prefix+"cancel")});b.row.data("initialized",true)}e.focus()},submit_property_form:function(b){var e=
a.trim(a(":input[name=name]",b.row).val()),c=a.trim(a(":input[name=key]",b.row).val()).toLowerCase(),f=a(":input[name=expected_type]",b.row).val(),g=a(":input[name=expected_type_new]",b.row).val(),h=a(":input[name=unit]",b.row).val(),j=a(":input[name=description]",b.row).val(),l=a(":input[name=disambiguator]",b.row).is(":checked")?1:0,n=a(":input[name=unique]",b.row).is(":checked")?1:0,r=a(":input[name=hidden]",b.row).is(":checked")?1:0;e={type:a(":input[name=type]",b.row).val(),name:e,key:c,expected_type:f,
expected_type_new:g,unit:h,description:j,disambiguator:l,unique:n,hidden:r};if(b.mode==="add")if(a(".nav-delegate",b.row).is(".current"))e.delegated=a(":input[name=delegated]",b.row).val();e={url:b.ajax.url,type:"POST",dataType:"json",data:a.extend(e,b.ajax.data)};e.success=b.ajax.success||function(q,k,o){if(q.code==="/api/status/error")return i.ajax_error_handler(o,b.row);var p=a(q.result.html).addClass("new-row");b.row.before(p);p.hide();p.showRow(function(){m.schema.init_row_menu(p);a(".edit",
p).show()},null,"slow");b.row.trigger(b.event_prefix+"success")};e.error=b.ajax.error||function(q){i.ajax_error_handler(q,b.row)};a.ajax(e)},validate_property_form:function(b){var e=a.trim(a(":input[name=name]",b.row).val()),c=a.trim(a(":input[name=key]",b.row).val()),f=a(":input[name=expected_type]",b.row).val(),g=a(":input[name=expected_type_new]",b.row).val();if(e===""||c===""||f===""&&g==="")b.row.trigger(b.event_prefix+"error",[b.row,"Name, Key and Expected Type are required"])},delete_property_begin:function(b,
e){var c=b.parents("tr:first");c.parents("table:first");a.ajax({url:acre.request.app_url+"/schema/type/delete_property_submit",data:{id:e,user:m.user.id},type:"POST",dataType:"json",success:function(f,g,h){if(f.code==="/api/status/error")return i.ajax_error_handler(h,c);f=a(f.result.html).addClass("new-row");c.before(f);f.hide();c.remove();f.showRow()},error:function(f){i.ajax_error_handler(f,c)}})},undo_delete_property_begin:function(b,e){var c=b.parents("tr:first");c.parents("table:first");a.ajax({url:acre.request.app_url+
"/schema/type/undo_delete_property_submit",data:{prop_info:JSON.stringify(e)},type:"POST",dataType:"json",success:function(f,g,h){if(f.code==="/api/status/error")return i.ajax_error_handler(h,c);var j=a(f.result.html).addClass("new-row");c.before(j);j.hide();c.remove();j.showRow(function(){m.schema.init_row_menu(j);a(".edit",j).show()},null,"slow")},error:function(f){i.ajax_error_handler(f,c)}})},add_included_type_begin:function(b,e){var c=b.parents("tr:first");a.ajax({url:acre.request.app_url+"/schema/type/add_included_type_begin",
data:{id:e},dataType:"json",success:function(f,g,h){if(f.code==="/api/status/error")return i.ajax_error_handler(h,c);f=a(f.result.html);var j={mode:"edit",event_prefix:"fb.schema.type.add.included_type.",ajax:{url:acre.request.app_url+"/schema/type/add_included_type_submit"},init_form:d.init_included_type_form,validate_form:d.validate_included_type_form,submit_form:d.submit_included_type_form,table:b.parents("table:first"),trigger:b,trigger_row:c,row:a(".edit-row",f).hide(),submit_row:a(".edit-row-submit",
f).hide()};i.init_edit_form(j);j.row.bind("fb.schema.type.add.included_type.success",function(){a(".button-cancel",j.submit_row).text("Done");d.init_included_type_form(j)})},error:function(f){i.ajax_error_handler(f,c)}})},init_included_type_form:function(b){var e=a("input[name=included_type_input]",b.row).val(""),c=a("input[name=included_type]",b.row).val("");if(!b.row.data("initialized")){e.suggest({service_url:acre.freebase.service_url,category:"cotype",suggest_new:"Create new type"}).bind("fb-select",
function(f,g){e.val(g.id);c.val(g.id)}).bind("fb-textchange",function(){c.val("")});a(":input:not(textarea)",b.row).keypress(function(f){f.keyCode===13&&!f.isDefaultPrevented()&&b.row.trigger(b.event_prefix+"submit")}).keyup(function(f){f.keyCode===27&&b.row.trigger(b.event_prefix+"cancel")});b.row.data("initialized",true)}e.focus()},validate_included_type_form:function(b){a.trim(a(":input[name=included_type]",b.row).val())===""&&b.row.trigger(b.event_prefix+"error",[b.row,"Please choose a type to include"])},
submit_included_type_form:function(b){var e={id:a(":input[name=id]",b.row).val(),included_type:a.trim(a(":input[name=included_type]",b.row).val())};a.ajax({url:b.ajax.url,type:"POST",dataType:"json",data:a.extend(e,b.ajax.data),success:function(c,f,g){if(c.code==="/api/status/error")return i.ajax_error_handler(g,b.row);f=a("<table>");f.html(c.result.html);var h=a(">thead",f);b.table.append(h);a("tr:first",h).hide().showRow(function(){a(".tbody-header",h).each(function(){a(this).data("ajax",true).click(m.schema.type.toggle);
a(".edit",this).show()});b.row.trigger(b.event_prefix+"success")},null,"slow")},error:function(c){i.ajax_error_handler(c,b.row)}})},delete_included_type_begin:function(b,e,c){var f=b.parents("tr:first");f.parents("table:first");a.ajax({url:acre.request.app_url+"/schema/type/delete_included_type_submit",data:{id:e,included_type:c},type:"POST",dataType:"json",success:function(g,h,j){if(g.code==="/api/status/error")return i.ajax_error_handler(j,f);g=a(g.result.html).addClass("new-row");f.before(g);g.hide();
f.parent("thead").next("tbody:first").remove();f.remove();g.showRow()},error:function(g){i.ajax_error_handler(g,f)}})},undo_delete_included_type_begin:function(b,e,c){var f=b.parents("tr:first");f.parents("table:first");a.ajax({url:acre.request.app_url+"/schema/type/undo_delete_included_type_submit",data:{id:e,included_type:c},type:"POST",dataType:"json",success:function(g,h,j){if(g.code==="/api/status/error")return i.ajax_error_handler(j,f);g=a(g.result.html);var l=a(">tr",g).addClass("new-row");
h=f.parents("thead:first");h.before(g);l.hide();h.remove();l.showRow(function(){a(".tbody-header",l).each(function(){a(this).data("ajax",true).click(m.schema.type.toggle);a(".edit",this).show()})},null,"slow")},error:function(g){i.ajax_error_handler(g,f)}})},reverse_property_begin:function(b,e,c){var f=b.parents("tr:first");a.ajax({url:acre.request.app_url+"/schema/type/reverse_property_begin",data:{id:e,master:c},dataType:"json",success:function(g,h,j){if(g.code==="/api/status/error")return i.ajax_error_handler(j,
f);g=a(g.result.html);var l={mode:"edit",event_prefix:"fb.schema.type.reverse.property.",ajax:{url:acre.request.app_url+"/schema/type/add_property_submit",data:{master_property:c},success:function(n,r,q){if(n.code==="/api/status/error")return i.ajax_error_handler(q,l.row);d.reverse_property_success(l,n)}},init_form:d.init_property_form,validate_form:d.validate_property_form,submit_form:d.submit_property_form,table:b.parents("table:first"),trigger:b,trigger_row:f,row:a(".edit-row",g).hide(),submit_row:a(".edit-row-submit",
g).hide()};i.init_edit_form(l)},error:function(g){i.ajax_error_handler(g,f)}})},reverse_property_success:function(b,e){var c=a(e.result.html).addClass("new-row"),f=a("#type-table table:first > tbody");f.append(c);c.hide();c.showRow(function(){m.schema.init_row_menu(c);m.schema.type.init_tooltips(c);a(".edit",c).show()},null,"slow");f=a(".table-empty-column",f);f.length&&f.parents("tr:first").hide().prev("tr").show();b.trigger_row.remove();b.row.remove();b.submit_row.remove()},add_instance_begin:function(b,
e){var c=b.parents("tr:first");a.ajax({url:acre.request.app_url+"/schema/type/add_instance_begin",data:{id:e},dataType:"json",success:function(f,g,h){if(f.code==="/api/status/error")return i.ajax_error_handler(h,c);f=a(f.result.html);var j={mode:"add",event_prefix:"fb.schema.type.add.instance.",ajax:{url:acre.request.app_url+"/schema/type/add_instance_submit",data:{type:e}},init_form:d.init_instance_form,validate_form:d.validate_instance_form,submit_form:d.submit_instance_form,table:b.parents("table:first"),
trigger:b,trigger_row:c,row:a(".edit-row",f).hide(),submit_row:a(".edit-row-submit",f).hide()};i.init_edit_form(j);j.row.bind(j.event_prefix+"success",function(){var l=a("tbody:first .table-empty-column",j.table);l.length&&l.parents("tr:first").hide().prev("tr").show();a(".button-cancel",j.submit_row).text("Done");d.init_instance_form(j)})},error:function(f){i.ajax_error_handler(f,c)}})},init_instance_form:function(b){var e=a("input[name=name]",b.row),c=a("input[name=id]",b.row);e.val("");c.val("");
if(!e.data("suggest")){e.suggest({service_url:acre.freebase.service_url,suggest_new:"Create new",category:"instance"}).bind("fb-select",function(f,g){c.val(g.id)}).bind("fb-select-new",function(){c.val("")}).bind("fb-textchange",function(){c.val("")});e.keypress(function(f){f.keyCode===13&&!f.isDefaultPrevented()&&b.row.trigger(b.event_prefix+"submit")}).keyup(function(f){f.keyCode===27&&b.row.trigger(b.event_prefix+"cancel")})}},validate_instance_form:function(b){var e=a.trim(a(":input[name=name]",
b.row).val()),c=a(":input[name=id]",b.row).val();e===""&&c===""&&b.row.trigger(b.event_prefix+"error",[b.row,"Please select or create a new topic"])},submit_instance_form:function(b){var e=a(":input[name=name]",b.row),c={name:a.trim(e.val()),id:a(":input[name=id]",b.row).val()};c={url:b.ajax.url,type:"POST",dataType:"json",data:a.extend(c,b.ajax.data),success:function(f,g,h){if(f.code==="/api/status/error")return i.ajax_error_handler(h,b.row);var j=a(f.result.html).addClass("new-row");b.row.before(j);
j.hide();j.showRow(function(){m.schema.init_row_menu(j);a(".edit",j).show();e.focus()},null,"slow");b.row.trigger(b.event_prefix+"success")},error:function(f){i.ajax_error_handler(f,b.row)}};a.ajax(c)},delete_instance_begin:function(b,e,c){var f=b.parents("tr:first");f.parents("table:first");a.ajax({url:acre.request.app_url+"/schema/type/delete_instance_submit",data:{id:e,type:c},type:"POST",dataType:"json",success:function(g,h,j){if(g.code==="/api/status/error")return i.ajax_error_handler(j,f);g=
a(g.result.html).addClass("new-row");f.before(g);g.hide();f.remove();g.showRow()},error:function(g){i.ajax_error_handler(g,f)}})},undo_delete_instance_begin:function(b,e,c){var f=b.parents("tr:first");f.parents("table:first");a.ajax({url:acre.request.app_url+"/schema/type/undo_delete_instance_submit",data:{id:e,type:c},type:"POST",dataType:"json",success:function(g,h,j){if(g.code==="/api/status/error")return i.ajax_error_handler(j,f);var l=a(g.result.html).addClass("new-row");f.before(l);l.hide();
f.remove();l.showRow(function(){m.schema.init_row_menu(l);a(".edit",l).show()},null,"slow")},error:function(g){i.ajax_error_handler(g,f)}})}}})(jQuery,window.freebase);
