(function(a,k){var f=k.schema.domain.edit={add_new_type_begin:function(c,b){var d=a(c).parents(".edit:first").hide(),g=d.prev("table");a.ajax({url:acre.request.app_url+"/schema/service/add_new_type_begin",data:{id:acre.c.id,cvt:b?1:0},dataType:"json",success:function(e){e=e.result.html;a("tfoot",g).remove();var h=a(e);a(g).append(h).find(".text-input:first").focus();f.add_new_type_init(g);h.bind("fb.schema.domain.edit.add_new_type.submit",function(){console.log("fb.schema.domain.edit.add_new_type.submit");
f.add_new_type_submit(g)}).bind("fb.schema.domain.edit.add_new_type.cancel",function(){console.log("fb.schema.domain.edit.add_new_type.submit");h.fadeOut();d.fadeIn()}).bind("fb.schema.domain.edit.add_new_type.warning",function(l,i,j){console.log("fb.schema.domain.edit.add_new_type.warning",i,j);f.add_new_type_row_warning(g,i,j)}).bind("fb.schema.domain.edit.add_new_type.error",function(l,i,j){console.log("fb.schema.domain.edit.add_new_type.error",i,j);f.add_new_type_row_error(g,i,j)})}})},add_new_type_init:function(c){var b=
a("tfoot",c);a(".button-submit",b).click(function(){b.trigger("fb.schema.domain.edit.add_new_type.submit")});a(".button-cancel",b).click(function(){b.trigger("fb.schema.domain.edit.add_new_type.cancel")});a(".edit-row-template :input",b).attr("disabled","disabled");a(".edit-row:not(.edit-row-template, .edit-row-submit)",b).each(function(){f.add_new_type_init_row(a(this))});a(":text:first",b).focus()},add_new_type_init_row:function(c){var b=a(":input[name=name]",c),d=a(":input[name=key]",c),g=a(":input[name=desc]",
c);b.change(function(){d.data("changed",true)}).keyup(function(){if(!d.data("changed")){var e=b.val().toLowerCase();d.val(e)}});a(":text").keyup(function(e){if(e.keyCode===13)c.trigger("fb.schema.domain.edit.add_new_type.submit");else e.keyCode===27&&c.trigger("fb.schema.domain.edit.add_new_type.cancel")});g.focus(function(){if(b.val()&&d.val()){var e=c.siblings(".edit-row-template");if(e.prev(".edit-row")[0]===c[0]){var h=e.clone();h.removeClass("edit-row-template");a(":input",h).removeAttr("disabled");
e.before(h);f.add_new_type_init_row(h)}}})},add_new_type_submit:function(c){if(!a(".button-submit",b).is(":disabled")){a(".button-submit",b).attr("disabled","disabled");var b=a("tfoot",c);a(".row-msg",b).remove();c=a(".edit-row:not(.edit-row-template, .edit-row-submit)",b).each(function(){f.add_new_type_row_validate(a(this))});a(".row-msg-error",b).length?a(".button-submit",b).removeAttr("disabled"):c.each(function(){var d=a(this);a(":input[name=domain]").val();a(":input[name=name]",d).val();a(":input[name=key]",
d).val();a(":input[name=typehint]",d).val();a(":input[name=desc]",d).val();name===""&&key===""&&d.remove()})}},add_new_type_row_validate:function(c){var b=a(":input[name=name]",c).val(),d=a(":input[name=key]",c).val(),g=a(":input[name=desc]",c).val();if(b===""&&d===""&&g==="")c.trigger("fb.schema.domain.edit.add_new_type.warning",[c,"Empty rows will not be submitted"]);else if(b===""||d==="")c.trigger("fb.schema.domain.edit.add_new_type.error",[c,"Name and Key is required"])},add_new_type_row_error:function(c,
b,d){f.add_new_type_row_message(c,b,f.row_message(d,"error"))},add_new_type_row_warning:function(c,b,d){f.add_new_type_row_message(c,b,f.row_message(d,"warning"))},add_new_type_row_message:function(c,b,d){b.before(d)},row_message:function(c,b){var d=a("<span>").text(c);d=a('<td colspan="5">').append(d);d=a('<tr class="row-msg">').append(d);b&&d.addClass("row-msg-"+b);return d}}})(jQuery,window.freebase);
