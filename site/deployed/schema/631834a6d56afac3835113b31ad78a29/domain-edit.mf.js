/*
 
 jQuery Tools @VERSION / Expose - Dim the lights

 NO COPYRIGHTS OR LICENSES. DO WHAT YOU LIKE.

 http://flowplayer.org/tools/toolbox/expose.html

 Since: Mar 2010
 Date: @DATE 
 
 jQuery Tools @VERSION Overlay - Overlay base. Extend it.

 NO COPYRIGHTS OR LICENSES. DO WHAT YOU LIKE.

 http://flowplayer.org/tools/overlay/

 Since: March 2008
 Date: @DATE 
*/
(function(b){function m(){if(b.browser.msie){var g=b(document).height(),i=b(window).height();return[window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,g-i<20?i:g]}return[b(document).width(),b(document).height()]}function h(g){if(g)return g.call(b.mask)}b.tools=b.tools||{version:"@VERSION"};var c;c=b.tools.expose={conf:{maskId:"exposeMask",loadSpeed:"slow",closeSpeed:"fast",closeOnClick:true,closeOnEsc:true,zIndex:9998,opacity:0.8,startOpacity:0,color:"#fff",onLoad:null,
onClose:null}};var a,e,d,f,j;b.mask={load:function(g,i){if(d)return this;if(typeof g=="string")g={color:g};g=g||f;f=g=b.extend(b.extend({},c.conf),g);a=b("#"+g.maskId);if(!a.length){a=b("<div/>").attr("id",g.maskId);b("body").append(a)}var n=m();a.css({position:"absolute",top:0,left:0,width:n[0],height:n[1],display:"none",opacity:g.startOpacity,zIndex:g.zIndex});g.color&&a.css("backgroundColor",g.color);if(h(g.onBeforeLoad)===false)return this;g.closeOnEsc&&b(document).bind("keydown.mask",function(l){l.keyCode==
27&&b.mask.close(l)});g.closeOnClick&&a.bind("click.mask",function(l){b.mask.close(l)});b(window).bind("resize.mask",function(){b.mask.fit()});if(i&&i.length){j=i.eq(0).css("zIndex");b.each(i,function(){var l=b(this);/relative|absolute|fixed/i.test(l.css("position"))||l.css("position","relative")});e=i.css({zIndex:Math.max(g.zIndex+1,j=="auto"?0:j)})}a.css({display:"block"}).fadeTo(g.loadSpeed,g.opacity,function(){b.mask.fit();h(g.onLoad)});d=true;return this},close:function(){if(d){if(h(f.onBeforeClose)===
false)return this;a.fadeOut(f.closeSpeed,function(){h(f.onClose);e&&e.css({zIndex:j})});b(document).unbind("keydown.mask");a.unbind("click.mask");b(window).unbind("resize.mask");d=false}return this},fit:function(){if(d){var g=m();a.css({width:g[0],height:g[1]})}},getMask:function(){return a},isLoaded:function(){return d},getConf:function(){return f},getExposed:function(){return e}};b.fn.mask=function(g){b.mask.load(g);return this};b.fn.expose=function(g){b.mask.load(g,this);return this}})(jQuery);
(function(b){function m(a,e){var d=this,f=a.add(d),j=b(window),g,i,n,l=b.tools.expose&&(e.mask||e.expose),r=Math.random().toString().slice(10);if(l){if(typeof l=="string")l={color:l};l.closeOnClick=l.closeOnEsc=false}var s=e.target||a.attr("rel");i=s?b(s):a;if(!i.length)throw"Could not find Overlay: "+s;a&&a.index(i)==-1&&a.click(function(k){d.load(k);return k.preventDefault()});b.extend(d,{load:function(k){if(d.isOpened())return d;var o=c[e.effect];if(!o)throw'Overlay: cannot find effect : "'+e.effect+
'"';e.oneInstance&&b.each(h,function(){this.close(k)});k=k||b.Event();k.type="onBeforeLoad";f.trigger(k);if(k.isDefaultPrevented())return d;n=true;l&&b(i).expose(l);var p=e.top,t=e.left,u=i.outerWidth({margin:true}),v=i.outerHeight({margin:true});if(typeof p=="string")p=p=="center"?Math.max((j.height()-v)/2,0):parseInt(p,10)/100*j.height();if(t=="center")t=Math.max((j.width()-u)/2,0);o[0].call(d,{top:p,left:t},function(){if(n){k.type="onLoad";f.trigger(k)}});l&&e.closeOnClick&&b.mask.getMask().one("click",
d.close);e.closeOnClick&&b(document).bind("click."+r,function(q){b(q.target).parents(i).length||d.close(q)});e.closeOnEsc&&b(document).bind("keydown."+r,function(q){q.keyCode==27&&d.close(q)});return d},close:function(k){if(!d.isOpened())return d;k=k||b.Event();k.type="onBeforeClose";f.trigger(k);if(!k.isDefaultPrevented()){n=false;c[e.effect][1].call(d,function(){k.type="onClose";f.trigger(k)});b(document).unbind("click."+r).unbind("keydown."+r);l&&b.mask.close();return d}},getOverlay:function(){return i},
getTrigger:function(){return a},getClosers:function(){return g},isOpened:function(){return n},getConf:function(){return e}});b.each("onBeforeLoad,onStart,onLoad,onBeforeClose,onClose".split(","),function(k,o){b.isFunction(e[o])&&b(d).bind(o,e[o]);d[o]=function(p){b(d).bind(o,p);return d}});g=i.find(e.close||".close");if(!g.length&&!e.close){g=b('<a class="close"></a>');i.prepend(g)}g.click(function(k){d.close(k)});e.load&&d.load()}b.tools=b.tools||{version:"@VERSION"};b.tools.overlay={addEffect:function(a,
e,d){c[a]=[e,d]},conf:{close:null,closeOnClick:true,closeOnEsc:true,closeSpeed:"fast",effect:"default",fixed:!b.browser.msie||b.browser.version>6,left:"center",load:false,mask:null,oneInstance:true,speed:"normal",target:null,top:"10%"}};var h=[],c={};b.tools.overlay.addEffect("default",function(a,e){var d=this.getConf(),f=b(window);if(!d.fixed){a.top+=f.scrollTop();a.left+=f.scrollLeft()}a.position=d.fixed?"fixed":"absolute";this.getOverlay().css(a).fadeIn(d.speed,e)},function(a){this.getOverlay().fadeOut(this.getConf().closeSpeed,
a)});b.fn.overlay=function(a){var e=this.data("overlay");if(e)return e;if(b.isFunction(a))a={onBeforeLoad:a};a=b.extend(true,{},b.tools.overlay.conf,a);this.each(function(){e=new m(b(this),a);h.push(e);b(this).data("overlay",e)});return a.api?e:this}})(jQuery);
(function(b,m){var h=m.schema.edit={init_edit_form:function(c){if(c.mode==="add")b("tbody",c.table).append(c.row);else if(c.mode==="edit")c.trigger_row.before(c.row);else throw"Unknown edit type mode: "+c.mode;c.trigger_row.before(c.submit_row);var a=c.event_prefix||"fb.schema.edit.";c.row.bind(a+"submit",function(){console.log(a+"submit");h.submit_edit_form(c)}).bind(a+"cancel",function(){console.log(a+"cancel");h.cancel_edit_form(c)}).bind(a+"error",function(e,d,f){console.log(a+"error",d,f);h.row_error(d,
f);c.row.removeClass("loading")}).bind(a+"success",function(){console.log(a+"success");c.row.removeClass("loading")});b(".button-submit",c.submit_row).click(function(){c.row.trigger(a+"submit")});b(".button-cancel",c.submit_row).click(function(){c.row.trigger(a+"cancel")});typeof c.init_form==="function"&&c.init_form(c);c.row.showRow(function(){b(":text:first",c.row).focus()});c.trigger_row.hide();c.submit_row.show()},cancel_edit_form:function(c){c.row.hideRow(function(){b(this).remove()});h.clear_row_message(c.row);
c.submit_row.remove();c.trigger_row.show();c.trigger.removeClass("editing")},submit_edit_form:function(c){if(!c.row.is(".loading")){document.activeElement&&b(document.activeElement).blur();h.clear_row_message(c.row);typeof c.validate_form==="function"&&c.validate_form(c);if(!h.has_row_message(c.row,"error")){c.row.addClass("loading");typeof c.submit_form==="function"&&c.submit_form(c)}}},ajax_error_handler:function(c,a,e){var d;try{d=JSON.parse(c.responseText);d=d.messages[0].message}catch(f){d=c.responseText}if(a){h.row_error(a,
d);a.removeClass("loading")}else if(e){h.form_error(e,d);e.removeClass("loading")}},row_error:function(c,a){return h.row_message(c,a,"error")},row_message:function(c,a,e){var d=b('<a class="close-msg" href="#">Close</a>').click(function(f){return m.schema.close_message.apply(this,[f,".row-msg:first"])});a=b("<span>").text(a);d=b('<td colspan="5">').append(d).append(a);d=b('<tr class="row-msg">').append(d);e&&d.addClass("row-msg-"+e);c.before(d);d.hide().showRow();a=c.data("row-msg");if(!a){a={};c.data("row-msg",
a)}if(a[e])a[e].push(d);else a[e]=[d];return d},clear_row_message:function(c){var a=c.data("row-msg");if(a){b.each(a,function(e,d){b.each(d,function(f,j){j.remove()})});c.removeData("row-msg")}},has_row_message:function(c,a){var e=c.data("row-msg");if(a)return e&&e[a]&&e[a].length;return e!=null},init_modal_form:function(c){b(document.body).append(c.form.hide());var a=c.event_prefix||"fb.schema.edit.modal.";c.form.bind(a+"submit",function(){console.log(a+"submit");h.submit_modal_form(c)}).bind(a+
"error",function(e,d){console.log(a+"error",d);h.form_error(c.form,d)}).bind(a+"success",function(){console.log(a+"success");c.form.removeClass("loading")});b(".button-submit",c.form).click(function(){c.form.trigger(a+"submit")});typeof c.init_form==="function"&&c.init_form(c);c.form.overlay({close:".button-cancel",closeOnClick:false,load:true,mask:{color:"#000",loadSpeed:200,opacity:0.5}})},submit_modal_form:function(c){if(!c.form.is(".loading")){document.activeElement&&b(document.activeElement).blur();
h.clear_form_message(c.form);typeof c.validate_form==="function"&&c.validate_form(c);if(!h.has_form_message(c.form,"error")){c.form.addClass("loading");typeof c.submit_form==="function"&&c.submit_form(c)}}},form_error:function(c,a){return h.form_message(c,a,"error")},form_message:function(c,a,e){a=b("<div class='form-msg'>").text(a).hide();b(".form-group",c).prepend(a);a.slideDown();var d=c.data("form-msg");if(!d){d={};c.data("form-msg",d)}if(d[e])d[e].push(a);else d[e]=[a];return a},clear_form_message:function(c){var a=
c.data("form-msg");if(a){b.each(a,function(e,d){b.each(d,function(f,j){j.remove()})});c.removeData("form-msg")}},has_form_message:function(c,a){var e=c.data("form-msg");if(a)return e&&e[a]&&e[a].length;return e!=null},auto_key:function(c,a,e){var d=a.val();if(d)a.data("original",d);else{a.data("autogen",true);a.change(function(){a.data("autogen",false)});c.change(function(){if(a.data("autogen")){var f=b.trim(c.val()).toLowerCase();f=f.replace(/\s+/g,"_");f=f.replace(/\_\_+/g,"_");f=f.replace(/\-\-+/g,
"-");f=f.replace(/[^a-z0-9]+$/,"");f=f.replace(/^[^a-z]+/,"");try{h.check_key(f,e)}catch(j){return}a.val(f)}})}},check_key:function(c,a){return a==="/type/domain"?h.check_key_domain(c):a==="/type/type"?h.check_key_type(c):a==="/type/property"?h.check_key_property(c):h.check_key_default(c)},check_key_domain:function(c){return h.check_key_default(c,5)},check_key_type:function(c){return h.check_key_default(c)},check_key_property:function(c){return h.check_key_default(c)},check_key_default:function(c,
a){a||(a=1);if(c.length===1){if(/^[a-z]$/.test(c))return c}else{var e="^[a-z][a-z0-9_-]";e+=a>1?"{"+(a-1)+",}$":"+$";if(RegExp(e).test(c))if(!(c.match(/\-\-+/)||c.match(/__+/)||c.match(/[^a-z0-9]+$/)))return c}e=a>1?"Key must be "+a+" or more alphanumeric characters":"Key must be alphanumeric";e+=", lowercase, begin with a letter and not end with a non-alphanumeric character. Dashes and underscores are allowed but not consecutively.";throw e;}}})(jQuery,window.freebase);
(function(b,m){var h=m.schema.edit,c=m.schema.domain.edit={domain_settings_begin:function(a,e){b.ajax({url:acre.request.app_url+"/schema/domain/domain_settings_begin",data:{id:e},dataType:"json",success:function(d){d=b(d.result.html);d={event_prefix:"fb.schema.domain.settings.",ajax:{url:acre.request.app_url+"/schema/domain/domain_settings_submit",data:{id:e}},init_form:c.init_domain_settings_form,validate_form:c.validate_domain_settings_form,submit_form:c.submit_domain_settings_form,form:d};h.init_modal_form(d);
d.form.bind(d.event_prefix+"success",function(f,j){window.location=j.location})}})},init_domain_settings_form:function(a){var e=b("input[name=name]",a.form),d=b("input[name=key]",a.form);h.auto_key(e,d);b(":input:not(textarea)",a.form).keypress(function(f){f.keyCode===13&&!f.isDefaultPrevented()&&a.form.trigger(a.event_prefix+"submit")})},validate_domain_settings_form:function(a){var e=b.trim(b("input[name=name]",a.form).val()),d=b("input[name=key]",a.form),f=d.val();if(e===""||f==="")a.form.trigger(a.event_prefix+
"error","Name and Key are required");else if(d.data("original")!==f)try{h.check_key_domain(f)}catch(j){a.form.trigger(a.event_prefix+"error",j)}},submit_domain_settings_form:function(a){var e=b("input[name=key]",a.form),d={name:b.trim(b(":input[name=name]",a.row).val()),key:e,namespace:b("input[name=namespace]",a.form).val(),description:b.trim(b("textarea[name=description]",a.form).val())};d.mqlkey_quote=e.data("original")===d.key?false:true;b.ajax({url:a.ajax.url,type:"POST",dataType:"json",data:b.extend(d,
a.ajax.data),success:function(f,j,g){if(f.code==="/api/status/error")return h.ajax_error_handler(g,null,a.form);a.form.trigger(a.event_prefix+"success",f.result)},error:function(f){h.ajax_error_handler(f,null,a.form)}})},add_type_begin:function(a,e,d){b.ajax({url:acre.request.app_url+"/schema/domain/add_type_begin",data:{id:e,role:d},dataType:"json",success:function(f,j,g){if(f.code==="/api/status/error")return h.ajax_error_handler(g,row);f=b(f.result.html);var i={mode:"add",event_prefix:"fb.schema.domain.add.type.",
ajax:{url:acre.request.app_url+"/schema/domain/add_type_submit"},init_form:c.init_type_form,validate_form:c.validate_type_form,submit_form:c.submit_type_form,table:a.parents("table:first"),trigger:a,trigger_row:a.parents("tr:first"),row:b(".edit-row",f).hide(),submit_row:b(".edit-row-submit",f).hide()};h.init_edit_form(i);i.row.bind("fb.schema.domain.add.type.success",function(){var n=b("thead:first .table-empty-column",i.table);n.length&&n.parents("tr:first").hide().prev("tr").show();b(".button-cancel",
i.submit_row).text("Done");c.init_type_form(i)})},error:function(f){h.ajax_error_handler(f,row)}})},edit_type_begin:function(a,e){b.ajax({url:acre.request.app_url+"/schema/domain/edit_type_begin",data:{id:e},dataType:"json",success:function(d,f,j){if(d.code==="/api/status/error")return h.ajax_error_handler(j,row);d=b(d.result.html);var g={mode:"edit",event_prefix:"fb.schema.domain.edit.type.",ajax:{url:acre.request.app_url+"/schema/domain/edit_type_submit",data:{id:e}},init_form:c.init_type_form,
validate_form:c.validate_type_form,submit_form:c.submit_type_form,table:a.parents("table:first"),trigger:a,trigger_row:a.parents("tr:first"),row:b(".edit-row",d).hide(),submit_row:b(".edit-row-submit",d).hide()};h.init_edit_form(g);g.row.bind("fb.schema.domain.edit.type.success",function(){g.trigger_row.remove();g.row.remove();g.submit_row.remove()})},error:function(d){h.ajax_error_handler(d,row)}})},init_type_form:function(a){var e=b(":input[name=name]",a.row),d=b(":input[name=key]",a.row),f=b(":input[name=description]",
a.row);if(a.mode==="add"){e.val("");d.val("").data("changed",false);f.val("")}if(!a.row.data("initialized")){h.auto_key(e,d,"/type/type");b(":input:not(textarea)",a.row).keypress(function(j){if(j.keyCode===13)a.row.trigger(a.event_prefix+"submit");else j.keyCode===27&&a.row.trigger(a.event_prefix+"cancel")});a.row.data("initialized",true)}e.focus()},submit_type_form:function(a){var e=b(":input[name=key]",a.row),d={domain:b(":input[name=domain]",a.row).val(),name:b.trim(b(":input[name=name]",a.row).val()),
key:e.val(),description:b.trim(b(":input[name=description]",a.row).val())};d.mqlkey_quote=e.data("original")===d.key?false:true;if(a.mode==="add")d.role=b(":input[name=role]",a.row).val();b.ajax({url:a.ajax.url,type:"POST",dataType:"json",data:b.extend(d,a.ajax.data),success:function(f,j,g){if(f.code==="/api/status/error")return h.ajax_error_handler(g,a.row);var i=b(f.result.html).addClass("new-row");a.row.before(i);i.hide();i.showRow(function(){m.schema.init_row_menu(i);b(".edit",i).show()},null,
"slow");a.row.trigger(a.event_prefix+"success")},error:function(f){h.ajax_error_handler(f,a.row)}})},validate_type_form:function(a){var e=b.trim(b(":input[name=name]",a.row).val()),d=b("input[name=key]",a.row),f=d.val();if(e===""||f==="")a.row.trigger(a.event_prefix+"error",[a.row,"Name and Key are required"]);else if(d.data("original")!==f)try{h.check_key_type(f)}catch(j){a.row.trigger(a.event_prefix+"error",[a.row,j])}},delete_type_begin:function(a,e){var d=a.parents("tr:first");d.parents("table:first");
b.ajax({url:acre.request.app_url+"/schema/domain/delete_type_submit",data:{id:e,user:m.user.id},type:"POST",dataType:"json",success:function(f,j,g){if(f.code==="/api/status/error")return h.ajax_error_handler(g,d);f=b(f.result.html).addClass("new-row");d.before(f);f.hide();d.remove();f.showRow()},error:function(f){h.ajax_error_handler(f,d)}})},undo_delete_type_begin:function(a,e){var d=a.parents("tr:first");d.parents("table:first");b.ajax({url:acre.request.app_url+"/schema/domain/undo_delete_type_submit",
data:{type_info:JSON.stringify(e)},type:"POST",dataType:"json",success:function(f,j,g){if(f.code==="/api/status/error")return h.ajax_error_handler(g,d);var i=b(f.result.html).addClass("new-row");d.before(i);i.hide();d.remove();i.showRow(function(){m.schema.init_row_menu(i);b(".edit",i).show()},null,"slow")},error:function(f){h.ajax_error_handler(f,d)}})}}})(jQuery,window.freebase);
